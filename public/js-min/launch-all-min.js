/*
 Copyright 2012 Martijn van de Rijdt

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var h=!0,i=null,l=!1;function m(){return function(){}}function n(a){return function(){return a}}var o,p;$(document).ready(function(){p=new s;p.a();"undefined"==typeof console&&(console={log:m()});"undefined"==typeof window.console.debug&&(console.debug=console.log);"true"!==t("debug")&&(window.console.log=m(),window.console.debug=m())});function s(){}o=s.prototype;
o.a=function(){this.ea.O();v(this).a();this.L();"function"===typeof this.K&&this.K();$(".dialog [title]").tooltip();Modernizr.borderradius&&(Modernizr.boxshadow&&Modernizr.csstransitions&&Modernizr.opacity)&&$(document).trigger("browsersupport","fancy-visuals");$("footer").detach().appendTo("#container")};o.O=function(){$(window).trigger("resize")};
o.L=function(){var a=this;$("#feedback-bar-close").button({icons:{primary:"ui-icon-closethick"},text:l}).click(function(a){a.preventDefault();$("#feedback-bar p").remove();$("#feedback-bar").trigger("change")});$("#page-close").button({icons:{primary:"ui-icon-closethick"},text:l}).click(function(c){c.preventDefault();v(a).close()});$("#feedback-bar-close, #page-close").removeClass().addClass("custom-button ui-widget-header ui-corner-all");$(document).on("click",'a[href^="#"]:not([href="#"]):not(nav ul li a)',
function(a){var d=$(this).attr("href");"#"!==d&&(a.preventDefault(),$('nav li a[href="'+d+'"]').click())});$('nav ul li a[href^="#"]').click(function(c){c.preventDefault();c=$(this).attr("href").substr(1);v(a).open(c);$(this).closest("li").addClass("nav-state-active")});$(window).on("onlinestatuschange",function(c,d){a.updateStatus.qa(d)});$(document).on("edit","form.jr",function(c,d){a.updateStatus.Y(d)});$(document).on("browsersupport",function(c,d){a.updateStatus.support(d)});$("#page, #feedback-bar").on("change",
function(){a.display()});$("header #status-connection").click(function(a){w($(this).attr("title"));a.stopPropagation()});$(window).resize(function(){$("#container").css("top",$("header").outerHeight());$("body:not(.no-scroll) #container").height($(window).height()-$("header").outerHeight()-$("#form-controls.bottom").outerHeight());var a=$("nav").offset().left,d=$("#logo").offset().left+$("#logo").outerWidth();a<d?$("#logo").css("visibility","hidden"):$("#logo").css("visibility","visible")})};
o.ea={O:function(){$("article.page").each(function(){var a,c="",d;d=$(this).attr("id");a=$(this).attr("data-display")?$(this).attr("data-display"):d;c=$(this).attr("data-title")?$(this).attr("data-title"):d;d=$(this).attr("data-ext-link")?$(this).attr("data-ext-link"):"#"+d;$('<li class="ui-corner-tl ui-corner-tr"><a href="'+d+'" title="'+c+'" >'+a+"</a></li>").appendTo($("nav ul"))})},reset:function(){$("nav ul li").removeClass("nav-state-active")}};
function v(a){a.a=function(){this.v=$("<pages></pages>");$("article.page").detach().appendTo(this.v)};a.get=function(a){var d=this.v.find('article[id="'+a+'"]');return d=0<d.length?d:$('article[id="'+a+'"]')};a.r=function(a){return 0<$("#page article.page"+("undefined"!==typeof a?'[id="'+a+'"]':"")).length};a.open=function(a){var d;if(!this.r(a)){d=this.get(a);if(1!==d.length)return console.error("page not found");this.r()&&this.close();$("#page-content").prepend(d.show()).trigger("change");$("#overlay").show();
setTimeout(function(){d.find(".scroll-list").ka();$("#overlay, header").bind("click.pageEvents",function(){$("#page-close").trigger("click")})},50);$(window).bind("resize.pageEvents",function(){$("#page").trigger("change")})}};a.close=function(){var a;a=$("#page .page").detach();this.v.append(a);$("#page").trigger("change");this.ea.reset();$("#overlay").hide();$("#overlay, header").unbind(".pageEvents");$(window).unbind(".pageEvents")};return a}
function w(a,c){var d,c=c?1E3*c:1E4;$("#feedback-bar p").eq(1).remove();$("#feedback-bar p").html()!==a&&(d=$("<p></p>"),d.text(a),$("#feedback-bar").prepend(d));$("#feedback-bar").trigger("change");setTimeout(function(){typeof d!=="undefined"&&d.remove();$("#feedback-bar").trigger("change")},c)}
o.alert=function(a,c,d){var f=$("#dialog-alert"),c=c||"Alert",d=d||"ui-icon-alert";f.find("p .ui-icon:eq(0)").removeClass().addClass("ui-icon "+d);d=function(){f.dialog("destroy");f.find("#dialog-alert-msg").text("")};f.find("#dialog-alert-msg").html(a).U();f.dialog({title:c,modal:h,resizable:l,closeOnEscape:h,buttons:{Ok:d},beforeClose:d,width:500})};
o.confirm=function(a,c){var d,f,g,e,j;"string"===typeof a?d=a:"string"===typeof a.da&&(d=a.da);d="undefined"!==typeof d?d:"Please confirm action";f="undefined"!==typeof a.heading?a.heading:"Are you sure?";e="undefined"!==typeof a.dialog?a.dialog:"confirm";c="undefined"!==typeof c?c:{};c.I=c.I||"Confirm";c.D=c.D||"Cancel";c.H=c.H||n(l);c.C=c.C||n(l);c.z=c.z||m();g=function(){j.dialog("destroy");j.find(".dialog-msg, .dialog-error").text("");console.debug("dialog destroyed")};j=$("#dialog-"+e);j.find(".dialog-msg").text(d).U();
j.dialog({open:c.z,title:f,resizable:l,modal:h,closeOnEscape:h,buttons:[{text:c.I,click:function(){c.H.call();j.find(".dialog-error").text().length===0&&g.call()}},{text:c.D,click:function(){c.C.call();g.call()}}],width:500,beforeClose:g})};
o.updateStatus={qa:function(a){console.log("updating online status in menu bar to:");console.log(a);a?$("header #status-connection").removeClass().addClass("ui-icon ui-icon-signal-diag").attr("title","It appears there is currently an Internet connection available."):$("header #status-connection").removeClass().addClass("ui-icon ui-icon-cancel").attr("title","It appears there is currently no Internet connection")},Y:function(a){a?$("header #status-editing").removeClass().addClass("ui-icon ui-icon-pencil").attr("title",
"Form is being edited."):$("header #status-editing").removeClass().attr("title","")},support:function(a){var c=v(p).get("settings");0<c.length&&(console.debug("updating browser support for "+a),c.find("#settings-browserSupport-"+a+" span.ui-icon").addClass("ui-icon-check"))}};
o.display=function(){var a,c;c=$("header");var d=$("#feedback-bar"),f=$("#page");0<d.find("p").length?(a=c.outerHeight(),c=v(this).r()?c.outerHeight()+d.outerHeight():c.outerHeight()+d.outerHeight()-f.outerHeight()):(a=c.outerHeight()-d.outerHeight(),c=v(this).r()?c.outerHeight():c.outerHeight()-f.outerHeight());d.css("top",a);f.css("top",c)};
function t(a){for(var c=window.location.search.substring(1).split("&"),d=0;d<c.length;d++){var f=c[d].split("=");if(f[0]==a)return encodeURI(f[1])}return l}function x(a,c){for(var d=a;d.length<c;)d="0"+d;return d}var y=jQuery;y.fn.ta=function(){var a=0;this.each(function(){y(this).width()>a&&(a=y(this).width())}).each(function(){y(this).width(a)})};y.fn.reverse=[].reverse;
y.fn.R=function(a){a=y.extend({ba:"!@#$%^&*()+=[]\\';,/{}|\":<>?~`.- ",g:"",w:""},a);this.each(function(){a.Qa&&(a.g+="ABCDEFGHIJKLMNOPQRSTUVWXYZ");a.Ha&&(a.g+="abcdefghijklmnopqrstuvwxyz");for(var c=a.w.split(""),d=0;d<c.length;d++)-1!=a.ba.indexOf(c[d])&&(c[d]="\\"+c[d]);a.w=c.join("|");var f=a.ba+a.g,f=f.replace(RegExp(a.w,"gi"),"");y(this).keypress(function(a){var c;c=a.charCode?String.fromCharCode(a.charCode):String.fromCharCode(a.which);f.indexOf(c)!=-1&&a.preventDefault();a.ctrlKey&&c=="v"&&
a.preventDefault()});y(this).bind("contextmenu",n(l))})};y.fn.Ra=function(a){var c="abcdefghijklmnopqrstuvwxyz",c=c+c.toUpperCase(),a=y.extend({g:c},a);return this.each(function(){y(this).R(a)})};y.fn.alpha=function(a){a=y.extend({g:"1234567890"},a);return this.each(function(){y(this).R(a)})};
y.fn.U=function(){var a;a||(a=1);var c=this.contents().filter(function(){return 3==this.nodeType}).first(),d=c.text();a=d.split(" ",a).join(" ");c.length&&(c[0].nodeValue=d.slice(a.length),c.before('<span class="capitalize">'+a+"</span>"))};
y.fn.ka=function(){this.each(function(){var a=y(this),c=y(this).find("ol");a.css("overflow","hidden");var d=c.height()-a.height();if(0<d){var f=d/c.height(),f=Math.round((1-f)*a.height()),f=f-f%2;y("#records .column.middle").html('<div id="slider-wrap" class="ui-corner-all"><div id="slider-vertical"></div></div>');y("#slider-wrap").height(a.outerHeight());y("#slider-vertical").slider({orientation:"vertical",Sa:"max",min:0,max:100,value:100,Za:function(a,e){c.css({top:-((100-e.value)*d/100)})}});y("#slider-wrap").css("margin-top",
y("#records-saved h3").outerHeight(h));y(".ui-slider-handle").css({height:f,"margin-bottom":-0.5*f});a=y("#slider-vertical").height();f=a-f;a=0.5*(a-f);y(".ui-slider").css({height:f,"margin-top":a});y(".ui-slider-range").css({top:-a});y("#slider-wrap").click(function(){y("#slider-vertical").slider("value",0);c.css({top:-d})})}})};/*
 Copyright 2012 Martijn van de Rijdt

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function z(a){function c(b){function a(b,c,d){this.j="undefined"!==typeof b&&b?b:"*";this.filter=d="undefined"!==typeof d&&d!==i?d:{};this.filter.s="undefined"!==typeof d.s?d.s:h;this.filter.F="undefined"!==typeof d.F?d.F:l;this.filter.t="undefined"!==typeof d.t?d.t:l;this.filter.m="undefined"!==typeof d.m?d.m:l;this.index=c}var c,d=this,b=b.replace(/<[\/]?instance(>|\s+[^>]*>)/gi,"");this.xml=$.parseXML(b);this.u=c=$(this.xml);XPathJS.bindDomLevel3XPath();this.b=function(b,c,d){return new a(b,c,
d)};a.prototype.get=function(){var b,a;b=this.filter.t===h?c.Q(this.j).filter("[template]"):this.filter.s===h?c.Q(this.j).not("[template], [template] *"):c.Q(this.j);this.filter.m===h?b=b.filter(function(){a=$(this).text();return 0===$(this).children().length&&0<a.trim().length}):this.filter.F===h&&(b=b.filter(function(){return 0===$(this).children().length}));return b="undefined"!==typeof this.index&&this.index!==i?b.eq(this.index):b};a.prototype.h=function(b,a,c){var d,B;B=this.i().join(" ");b=
"undefined"!==typeof b?$.isArray(b)?b.join(" "):b:"";b=this.k(b,c);d=this.get();if(1===d.length&&b.toString().trim()!==B.toString().trim())return d.text(b),b=this.c(a,c),e.trigger("dataupdate",d.prop("nodeName")),b;if(1<d.length)return console.error("nodeset.setVal expected nodeset with one node, but received multiple"),i;0===d.length&&console.error("Data node: "+this.j+" with null-based index: "+this.index+" not found!");return i};a.prototype.i=function(){var b=[];this.get().each(function(){b.push($(this).text())});
return b};a.prototype.clone=function(b){var a,c;a=this.get();b=b||a;1===a.length&&1===b.length?(a.clone().insertAfter(b).find("*").andSelf().removeAttr("template"),c=[a.prop("nodeName")],a.find("*").each(function(){c.push($(this).prop("nodeName"))}),e.trigger("dataupdate",c.join())):console.error("node.clone() function did not receive origin and target nodes")};a.prototype.remove=function(){var b=this.get();0<b.length?(b.remove(),e.trigger("dataupdate",b.prop("nodeName"))):console.error("could not find node "+
this.j+" with index "+this.index+"to remove ")};a.prototype.k=function(b,a){return""===b.toString()?b:"undefined"!==typeof a&&a!==i&&"undefined"!==typeof this.types[a.toLowerCase()]&&"undefined"!==typeof this.types[a.toLowerCase()].k?this.types[a.toLowerCase()].k(b):b};a.prototype.c=function(b,a){var c,B;c=this.i();if(""===c.toString())return h;if("undefined"==typeof a||a===i||"undefined"==typeof this.types[a.toLowerCase()])console.error("data type "+a+" set to string"),a="string";c=this.types[a.toLowerCase()].c(c);
B="undefined"!==typeof b&&b!==i&&0<b.length?d.evaluate(b,"boolean",this.j,this.index):h;return c&&B};a.prototype.types={string:{c:n(h)},select:{c:n(h)},select1:{c:n(h)},decimal:{c:function(b){return!isNaN(b-0)&&b!==i?h:l}},"int":{c:function(b){return!isNaN(b-0)&&b!==i&&Math.round(b)==b?h:l}},date:{c:function(b){return"Invalid Date"!==(new Date(b.toString())).toString()},k:function(b){b=new Date(b);b.setUTCHours(0,0,0,0);return(new Date(b)).toUTCString()}},datetime:{c:function(b){return"Invalid Date"!==
(new Date(b)).toString()}},time:{c:function(b){return"Invalid Date"!==(new Date("2012-01-01 "+b)).toString()},k:function(b){b=new Date("2012-01-01 "+b);return x(b.getHours().toString(),2)+":"+x(b.getMinutes().toString(),2)+":"+x(b.getSeconds().toString(),2)}},barcode:{c:n(h)},geopoint:{c:n(h)},binary:{c:n(h)}}}function d(b){e=$(b)}var f,g,e,j;this.Ja=function(b,a,c,d){return f.evaluate(b,a,c,d)};this.Ya=function(){return g.J()};this.Ka=function(){return f.get()};this.data=function(b){return new c(b)};
this.form=function(b){return new d(b)};this.La=function(){return f.aa()};this.P=function(){return g.P()};this.a=function(){j=$("form.jr:eq(0)").clone().appendTo("<original></original>");f=new c(a);f.a();g=new d("form.jr:eq(0)");g.a()};this.p=function(b){return f.$(b,void 0)};this.Na=function(){return g.ga.get()};this.Wa=function(b){return g.ga.set(b)};this.Oa=function(){return g.ha.get()};this.Xa=function(b){return g.ha.set(b)};this.Va=function(b){return g.n.set(b)};this.Ma=function(){return g.n.get()};
this.reset=function(){$("#form-languages").remove();e.replaceWith(j)};this.Fa=function(){g.P()};this.B=function(){return g.B()};c.prototype.a=function(){var b,a;this.b(i,i,{m:h,s:l}).get().each(function(){a=$(this).text();$(this).text(a.trim())});b=this.b(":first",0).get();this.namespace=b.attr("xmlns");b.removeAttr("xmlns");this.W()};c.prototype.oa=function(b,a){var c,d,e=this.b(b,0,{t:h}),e=0===e.get().length?this.b(b,0):e;d=e.get().prop("nodeName");c=this.b(b,a).get();1===e.get().length&&1===c.length&&
c.next().prop("nodeName")!==d?e.clone(c):c.next().prop("nodeName")!==d&&console.error("Could not find template node and/or node to insert the clone after")};c.prototype.W=function(b){var a=this;if("undefined"==typeof b||0===b.length)b=this.u.find(":first");b.children("[template]").each(function(){"undefined"==typeof $(this).parent().attr("template")&&0===$(this).siblings($(this).prop("nodeName")).not("[template]").length&&$(this).clone().insertAfter($(this)).find("*").andSelf().removeAttr("template")});
b.children().not("[template]").each(function(){a.W($(this))})};c.prototype.get=function(){return this.u||i};c.prototype.aa=function(){return this.xml||i};c.prototype.$=function(b,a){var c,b="undefined"!==typeof b?b:l,a="undefined"!==typeof a?a:h;c=$("<root></root");this.u.find(":first").clone().appendTo(c);b===l&&c.find("[template]").remove();a===h&&("undefined"!==typeof this.namespace&&0<this.namespace.length)&&c.children().eq(0).attr("xmlns",this.namespace);c=(new XMLSerializer).serializeToString(c.children().eq(0)[0]);
c=c.replace(/xmlns\=\"[A-z0-9\:\/\.\-\%\_\?&amp;]*\"/gi," ");return c=c.replace(/\t/g,"")};c.prototype.ya=function(b,a){var c,d,e,f=b;for(c=0;c<a.length;c++)d=a.eq(c).attr("name"),e=a.eq(c).siblings('[name="'+d+'"]').andSelf().index(a.eq(c)),f=f.replace(d,d+"["+(e+1)+"]");return f};c.prototype.evaluate=function(b,a,d,f){var q,k,g,a=a||"any",f=f||0;q=new c(this.$(l,l));"undefined"!==typeof d||d!==i?(q=q.b(d,f,{}).get()[0],0<e.find('[name="'+d+'"]').parents(".jr-repeat").length&&(d=e.find('[name="'+
d+'"]').eq(f).parents(".jr-repeat"),b=this.ya(b,d))):q=q.aa();d={"0":["any","ANY_TYPE"],1:["number","NUMBER_TYPE","numberValue"],2:["string","STRING_TYPE","stringValue"],3:["boolean","BOOLEAN_TYPE","booleanValue"],7:["nodes","ORDERED_NODE_SNAPSHOT_TYPE"],9:["node","FIRST_ORDERED_NODE_TYPE"]};for(k in d)if(k=Number(k),d[k][0]==a)break;else k=0;b=b.replace(/&lt;/g,"<");b=b.replace(/&gt;/g,">");b=b.replace(/&quot;/g,'"');try{g=document.evaluate(b,q,i,k,i);if(0===k){for(k in d)if(k=Number(k),k==Number(g.resultType))return g=
0<k&&4>k?g[d[k][2]]:g,console.debug("evaluated "+b+" to: "+g),g;console.error("Expression: "+b+" did not return any boolean, string or number value as expected")}console.debug("evaluated "+b+" to: "+g[d[k][2]]);return g[d[k][2]]}catch(j){console.error("Error occurred trying to evaluate: "+b+", message: "+j.message)}};d.prototype.a=function(){var b;this.na();if("undefined"==typeof f||!(f instanceof c))return console.error("variable data needs to be defined as instance of DataXML");e.find('label>input[type="checkbox"], label>input[type="radio"]').parent().parent("fieldset").prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');
e.parent().find("label>select, :not(#jr-preload-items, #jr-calculated-items)>label>input").not('[type="checkbox"], [type="radio"]').parent().prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');e.find('label>input[type="checkbox"][required], label>input[type="radio"][required]').parent().parent("fieldset").find(".question-icons .required").addClass("ui-icon ui-icon-notice");e.parent().find("label>select[required], :not(#jr-preload-items, #jr-calculated-items)>label>input[required]").not('[type="checkbox"], [type="radio"]').parent().find(".question-icons .required").addClass("ui-icon ui-icon-notice");
e.find('input[type="radio"]').each(function(){b=$(this).attr("name");$(this).attr("data-name",b)});e.find("h2").first().append("<span/>");this.repeat.a();this.J();this.ma();this.Ga.a();this.S.a();this.T();this.G();this.L();this.za.a();this.Da();this.n.set(l)};d.prototype.na=function(){var b,a=[],c,d,q,g,j,u,r,M,N,O,P,Q,R,S,T,U,I,J;r=e.find("#stats");b=parseInt(r.find('[id="jrItem"]').text(),10);c=parseInt(r.find('[id="jrInput"]').text(),10);d=parseInt(r.find('[id="jrUpload"]').text(),10);q=parseInt(r.find('[id="jrTrigger"]').text(),
10);g=parseInt(r.find('[id="jrConstraint"]').text(),10);j=parseInt(r.find('[id="jrRelevant"]').text(),10);u=parseInt(r.find('[id="jrCalculate"]').text(),10);r=parseInt(r.find('[id="jrPreload"]').text(),10);M=e.find('input[type="radio"]').length;N=e.find('input[type="checkbox"]').length;e.find("select");O=e.find('option[value!=""]').length;P=e.find('input:not([type="radio"],[type="checkbox"])').length;Q=e.find(".trigger").length;R=e.find('[data-relevant]:not([type="radio"],[type="checkbox"])').length;
S=e.find('input[data-relevant][type="radio"],input[data-relevant][type="checkbox"]').parent().parent("fieldset").length;T=e.find('[data-constraint]:not([type="radio"],[type="checkbox"])').length;U=e.find('input[data-constraint][type="radio"],input[data-constraint][type="checkbox"]').parent().parent("fieldset").length;I=e.find("[data-calculate]").length;J=e.find("#jr-preload-items input").length;b!==O+M+N&&console.error(" total select-type filter differs between XML form and HTML form");c+d!==P-I-
J&&console.error(" total amount of input/upload fields differs between XML form and HTML form");q!=Q&&console.error(" total triggers differs between XML form and HTML form");j!=R+S&&console.error(" total amount of branches differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form)");g!=T+U&&console.error(" total amount of constraints differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form). Note that constraints on &lt;trigger&gt; elements are ignored in the transformation and could cause this error too.");
u!=I&&console.error(" total amount of calculated items differs between XML form and HTML formprel");r!=J&&console.error(" total amount of preload items differs between XML form and HTML form");e.find("[name]").each(function(){$.inArray($(this).attr("name"),a)&&a.push($(this).attr("name"))});for(b=0;b<a.length;b++)1>f.b(a[b]).get().length&&console.error("Found name attribute: "+a[b]+" that does not have a corresponding data node. Transformation error or XML form error (relative nodesets perhaps?")};
d.prototype.input={e:function(b){var a=this.f(b.eq(0));return"radio"==a||"checkbox"==a?b.parent("label").parent("fieldset"):"fieldset"==a?b:b.parent("label")},Z:function(b){return 1!==b.length?console.error("getProps(): no input node provided or multiple"):{path:this.getName(b),A:this.wa(b),q:this.f(b),ja:this.xa(b),X:b.attr("data-constraint"),Ba:b.attr("data-relevant"),val:this.i(b),required:void 0!==b.attr("required")?h:l,enabled:this.isEnabled(b),multiple:this.ca(b)}},f:function(b){return 1!==
b.length?"":"input"==b.prop("nodeName").toLowerCase()?0<b.attr("type").length?b.attr("type").toLowerCase():console.error("<input> node has no type"):"select"==b.prop("nodeName").toLowerCase()?"select":"fieldset"==b.prop("nodeName").toLowerCase()?"fieldset":console.error("unexpected input node type provided")},xa:function(b){return 1!==b.length?console.error("getXMLType(): no input node provided or multiple"):b.attr("data-type-xml")},getName:function(b){return 1!==b.length?console.error("getName(): no input node provided or multiple"):
"radio"==this.f(b)?b.attr("data-name"):0<b.attr("name").length?b.attr("name"):console.error("input node has no name")},wa:function(b){var a,c,d;if(1!==b.length)return console.error("getIndex(): no input node provided or multiple");a=this.f(b);c=this.getName(b);d=this.e(b);return("radio"===a&&c!==b.attr("name")?this.e(e.find('[data-name="'+c+'"]')):this.e(e.find('[name="'+c+'"]'))).index(d)},ca:function(b){return"checkbox"==this.f(b)||void 0!==b.attr("multiple")?h:l},isEnabled:function(b){return void 0!==
b.attr("disabled")||0!==b.parents("fieldset:disabled").length?l:h},i:function(b){var a,c=[],d;if(1!==b.length)return console.error("getVal(): no inputNode provided or multiple");a=this.f(b);d=this.getName(b);return"radio"==a?this.e(b).find("input:checked").val()||"":"checkbox"==a?(this.e(b).find('input[name="'+d+'"]:checked').each(function(){c.push($(this).val())}),c):b.val()||""},h:function(b,a,c){a=a||0;if("radio"==this.f(e.find('[data-name="'+b+'"]').eq(0)))return this.e(e.find('[data-name="'+
b+'"]')).eq(a).find('input[value="'+c+'"]').attr("checked",h);b=this.e(e.find('[name="'+b+'"]')).eq(a).find("input, select, textarea");this.ca(b.eq(0))===h&&(c=c.split(" "));return b.val(c)}};d.prototype.J=function(){var b,a,c,d=this;f.b(i,i,{m:h}).get().each(function(){c=$(this).text();b=f.b($(this).prop("nodeName")).get().index($(this));a=d.ua($(this));d.input.h(a,b,c)})};d.prototype.Da=function(){var b,a,c,d=this,f=e.find("#form-languages").attr("data-default-lang");$("#form-languages").detach().insertBefore($("form.jr").parent());
if(!f||""===f)f=$("#form-languages a:eq(0)").attr("lang");console.debug("default language is: "+f);2>$("#form-languages a").length?(e.find("[lang]").addClass("active"),e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")}),this.M()):($("#form-languages a").click(function(f){f.preventDefault();b=$(this).attr("lang");$("#form-languages a").removeClass("active");$(this).addClass("active");e.find("[lang]").removeClass("active").filter('[lang="'+
b+'"], [lang=""]').addClass("active");e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")});e.find("select>option").not('[value=""]').each(function(){a=$(this).attr("value");c=$(this).parent("select").next(".jr-option-translations").children('.active[data-option-value="'+a+'"]').text().trim();c="undefined"!==typeof c&&0<c.length?c:"[MISSING TRANSLATION]";$(this).text(c)});e.find("legend span.active:not(.jr-hint, .jr-constraint-msg), label span.active:not(.jr-hint, .jr-constraint-msg)").each(function(){0===
$(this).text().trim().length&&$(this).text("[MISSING TRANSLATION]")});d.M();e.trigger("changelanguage")}),$('#form-languages a[lang="'+f+'"]').click())};d.prototype.M=function(){var b,a;e.find("*>.jr-hint").parent().each(function(){a="label"!==$(this).prop("nodeName").toLowerCase()&&"fieldset"!==$(this).prop("nodeName").toLowerCase()?$(this).parent("fieldset"):$(this);b=0<a.length?$(this).find(".jr-hint.active").text().trim():$(this).find("span.jr-hint").text().trim();0<b.length?a.find(".question-icons .hint").attr("title",
b).addClass("ui-icon ui-icon-help"):a.find(".question-icons .hint").removeAttr("title").removeClass("ui-icon ui-icon-help")});e.tooltip()};d.prototype.n={set:function(b){e.attr("data-edited",b.toString());e.trigger("edit",b)},get:function(){return"true"===e.attr("data-edited")?h:l}};d.prototype.ga={set:function(b){e.attr("data-stored-with-key",b);e.find("h2 span").text(b)},get:function(){return e.attr("data-stored-with-key")||i},reset:function(){e.removeAttr("data-stored-with-key")}};d.prototype.ha=
{set:function(b){e.attr("data-stored-final",b.toString())},get:function(){return"true"===e.attr("data-stored-final")?h:l},reset:function(){e.removeAttr("data-stored-final")}};d.prototype.S={a:function(){e.on("click",".jr-branch",function(){var b=$(this);$(this).hasClass("busy")||($(this).hasClass("show")?$(this).addClass("busy").removeClass("show").next().hide("blind",{},600,function(){b.removeClass("busy")}):$(this).addClass("busy show").next().show("blind",{},600,function(){b.removeClass("busy");
b.next().o()}))});this.update()},update:function(b){var a,c,d,q,k,j={},u=this;q="undefined"!==typeof b?b.split(","):[];k=0<q.length?[]:["[data-relevant]"];for(b=0;b<q.length;b++)k.push('[data-relevant*="'+q[b]+'"]');e.find(k.join()).each(function(){a=g.input.Z($(this));c=g.input.e($(this));if(!("radio"==a.q||"checkbox"==a.q)||!j[a.path]){if(1!==c.length)return console.error("could not find branch node"),l;try{d=f.evaluate(a.Ba,"boolean",a.path,a.A)}catch(b){return console.error('Serious error occurred trying to evaluate skip logic for node with name: "'+
a.path+'" (message: '+b.message+")"),l}j[a.path]=h;return d===h?u.enable(c):u.disable(c)}})},enable:function(b){b.prev(".jr-branch").hide("slow",function(){$(this).remove()});b.removeClass("disabled").show("blind",{direction:"up"},1E3,function(){$(this).o()});return"label"==b.prop("nodeName").toLowerCase()?b.children("input, select, textarea").removeAttr("disabled"):b.removeAttr("disabled")},disable:function(b){b.addClass("disabled").hide();0===b.prev(".jr-branch").length&&(b.before('<div class="jr-branch ui-corner-all"></div>'),
b.V("change"));return"label"==b.prop("nodeName").toLowerCase()?b.children("input, select, textarea").attr("disabled","disabled"):b.attr("disabled","disabled")}};d.prototype.G=function(b){var a,c,d,g="";console.log("updating active outputs that contain: "+b);c="undefined"!==typeof b?b.split(","):[];d=0<c.length?[]:[".jr-output[data-value]"];for(b=0;b<c.length;b++)d.push('.jr-output[data-value*="'+c[b]+'"]');e.find(":not([disabled]) span.active").find(d.join()).each(function(){try{a=$(this).attr("data-value"),
g=f.evaluate(a,"string")}catch(b){console.error("error occurred trying to evaluate output value from expression: "+a+", (message:"+b.message+")"),g="[ERROR]"}$(this).text(g)});e.o();this.M()};d.prototype.T=function(b){var a,c,d,g,k,j,u;j="undefined"!==typeof b?b.split(","):[];u=0<j.length?[]:["input[data-calculate]"];for(b=0;b<j.length;b++)u.push('input[data-calculate*="'+j[b]+'"]');e.find("#jr-calculated-items").find(u.join()).each(function(){a=$(this).attr("name");c=$(this).attr("data-calculate");
d=$(this).attr("data-type-xml");k=$(this).attr("data-constraint");g=f.evaluate(c,"string",a,i);f.b(a,i).h(g,k,d)})};d.prototype.ma=function(){e.find(".jr-group, .jr-repeat").addClass("ui-corner-all");e.find("h2#form-title").addClass("ui-widget-header ui-corner-all");e.find(".trigger").addClass("ui-state-highlight ui-corner-all");$("fieldset:not(.jr-appearance-compact)>label, fieldset:not(.jr-appearance-compact)>legend").children("img,video,audio").parent().addClass("ui-helper-clearfix with-media")};
d.prototype.Ga={a:function(){this.pa();this.sa();this.Ea();this.ra();this.Aa();this.va();this.la()},pa:function(){e.find(".jr-appearance-compact>label>span").hide()},sa:function(){Modernizr.inputtypes.date||e.find('input[type="date"]').datepicker({})},Ea:function(){Modernizr.inputtypes.time||e.find('input[type="time"]').timepicker({})},ra:function(){Modernizr.inputtypes.datetime||e.find('input[type="datetime"]').datetimepicker()},Ua:function(){e.find("select:not([multiple])").attr("size","1");$("select:not([multiple])").multiselect({multiple:l,
header:"Select one option",noneSelectedText:"Select one option",selectedList:1,position:{my:"left top",at:"left bottom"}})},Ta:function(){e.find("select[multiple]").attr("size","5").find('[value=""]').remove();$("select[multiple]").multiselect({header:"false",position:{my:"left top",at:"left bottom"}})},Aa:function(){e.find('input[readonly]:not([data-type-xml="geopoint"])').parent("label").each(function(){var b=$(this).html(),a=$(this).find("input").attr("data-relevant"),c='name="'+$(this).find("input").attr("name")+
'"';$('<fieldset class="trigger ui-state-highlight ui-corner-all" '+("undefined"!==typeof a?'data-relevant="'+a+'" '+c:c)+"></fieldset>").insertBefore($(this)).append(b).find("input").remove();$(this).remove()})},Pa:m(),ab:m(),$a:m(),va:function(){e.find('input[data-type-xml="geopoint"]').attr("placeholder","Awesome geopoint widget will follow in the future!")},Ia:m(),la:function(){e.find('input[data-type-xml="barcode"]').attr("placeholder","This probably does not require support for browser data entry.")}};
d.prototype.za={a:function(){var b,a,c,d,g=this;e.find("#jr-preload-items input").each(function(){b=$(this).attr("data-preload").toLowerCase();a=$(this).attr("data-preload-params").toLowerCase();c=$(this).attr("name");"undefined"!==typeof g[b]?(d=f.b(c).i(),g.h($(this),g[b]({param:a,l:d,b:$(this)}))):console.error('Preload "'+b+'"" not supported. May or may not be a big deal.')})},h:function(b,a){b.val(a.toString()).trigger("change")},timestamp:function(b){var a=this;return"start"==b.param&&""!==
b.l?""===b.l?b.l:f.evaluate("now()","string"):"end"==b.param?(e.on("beforesave",function(){a.h(b.b,f.evaluate("now()","string"))}),f.evaluate("now()","string")):""},date:function(b){var a,c;return""!==b.l?(a=new Date(f.evaluate("today()","string")),b=x(a.getUTCFullYear().toString(),4),c=x((a.getUTCMonth()+1).toString(),2),a=x(a.getUTCDate().toString(),2),b+"-"+c+"-"+a):b.l},property:n("no property preload in Rapaide"),context:function(b){return"application"==b.param?"rapaide":""},patient:n("not supported in Rapaide"),
user:n("user preload item not functioning yet"),uid:n("no uid"),browser:function(b){if("name"==b.param)return $.browser.webkit?"webkit":$.browser.mozilla?"mozilla":$.browser.opera?"opera":$.browser.msie?"msie":"unknown";if("version"==b.param)return $.browser.version},os:n("not known")};d.prototype.repeat={a:function(){var b,a,c,d,g,k=this;e.find("fieldset.jr-repeat").prepend('<span class="repeat-number"></span>');e.find("fieldset.jr-repeat:not([data-repeat-fixed])").append('<button type="button" class="repeat"></button><button type="button" class="remove"></button>');
e.find("button.repeat").button({text:l,icons:{primary:"ui-icon-plusthick"}});e.find("button.remove").button({disabled:h,text:l,icons:{primary:"ui-icon-minusthick"}});e.on("click","button.repeat:enabled",function(){k.clone($(this).parent("fieldset.jr-repeat"));return l});e.on("click","button.remove:enabled",function(){k.remove($(this).parent("fieldset.jr-repeat.clone"));return l});e.find("fieldset.jr-repeat").each(function(){c=$(this).attr("data-repeat-count")||"";a=0<c.length?parseInt(f.b(c).i(),
10):0;d=f.b($(this).attr("name")).get().length;g=a>d?a:d;for(b=1;b<g;b++)k.clone($(this).siblings().andSelf().last(),"")})},clone:function(b,a){var c,d,g,k,j,u,r=this;if(1!==b.length)return console.error("Nothing to clone"),l;c=b.parent("fieldset.jr-group").children("fieldset.jr-repeat:not(.clone)").eq(0);d=c.clone(l);d.find(".clone").remove();d.addClass("clone");d.find("button.remove").button({text:l,icons:{primary:"ui-icon-minusthick"}});d.find("button.repeat").button({text:l,icons:{primary:"ui-icon-plusthick"}});
d.insertAfter(b).parent(".jr-group").fa();d.hide().show("highlight",{},600);d.V(a);d.find(".invalid input, .invalid select, .invalid textarea").each(function(){r.N($(this))});g=e.find('fieldset.jr-repeat[name="'+b.attr("name")+'"]').index(b);k=[];d.find('input[type="radio"]').each(function(){-1===$.inArray($(this).attr("data-name"),k)&&k.push($(this).attr("data-name"))});for(j=0;j<k.length;j++)u=(new Date).getTime().toString(),d.find('input[type="radio"][data-name="'+k[j]+'"]').attr("name",u);this.ia(c.parent());
c=c.attr("name");0<c.length&&0<=g&&f.oa(c,g);e.trigger("changerepeat");return h},remove:function(b){var a=this,c=b.attr("name"),d=e.find('[name="'+c+'"]').index(b),g=b.parent("fieldset.jr-group");b.hide("drop",{},600,function(){b.remove();g.fa();a.ia(g)});f.b(c,d).remove();e.trigger("changerepeat")},ia:function(b){b="undefined"==typeof b||0===b.length||!b?b=e:b;b.find("button.repeat, button.remove").button("disable").removeClass("ui-state-hover");b.find("fieldset.jr-repeat:last-child > button.repeat").button("enable");
b.find("fieldset.jr-repeat:not(:nth-child(2)) > button.remove").button("enable")}};d.prototype.L=function(){var b,a,c=this;$("form.jr").attr("onsubmit","return false;");e.on("change validate","input, select, textarea",function(d){b=c.input.Z($(this));a="validate"==d.type?b.enabled&&"hidden"!==b.q?f.b(b.path,b.A).c(b.X,b.ja):h:f.b(b.path,b.A).h(b.val,b.X,b.ja);a=b.enabled&&"hidden"!==b.q&&b.required&&1>b.val.length?l:a;if("undefined"!==typeof a&&a!==i)return a===l?c.Ca($(this)):c.N($(this))});e.on("dataupdate",
function(b,a){c.T(a);c.S.update(a);c.G(a)});e.on("change changerepeat",function(){c.n.set(h)});e.on("changerepeat",function(){c.J()});$(window).resize(function(){e.o()});e.on("changelanguage",function(){c.G()})};d.prototype.N=function(a){this.input.e(a).removeClass("invalid ui-state-error")};d.prototype.Ca=function(a){this.input.e(a).addClass("invalid ui-state-error")};d.prototype.ua=function(a){for(var c=[a.prop("nodeName")],a=a.parent();1==a.length&&"#document"!==a.prop("nodeName");)c.push(a.prop("nodeName")),
a=a.parent();return"/"+c.reverse().join("/")};d.prototype.P=function(){var a=this;e.find("fieldset:disabled input, fieldset:disabled select, fieldset:disabled textarea, input:disabled, select:disabled, textarea:disabled").each(function(){a.N($(this))});e.find("input, select, textarea").trigger("validate");return this.B()};d.prototype.B=function(){return 0<e.find(".invalid").length?l:h}}s.prototype.K=m();var A=jQuery;
A.fn.fa=function(){this.each(function(){A(this).find("fieldset.jr-repeat").each(function(){var a,c,d;0===A(this).prev("fieldset.jr-repeat").length&&(a=A(this).siblings("fieldset.jr-repeat"),c=a.length+1,1<c?(A(this).find("span.repeat-number").text("1"),d=2,a.each(function(){A(this).find("span.repeat-number").text(d);d++})):A(this).find("span.repeat-number").empty())})})};
A.fn.V=function(a){a=a||"edit";this.each(function(){A(this).find("input, select, textarea").each(function(){var c=A(this).attr("type");"SELECT"===A(this).prop("nodeName").toUpperCase()&&(c="select");"TEXTAREA"===A(this).prop("nodeName").toUpperCase()&&(c="textarea");switch(c){case "date":case "number":case "search":case "color":case "range":case "url":case "email":case "password":case "text":case "file":case "hidden":case "textarea":A(this).val("").trigger(a);break;case "radio":case "checkbox":A(this).prop("checked")&&
(A(this).prop("checked",l),A(this).trigger(a));break;case "select":A(this)[0].selectedIndex=-1;A(this).trigger(a);break;default:console.error("Unrecognized input type found when trying to reset: "+c)}})})};A.fn.o=function(){var a;this.each(function(){A(this).find("legend + label").each(function(){a=0<A(this).prev().find(".jr-constraint-msg.active").length&&36>A(this).prev().height()?36:19>A(this).prev().height()?19:A(this).prev().height();A(this).animate({"margin-top":a+6+"px"},600)})})};
A.fn.Q=function(a){var c,d,a=a.replace(/\/\//g," "),a=a.replace(/^\//,""),a=a.replace(/\/\.$/,""),a=a.replace(/\//g,">"),a=a.replace(/\[([^@].*?)\]/g,function(a,c){return":has("+c+")"});if(0<=a.indexOf(">..")){a=a.split(/>\.\.>?/g);c=jQuery(a[0],this);for(d=1;d<a.length;d++)c=c.parent(a[d]);return c.get()}return this.find(a)};/*
 Copyright 2012 Martijn van de Rijdt

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var C,D,E,F,G='There were errors. Please see the "report" tab for details.',H=l;
$(document).ready(function(){F=new K;F.a();E=console.error;console.error=function(){var a=arguments[0];1!==$("#jserrors div ol").length&&$("#jserrors div").append("<ol></ol>");$("#jserrors div ol").append('<li class="error"><span class="ui-icon ui-icon-alert"></span>'+a+"</li>");w(G);return E.apply(console,arguments)};F.source||($("#html5-form-source").hide(),$('li a[href="#html5-form-source"]').parent("li").remove());$("#tabs").tabs();$('li a[href="#upload"]').parent("li").hide();D=$("ul.ui-tabs-nav");
D.hide();w("This is an incomplete pre-alpha preview to test the JavaRosa form functionality in Google Chrome. It is not ready for actual use.",3);$(".main .ui-tabs-nav").removeClass("ui-widget-header");$(".main h2").addClass("ui-widget-header ui-corner-all");p.O();$('#upload-form [name="xml_file"]').change(function(){$("#upload-form").submit()});$("#upload-form").ajaxForm({dataType:"xml",beforeSubmit:function(a,c){var d=c.find('input[name="server_url"]').val()||"",f=c.find('input[name="form_id"]').val()||
"";if(d!=="")if(L(d)){F.d=d;V(F)}else{p.alert("Not a valid server url");W();return l}if(f!==""){F.id=f;V(F)}$("#upload-form label, #input-switcher, #form-list, #upload .hurry").hide();$("#upload-form img.loading").show()},success:X,error:function(){w("Sorry, an error occured while communicating with the Enketo server.");W()}});$("#upload-form #input-switcher a").hover(function(){$(this).toggleClass("ui-state-hover")}).click(function(a){console.debug("input switcher link clicked");a.preventDefault();
$("#upload-form label").hide().find('input[name="'+$(this).attr("id")+'"]').parents("label").show();$(this).siblings().removeClass("active");$(this).addClass("active")});$("#data-template-show input").change(function(){H=$(this).is(":checked")?h:l;Y()});$(document).on("click","#form-list a",function(a){var c=$(this).attr("id");a.preventDefault();$('#upload-form input[name="form_id"]').val(c);$("#upload-form").submit()});$("#html5-form-source form").submit(function(){var a,c=$(this),d=c.attr("action"),
c='<!DOCTYPE html><html><head><meta charset="utf-8" /><title></title></head><body>'+c.find('textarea[name="content"]').val()+"</body></html>",f=new FormData;f.append("level","error");f.append("content",c);$("#html5validationmessages div").html('<img class="loading" src="images/ajax-loader.gif" />');$.ajax(d,{type:"POST",data:f,contentType:l,processData:l,success:function(c){var d=$("<div></div>");d.append(c.replace(/<script[A-z =".]*><\/script>/gi,""));d.find("ol:not(.source) li>*:first-child").each(function(){a=
$(this).parent("li").attr("class");$(this).addClass(a)});Z(d.find("p.success, ol:not(.source) li>*:first-child"),$("#html5validationmessages div"));$("#html5validationmessages div li.info").hide()},error:function(){$("#html5validationmessages div").empty().append('<ol><li class="info"><span class="ui-icon ui-icon-info"></span>This validation is currently not functional</li></ol>')}});return l});$("#upload-form #input-switcher a#server_url").click();$("#dialog-launch form").submit(function(a){a.preventDefault();
console.debug("in ajax submit");$.ajax("launch/launchSurvey",{type:"POST",data:$(this).serialize(),error:function(){console.debug("an error occurred when sending survey launch data")},success:function(a){a=JSON.parse(a);console.log("form submission complete");if(a.success)p.alert('Form was succesfully launched at this address: <a class="launch-link" href="'+a.url+'">'+a.url+"</a>","Success!","ui-icon-check");else switch(a.reason){case "existing":p.alert('This survey was launched before at this address: <a class="launch-link" href="'+
a.url+'">'+a.url+"</a>","Exists already!","ui-icon-lightbulb");break;case "empty":p.alert("Server url and/or form id submitted to the server found to be empty.","Failed");break;case "database":p.alert("Problem occurred trying to add survey details to Enketo database to launch.","Failed");break;default:p.alert("Unknown error","Failed")}}})});F.d&&($('#upload-form input[name="server_url"]').val(F.d),F.id&&$('#upload-form input[name="form_id"]').val(F.id),$("#upload-form").submit())});
function K(){}K.prototype.a=function(){var a=h,c=decodeURIComponent(decodeURI(t("server")));this.d=c&&L(c)?c:i;this.id=t("id")||i;this.source=t("source")||l;this.debug=t("debug")||l;V(F);$(window).on("popstate",function(){a||(window.location=location.href);a=l});setTimeout(function(){a=l},5E3)};
function V(a){var c={d:a.d,id:a.id,source:a.source,debug:a.debug},d="",f="launch",d=a.d!==i&&L(a.d)?d+"server="+encodeURIComponent(a.d):d,d=a.id!==i?d+"&id="+encodeURIComponent(a.id):d,d="true"==a.source||a.source===h?d+"&source="+encodeURIComponent(a.source):d,d="true"==a.debug||a.debug===h?d+"&debug="+encodeURIComponent(a.debug):d,d="&"==d.substring(0,1)?d.substring(1):d,f=0<d.length?f+"?"+d:f;location.href!==location.protocol+"//"+location.hostname+"/"+f&&(console.debug("pushing history state "),
console.debug(location.href),console.debug(location.hostname+"/"+f),console.debug(c),history.pushState(c,"Enketo Launch",f))}K.prototype.reset=function(){this.id=this.d=i;V(this)};
s.prototype.K=function(){$("button#reset-form").button({icons:{primary:"ui-icon-refresh"}}).click(function(){W()});$("button#validate-form").button({disabled:h,text:l,icons:{primary:"ui-icon-check"}}).click(function(){"undefined"!==typeof C&&C.Fa()});$("button#launch-form").button({disabled:h,icons:{primary:"ui-icon-arrowthick-1-e"}}).click(function(){var a=p,c=$("#dialog-launch");a.confirm({dialog:"launch",da:"Please provide the relevant details below to launch your survey.",heading:"Launch Parameters"},
{I:"Ok",D:"Cancel",H:function(){var a=c.find('[name="data_url"]').val();0<a.length&&!L(a)?(console.log("not a valid publication link"),c.find(".dialog-error").text("not a valid data url")):(c.find(".dialog-error").text(""),c.find("form").submit())},C:n(l),z:function(){c.find('[name="server_url"]').val(F.d);c.find('[name="form_id"]').val(F.id)}})});$("#form-controls button:not(#validate-form)").ta();$("#dialog-launch a.advanced").click(function(a){a.preventDefault();$(this).hasClass("active")?$(this).text("show advanced options").removeClass("active").siblings("fieldset.advanced").hide():
$(this).text("hide advanced options").addClass("active").siblings("fieldset.advanced").show()})};function L(a){return/^(https?:\/\/)?([\da-z\.\-]+)\.([a-z\.]{2,6})([\/\w \.\-]*)*\/?[\/\w \.\-\=\&\?]*$/.test(a)}
function W(){F.reset();$("#upload-form")[0].reset();$('#upload-form input[type="hidden"]').val("");$("#upload-form img.loading, #form-list").hide();$("#input-switcher, #upload .hurry").show().find("a#server_url").click();$("#form-languages").remove();p.updateStatus.Y(l);$("#survey-form div, #xsltmessages div, #html5validationmessages div, #jrvalidationmessages div, #xmlerrors div, #xslerrors div, #html5-form-source textarea, #data textarea").empty();C=i;$("#validate-form, #launch-form").button("disable");
$('#tabs li a[href="#upload"]').click();D.hide()}
function X(a){var c=$(a);if(0<c.find("formlist").length){var d="";0===c.find("formlist>li").length?(w("Formlist at server "+F.d+" was found to be empty or the server is asleep."),W()):(c.find("formlist>li").each(function(){d+=(new XMLSerializer).serializeToString($(this)[0])}),$("#form-list ol").empty().append(d),$("#form-list ol li a").button(),$("#upload-form img.loading").hide(),$("#form-list").show())}else{D.show();var a=(new XMLSerializer).serializeToString(c.find("form")[0]),f=(new XMLSerializer).serializeToString(c.find("instance")[0]),
g=c.find("xsltmessages message"),e=c.find("jrvalidationmessages message"),j=c.find("xmlerrors message"),c=c.find("xslformerrors message, xsldataerrors message");$("#upload-form img.loading").hide();0<a.length?($("#html5-form-source textarea").empty().text(vkbeautify.xml(a)),$("#html5-form-source form").submit(),$("#survey-form div").empty().append(a),C=new z(f),C.a(),$('#tabs li a[href="#survey-form"]').click(),$(document).on("change dataupdate","form.jr",Y),$("#validate-form, #launch-form").button("enable")):
($("#survey-form div").empty(),$('#tabs li a[href="#report"]').click());C&&0<C.p().length?Y():$("#data div").text("An error occurred whilst trying to extract the data.");C&&(0<C.p().length&&0===g.length)&&(g=$('<message class="success">Nothing reported back. A good sign if there are no other errors!</message>'));Z(g,$("#xsltmessages div"));0===e.length&&(e=$('<message class="info">Something went wrong</message>'));Z(e,$("#jrvalidationmessages div"));0===j.length&&(j=$('<message class="success">Valid XML document!</message>'));
Z(j,$("#xmlerrors div"));0<c.length&&c.each(function(){console.error("XSLT stylesheet error: "+$(this).text())});C&&(0<C.p().length&&0<$("#report .level-2, #report .level-3").length)&&w(G)}}function Y(){if(C){var a=C.p(H);$("#data textarea").empty().text(vkbeautify.xml(a))}}
function Z(a,c){var d=$("<ol></ol>");a.each(function(){var a="",c="",e=$(this).text(),j={"level-0":"info",info:"info","info warning":"info",success:"circle-check","level-1":"info","level-2":"alert",error:"alert","level-3":"alert"},a=a+($(this).attr("level")?"level-"+$(this).attr("level"):$(this).attr("class")),c=j[a]?"ui-icon ui-icon-"+j[a]:c,a='<li class="'+a+'"><span class="'+c+'"></span>'+e+"</li>";0===d.find("li").filter(function(){return $(this).text()==e}).length&&d.append(a)});c.empty().append(d)}
;