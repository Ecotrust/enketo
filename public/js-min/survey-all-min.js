var h=!0,i=null,m=!1;function n(){return function(){}}function o(a){return function(){return a}}var q,r,s={};$(document).ready(function(){r=new t;r.a();"undefined"==typeof console&&(console={log:n()});"undefined"==typeof window.console.debug&&(console.debug=console.log);var a;a:{a=window.location.search.substring(1).split("&");for(var c=0;c<a.length;c++){var d=a[c].split("=");if("debug"==d[0]){a=encodeURI(d[1]);break a}}a=m}"true"!==a&&(window.console.log=n(),window.console.debug=n())});
function t(){}q=t.prototype;q.a=function(){this.ma.X();v(this).a();this.T();"function"===typeof this.S&&this.S();Modernizr.borderradius&&(Modernizr.boxshadow&&Modernizr.csstransitions&&Modernizr.opacity)&&$(document).trigger("browsersupport","fancy-visuals");$("footer").detach().appendTo("#container")};q.X=function(){$(window).trigger("resize")};
q.T=function(){var a=this;$("#feedback-bar-close").button({icons:{primary:"ui-icon-closethick"},text:m}).click(function(a){a.preventDefault();$("#feedback-bar p").remove();$("#feedback-bar").trigger("change")});$("#page-close").button({icons:{primary:"ui-icon-closethick"},text:m}).click(function(c){c.preventDefault();v(a).close()});$("#feedback-bar-close, #page-close").removeClass().addClass("custom-button ui-widget-header ui-corner-all");$(document).on("click",'a[href^="#"]:not(nav ul li a)',function(a){var d=
$(this).attr("href");console.log("captured click to internal link that is not in nav, href="+d);"#"!==d&&(a.preventDefault(),$('nav li a[href="'+d+'"]').click())});$('nav ul li a[href^="#"]').click(function(c){c.preventDefault();c=$(this).attr("href").substr(1);v(a).open(c);$(this).closest("li").addClass("nav-state-active")});$(window).on("onlinestatuschange",function(c,d){a.updateStatus.Ba(d)});$(document).on("edit","form.jr",function(c,d){a.updateStatus.Fa(d)});$(document).on("browsersupport",function(c,
d){a.updateStatus.support(d)});$("#page, #feedback-bar").on("change",function(){a.display()});$("header #status-connection").click(function(a){x($(this).attr("title"));a.stopPropagation()});$(window).resize(function(){$("#container").css("top",$("header").outerHeight());$("body:not(.no-scroll) #container").height($(window).height()-$("header").outerHeight()-$("#form-controls.bottom").outerHeight());var a=$("nav").offset().left,d=$("#logo").offset().left+$("#logo").outerWidth();a<d?$("#logo").css("visibility",
"hidden"):$("#logo").css("visibility","visible")})};q.ma={X:function(){$("article.page").each(function(){var a,c="",d;d=$(this).attr("id");a=$(this).attr("data-display")?$(this).attr("data-display"):d;c=$(this).attr("data-title")?$(this).attr("data-title"):d;d=$(this).attr("data-ext-link")?$(this).attr("data-ext-link"):"#"+d;$('<li class="ui-corner-tl ui-corner-tr"><a href="'+d+'" title="'+c+'" >'+a+"</a></li>").appendTo($("nav ul"))})},reset:function(){$("nav ul li").removeClass("nav-state-active")}};
function v(a){a.a=function(){this.J=$("<pages></pages>");$("article.page").detach().appendTo(this.J)};a.get=function(a){var d=this.J.find('article[id="'+a+'"]');return d=0<d.length?d:$('article[id="'+a+'"]')};a.C=function(a){return 0<$("#page article.page"+("undefined"!==typeof a?'[id="'+a+'"]':"")).length};a.open=function(a){var d;if(!this.C(a)){d=this.get(a);if(1!==d.length)return console.error("page not found");this.C()&&this.close();$("#page-content").prepend(d.show()).trigger("change");$("#overlay").show();
setTimeout(function(){d.find(".scroll-list").ta();$("#overlay, header").bind("click.pageEvents",function(){$("#page-close").trigger("click")})},50);$(window).bind("resize.pageEvents",function(){$("#page").trigger("change")})}};a.close=function(){var a;a=$("#page .page").detach();this.J.append(a);$("#page").trigger("change");this.ma.reset();$("#overlay").hide();$("#overlay, header").unbind(".pageEvents");$(window).unbind(".pageEvents")};return a}
function x(a,c){var d,c=c?1E3*c:1E4;$("#feedback-bar p").eq(1).remove();$("#feedback-bar p").html()!==a&&(d=$("<p></p>"),d.text(a),$("#feedback-bar").prepend(d));$("#feedback-bar").trigger("change");setTimeout(function(){typeof d!=="undefined"&&d.remove();$("#feedback-bar").trigger("change")},c)}
q.alert=function(a,c){var d,f=$("#dialog-alert"),c=c||"Alert";d=function(){f.dialog("destroy");f.find("#dialog-alert-msg").text("")};f.find("#dialog-alert-msg").html(a).L();f.dialog({title:c,modal:h,resizable:m,buttons:{Ok:d},beforeClose:d,width:500})};
q.confirm=function(a,c,d){var f,g,e,j=$("#dialog-confirm"),d=d||"Are you sure?",c="undefined"==typeof c?{g:"Confirm",h:"Cancel"}:c;c.g=c.g||"Confirm";c.h=c.h||"Cancel";c.i=c.i||n();c.u=c.u||n();f=c.i;g=c.u;e=function(){j.dialog("destroy");j.find("#dialog-confirm-msg").text("")};j.find("#dialog-confirm-msg").text(a||"Please confirm action").L();j.dialog({title:d,resizable:m,modal:h,buttons:[{text:c.g,click:function(){f.call();e.call()}},{text:c.h,click:function(){g.call();e.call()}}],beforeClose:e})};
q.updateStatus={Ba:function(a){console.log("updating online status in menu bar to:");console.log(a);a?$("header #status-connection").removeClass().addClass("ui-icon ui-icon-signal-diag").attr("title","It appears there is currently an Internet connection available."):$("header #status-connection").removeClass().addClass("ui-icon ui-icon-cancel").attr("title","It appears there is currently no Internet connection")},Fa:function(a){a?$("header #status-editing").removeClass().addClass("ui-icon ui-icon-pencil").attr("title",
"Form is being edited."):$("header #status-editing").removeClass().attr("title","")},support:function(a){var c=v(r).get("settings");0<c.length&&(console.debug("updating browser support for "+a),c.find("#settings-browserSupport-"+a+" span.ui-icon").addClass("ui-icon-check"))}};
q.display=function(){var a,c;c=$("header");var d=$("#feedback-bar"),f=$("#page");0<d.find("p").length?(a=c.outerHeight(),c=v(this).C()?c.outerHeight()+d.outerHeight():c.outerHeight()+d.outerHeight()-f.outerHeight()):(a=c.outerHeight()-d.outerHeight(),c=v(this).C()?c.outerHeight():c.outerHeight()-f.outerHeight());d.css("top",a);f.css("top",c)};function y(a,c){for(var d=a;d.length<c;)d="0"+d;return d}var A=jQuery;A.fn.Ga=function(){var a=0;this.each(function(){A(this).width()>a&&(a=A(this).width())}).each(function(){A(this).width(a)})};
A.fn.reverse=[].reverse;
A.fn.Z=function(a){a=A.extend({ka:"!@#$%^&*()+=[]\\';,/{}|\":<>?~`.- ",k:"",K:""},a);this.each(function(){a.jb&&(a.k+="ABCDEFGHIJKLMNOPQRSTUVWXYZ");a.ab&&(a.k+="abcdefghijklmnopqrstuvwxyz");for(var c=a.K.split(""),d=0;d<c.length;d++)-1!=a.ka.indexOf(c[d])&&(c[d]="\\"+c[d]);a.K=c.join("|");var f=a.ka+a.k,f=f.replace(RegExp(a.K,"gi"),"");A(this).keypress(function(a){var e;e=a.charCode?String.fromCharCode(a.charCode):String.fromCharCode(a.which);f.indexOf(e)!=-1&&a.preventDefault();a.ctrlKey&&e=="v"&&
a.preventDefault()});A(this).bind("contextmenu",o(m))})};A.fn.kb=function(a){var c="abcdefghijklmnopqrstuvwxyz",c=c+c.toUpperCase(),a=A.extend({k:c},a);return this.each(function(){A(this).Z(a)})};A.fn.alpha=function(a){a=A.extend({k:"1234567890"},a);return this.each(function(){A(this).Z(a)})};
A.fn.L=function(){var a;a||(a=1);var c=this.contents().filter(function(){return 3==this.nodeType}).first(),d=c.text();a=d.split(" ",a).join(" ");c.length&&(c[0].nodeValue=d.slice(a.length),c.before('<span class="capitalize">'+a+"</span>"))};
A.fn.ta=function(){this.each(function(){var a=A(this),c=A(this).find("ol");a.css("overflow","hidden");var d=c.height()-a.height();if(0<d){var f=d/c.height(),f=Math.round((1-f)*a.height()),f=f-f%2;A("#records .column.middle").html('<div id="slider-wrap" class="ui-corner-all"><div id="slider-vertical"></div></div>');A("#slider-wrap").height(a.outerHeight());A("#slider-vertical").slider({orientation:"vertical",lb:"max",min:0,max:100,value:100,pb:function(a,e){c.css({top:-((100-e.value)*d/100)})}});A("#slider-wrap").css("margin-top",
A("#records-saved h3").outerHeight(h));A(".ui-slider-handle").css({height:f,"margin-bottom":-0.5*f});a=A("#slider-vertical").height();f=a-f;a=0.5*(a-f);A(".ui-slider").css({height:f,"margin-top":a});A(".ui-slider-range").css({top:-a});A("#slider-wrap").click(function(){A("#slider-vertical").slider("value",0);c.css({top:-d})})}})};function aa(){function a(a){var d;for(d=0;d<c.length;d++)if(a===c[d])return h;return m}var c="__settings null __history Firebug undefined __bookmark __counter".split(" "),d=window.localStorage;this.isSupported=function(){try{return"localStorage"in window&&window.localStorage!==i}catch(a){return m}};this.hb=function(){return c};this.V=function(c,g,e,j,b){if(!c||1>c.length)return console.error("no key provided for record"),"require";c=c.trim();b="string"===typeof b?b.trim():i;j="undefined"!==typeof j&&
j===h?h:m;if("string"===typeof g.data&&a(c))return"forbidden";if("string"===typeof g.data&&b!==c&&d.getItem(c)&&j!==h)return"existing";try{return"string"===typeof g.data&&(g.t=(new Date).getTime(),d.setItem("__counter",JSON.stringify({counter:this.getCounterValue()}))),d.setItem(c,JSON.stringify(g)),console.debug("saved: "+c+", old key was: "+b),b!==i&&(""!==b&&b!==c)&&e&&(console.log("going to remove old record with key:"+b),this.Q(b)),"success"}catch(k){return console.log("error in store.setRecord:"+
k.message),"error"}};this.s=function(a){var c;try{return c=JSON.parse(d.getItem(a))}catch(e){return console.log("error with loading data from store: "+e.message),i}};this.Q=function(a){try{return d.removeItem(a),h}catch(c){return console.log("error with removing data from store: "+c.message),m}};this.A=function(){var a,c,e=[],d=this.ia(m);for(a=0;a<d.length;a++)c=d[a],c.ready="true"===c.ready||c.ready===h?h:m,e.push({key:c.key,ready:c.ready,t:c.t});e.sort(function(b,a){return a.t-b.t});return e};
this.ia=function(c,g){var e,j,b=[],k={},c=c||m,g=g||i;for(e=0;e<d.length;e++)if(j=d.key(e),k=d.getItem(j),!a(j))try{k=JSON.parse(k),k.key=j,j!==g&&(!c||"true"===k.ready||k.ready===h)&&b.push(k)}catch(z){console.log("record found that was probably not in the correct JSON format (e.g. Firebug settings or corrupt record) (error: "+z.message+"), record was ignored")}return b};this.ha=function(a,c){var e,d,b=[];d=this.ia(a||h,c);for(e=0;e<d.length;e++)b.push({name:d[e].key,data:d[e].data});return b};this.Na=
function(a){for(var c=this.ha(a),e=[],a=0;a<c.length;a++)e.push(c[a].data);return 0<e.length?"<exported>"+e.join("")+"</exported>":i};this.getCounterValue=function(){var a=this.s("__counter");return y(((a&&"undefined"!==typeof a.counter&&!isNaN(parseFloat(a.counter))&&isFinite(a.counter)?Number(a.counter):0)+1).toString(),4)}}function B(){}B.prototype.a=function(){var a=this.get();$(document).trigger("setsettings",a)};B.prototype.get=function(){return C.s("__settings")||s};
function D(){var a=C.s("__settings")||s;return"undefined"!==typeof a.autoUpload?a.autoUpload:i}B.prototype.set=function(a,c){var d;d=this.get();console.debug("going to store setting: "+a+" with value:"+c);d[a]=c;d=C.V("__settings",d);if("undefined"!==typeof this[a])this[a](c);return"success"===d?h:console.error("error storing settings")};function G(a){function c(b){function a(b,c,d){this.n="undefined"!==typeof b&&b?b:"*";this.filter=d="undefined"!==typeof d&&d!==i?d:{};this.filter.F="undefined"!==typeof d.F?d.F:h;this.filter.O="undefined"!==typeof d.O?d.O:m;this.filter.G="undefined"!==typeof d.G?d.G:m;this.filter.v="undefined"!==typeof d.v?d.v:m;this.index=c}var c,d=this,b=b.replace(/<[\/]?instance(>|\s+[^>]*>)/gi,"");this.xml=$.parseXML(b);this.I=c=$(this.xml);XPathJS.bindDomLevel3XPath();this.b=function(b,c,d){return new a(b,c,
d)};a.prototype.get=function(){var b,a;b=this.filter.G===h?c.Y(this.n).filter("[template]"):this.filter.F===h?c.Y(this.n).not("[template], [template] *"):c.Y(this.n);this.filter.v===h?b=b.filter(function(){a=$(this).text();return 0===$(this).children().length&&0<a.trim().length}):this.filter.O===h&&(b=b.filter(function(){return 0===$(this).children().length}));return b="undefined"!==typeof this.index&&this.index!==i?b.eq(this.index):b};a.prototype.l=function(b,a,c){var d,k;k=this.m().join(" ");b=
"undefined"!==typeof b?$.isArray(b)?b.join(" "):b:"";b=this.q(b,c);d=this.get();if(1===d.length&&b.toString().trim()!==k.toString().trim())return d.text(b),b=this.d(a,c),e.trigger("dataupdate",d.prop("nodeName")),b;if(1<d.length)return console.error("nodeset.setVal expected nodeset with one node, but received multiple"),i;0===d.length&&console.error("Data node: "+this.n+" with null-based index: "+this.index+" not found!");return i};a.prototype.m=function(){var b=[];this.get().each(function(){b.push($(this).text())});
return b};a.prototype.clone=function(b){var a,c;a=this.get();b=b||a;1===a.length&&1===b.length?(a.clone().insertAfter(b).find("*").andSelf().removeAttr("template"),c=[a.prop("nodeName")],a.find("*").each(function(){c.push($(this).prop("nodeName"))}),e.trigger("dataupdate",c.join())):console.error("node.clone() function did not receive origin and target nodes")};a.prototype.remove=function(){var b=this.get();0<b.length?(b.remove(),e.trigger("dataupdate",b.prop("nodeName"))):console.error("could not find node "+
this.n+" with index "+this.index+"to remove ")};a.prototype.q=function(b,a){return""===b.toString()?b:"undefined"!==typeof a&&a!==i&&"undefined"!==typeof this.types[a.toLowerCase()]&&"undefined"!==typeof this.types[a.toLowerCase()].q?this.types[a.toLowerCase()].q(b):b};a.prototype.d=function(b,a){var c,e;c=this.m();if(""===c.toString())return h;if("undefined"==typeof a||a===i||"undefined"==typeof this.types[a.toLowerCase()])console.error("data type "+a+" set to string"),a="string";c=this.types[a.toLowerCase()].d(c);
e="undefined"!==typeof b&&b!==i&&0<b.length?d.evaluate(b,"boolean",this.n,this.index):h;return c&&e};a.prototype.types={string:{d:o(h)},select:{d:o(h)},select1:{d:o(h)},decimal:{d:function(b){return!isNaN(b-0)&&b!==i?h:m}},"int":{d:function(b){return!isNaN(b-0)&&b!==i&&Math.round(b)==b?h:m}},date:{d:function(b){return"Invalid Date"!==(new Date(b.toString())).toString()},q:function(b){b=new Date(b);b.setUTCHours(0,0,0,0);return(new Date(b)).toUTCString()}},datetime:{d:function(b){return"Invalid Date"!==
(new Date(b)).toString()}},time:{d:function(b){return"Invalid Date"!==(new Date("2012-01-01 "+b)).toString()},q:function(b){b=new Date("2012-01-01 "+b);return y(b.getHours().toString(),2)+":"+y(b.getMinutes().toString(),2)+":"+y(b.getSeconds().toString(),2)}},barcode:{d:o(h)},geopoint:{d:o(h)},binary:{d:o(h)}}}function d(b){e=$(b)}var f,g,e,j;this.eb=function(b,a,c,d){return f.evaluate(b,a,c,d)};this.ob=function(){return g.R()};this.fb=function(){return f.get()};this.data=function(b){return new c(b)};
this.form=function(b){return new d(b)};this.gb=function(){return f.ja()};this.H=function(){return g.H()};this.a=function(){j=$("form.jr:eq(0)").clone().appendTo("<original></original>");f=new c(a);f.a();g=new d("form.jr:eq(0)");g.a()};this.Ka=function(){return f.ga(h,h)};this.M=function(){return g.oa.get()};this.qa=function(b){g.oa.set(b)};this.Ma=function(){return g.pa.get()};this.Wa=function(b){g.pa.set(b)};this.Ta=function(){g.w.set(m)};this.ea=function(){return g.w.get()};this.reset=function(){$("#form-languages").remove();
e.replaceWith(j)};this.d=function(){return g.H()};this.D=function(){return g.D()};c.prototype.a=function(){var b,a;this.b(i,i,{v:h,F:m}).get().each(function(){a=$(this).text();$(this).text(a.trim())});b=this.b(":first",0).get();this.namespace=b.attr("xmlns");b.removeAttr("xmlns");this.ca()};c.prototype.za=function(b,a){var c,d,e=this.b(b,0,{G:h}),e=0===e.get().length?this.b(b,0):e;d=e.get().prop("nodeName");c=this.b(b,a).get();1===e.get().length&&1===c.length&&c.next().prop("nodeName")!==d?e.clone(c):
c.next().prop("nodeName")!==d&&console.error("Could not find template node and/or node to insert the clone after")};c.prototype.ca=function(b){var a=this;if("undefined"==typeof b||0===b.length)b=this.I.find(":first");b.children("[template]").each(function(){"undefined"==typeof $(this).parent().attr("template")&&0===$(this).siblings($(this).prop("nodeName")).not("[template]").length&&$(this).clone().insertAfter($(this)).find("*").andSelf().removeAttr("template")});b.children().not("[template]").each(function(){a.ca($(this))})};
c.prototype.get=function(){return this.I||i};c.prototype.ja=function(){return this.xml||i};c.prototype.ga=function(b,a){var c,b="undefined"!==typeof b?b:m,a="undefined"!==typeof a?a:h;c=$("<root></root");this.I.find(":first").clone().appendTo(c);b===m&&c.find("[template]").remove();a===h&&("undefined"!==typeof this.namespace&&0<this.namespace.length)&&c.children().eq(0).attr("xmlns",this.namespace);c=(new XMLSerializer).serializeToString(c.children().eq(0)[0]);c=c.replace(/xmlns\=\"[A-z0-9\:\/\.\-\%\_\?&amp;]*\"/gi,
" ");return c=c.replace(/\t/g,"")};c.prototype.Pa=function(b,a){var c,d,e,f=b;for(c=0;c<a.length;c++)d=a.eq(c).attr("name"),e=a.eq(c).siblings('[name="'+d+'"]').andSelf().index(a.eq(c)),f=f.replace(d,d+"["+(e+1)+"]");return f};c.prototype.evaluate=function(b,a,d,f){var g,l,j,a=a||"any",f=f||0;g=new c(this.ga(m,m));"undefined"!==typeof d||d!==i?(g=g.b(d,f,{}).get()[0],0<e.find('[name="'+d+'"]').parents(".jr-repeat").length&&(d=e.find('[name="'+d+'"]').eq(f).parents(".jr-repeat"),b=this.Pa(b,d))):g=
g.ja();d={"0":["any","ANY_TYPE"],1:["number","NUMBER_TYPE","numberValue"],2:["string","STRING_TYPE","stringValue"],3:["boolean","BOOLEAN_TYPE","booleanValue"],7:["nodes","ORDERED_NODE_SNAPSHOT_TYPE"],9:["node","FIRST_ORDERED_NODE_TYPE"]};for(l in d)if(l=Number(l),d[l][0]==a)break;else l=0;b=b.replace(/&lt;/g,"<");b=b.replace(/&gt;/g,">");b=b.replace(/&quot;/g,'"');try{j=document.evaluate(b,g,i,l,i);if(0===l){for(l in d)if(l=Number(l),l==Number(j.resultType))return j=0<l&&4>l?j[d[l][2]]:j,console.debug("evaluated "+
b+" to: "+j),j;console.error("Expression: "+b+" did not return any boolean, string or number value as expected")}console.debug("evaluated "+b+" to: "+j[d[l][2]]);return j[d[l][2]]}catch(u){console.error("Error occurred trying to evaluate: "+b+", message: "+u.message)}};d.prototype.a=function(){var b;this.ya();if("undefined"==typeof f||!(f instanceof c))return console.error("variable data needs to be defined as instance of DataXML");e.find('label>input[type="checkbox"], label>input[type="radio"]').parent().parent("fieldset").prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');
e.parent().find("label>select, :not(#jr-preload-items, #jr-calculated-items)>label>input").not('[type="checkbox"], [type="radio"]').parent().prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');e.find('label>input[type="checkbox"][required], label>input[type="radio"][required]').parent().parent("fieldset").find(".question-icons .required").addClass("ui-icon ui-icon-notice");e.parent().find("label>select[required], :not(#jr-preload-items, #jr-calculated-items)>label>input[required]").not('[type="checkbox"], [type="radio"]').parent().find(".question-icons .required").addClass("ui-icon ui-icon-notice");
e.find('input[type="radio"]').each(function(){b=$(this).attr("name");$(this).attr("data-name",b)});e.find("h2").first().append("<span/>");this.repeat.a();this.R();this.wa();this.$a.a();this.$.a();this.aa();this.P();this.T();this.Qa.a();this.Va();this.w.set(m)};d.prototype.ya=function(){var b,a=[],c,d,g,j,p,u,w,Q,R,S,T,U,V,W,X,Y,K,L;w=e.find("#stats");b=parseInt(w.find('[id="jrItem"]').text(),10);c=parseInt(w.find('[id="jrInput"]').text(),10);d=parseInt(w.find('[id="jrUpload"]').text(),10);g=parseInt(w.find('[id="jrTrigger"]').text(),
10);j=parseInt(w.find('[id="jrConstraint"]').text(),10);p=parseInt(w.find('[id="jrRelevant"]').text(),10);u=parseInt(w.find('[id="jrCalculate"]').text(),10);w=parseInt(w.find('[id="jrPreload"]').text(),10);Q=e.find('input[type="radio"]').length;R=e.find('input[type="checkbox"]').length;e.find("select");S=e.find('option[value!=""]').length;T=e.find('input:not([type="radio"],[type="checkbox"])').length;U=e.find(".trigger").length;V=e.find('[data-relevant]:not([type="radio"],[type="checkbox"])').length;
W=e.find('input[data-relevant][type="radio"],input[data-relevant][type="checkbox"]').parent().parent("fieldset").length;X=e.find('[data-constraint]:not([type="radio"],[type="checkbox"])').length;Y=e.find('input[data-constraint][type="radio"],input[data-constraint][type="checkbox"]').parent().parent("fieldset").length;K=e.find("[data-calculate]").length;L=e.find("#jr-preload-items input").length;b!==S+Q+R&&console.error(" total select-type filter differs between XML form and HTML form");c+d!==T-K-
L&&console.error(" total amount of input/upload fields differs between XML form and HTML form");g!=U&&console.error(" total triggers differs between XML form and HTML form");p!=V+W&&console.error(" total amount of branches differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form)");j!=X+Y&&console.error(" total amount of constraints differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form). Note that constraints on &lt;trigger&gt; elements are ignored in the transformation and could cause this error too.");
u!=K&&console.error(" total amount of calculated items differs between XML form and HTML formprel");w!=L&&console.error(" total amount of preload items differs between XML form and HTML form");e.find("[name]").each(function(){$.inArray($(this).attr("name"),a)&&a.push($(this).attr("name"))});for(b=0;b<a.length;b++)1>f.b(a[b]).get().length&&console.error("Found name attribute: "+a[b]+" that does not have a corresponding data node. Transformation error or XML form error (relative nodesets perhaps?")};
d.prototype.input={f:function(b){var a=this.j(b.eq(0));return"radio"==a||"checkbox"==a?b.parent("label").parent("fieldset"):"fieldset"==a?b:b.parent("label")},fa:function(b){return 1!==b.length?console.error("getProps(): no input node provided or multiple"):{path:this.getName(b),N:this.La(b),B:this.j(b),sa:this.Oa(b),da:b.attr("data-constraint"),Sa:b.attr("data-relevant"),val:this.m(b),required:void 0!==b.attr("required")?h:m,enabled:this.isEnabled(b),multiple:this.la(b)}},j:function(b){return 1!==
b.length?"":"input"==b.prop("nodeName").toLowerCase()?0<b.attr("type").length?b.attr("type").toLowerCase():console.error("<input> node has no type"):"select"==b.prop("nodeName").toLowerCase()?"select":"fieldset"==b.prop("nodeName").toLowerCase()?"fieldset":console.error("unexpected input node type provided")},Oa:function(b){return 1!==b.length?console.error("getXMLType(): no input node provided or multiple"):b.attr("data-type-xml")},getName:function(b){return 1!==b.length?console.error("getName(): no input node provided or multiple"):
"radio"==this.j(b)?b.attr("data-name"):0<b.attr("name").length?b.attr("name"):console.error("input node has no name")},La:function(b){var a,c,d;if(1!==b.length)return console.error("getIndex(): no input node provided or multiple");a=this.j(b);c=this.getName(b);d=this.f(b);return("radio"===a&&c!==b.attr("name")?this.f(e.find('[data-name="'+c+'"]')):this.f(e.find('[name="'+c+'"]'))).index(d)},la:function(b){return"checkbox"==this.j(b)||void 0!==b.attr("multiple")?h:m},isEnabled:function(b){return void 0!==
b.attr("disabled")||0!==b.parents("fieldset:disabled").length?m:h},m:function(b){var a,c=[],d;if(1!==b.length)return console.error("getVal(): no inputNode provided or multiple");a=this.j(b);d=this.getName(b);return"radio"==a?this.f(b).find("input:checked").val()||"":"checkbox"==a?(this.f(b).find('input[name="'+d+'"]:checked').each(function(){c.push($(this).val())}),c):b.val()||""},l:function(b,a,c){a=a||0;if("radio"==this.j(e.find('[data-name="'+b+'"]').eq(0)))return this.f(e.find('[data-name="'+
b+'"]')).eq(a).find('input[value="'+c+'"]').attr("checked",h);b=this.f(e.find('[name="'+b+'"]')).eq(a).find("input, select, textarea");this.la(b.eq(0))===h&&(c=c.split(" "));return b.val(c)}};d.prototype.R=function(){var b,a,c,d=this;f.b(i,i,{v:h}).get().each(function(){c=$(this).text();b=f.b($(this).prop("nodeName")).get().index($(this));a=d.Ia($(this));d.input.l(a,b,c)})};d.prototype.Va=function(){var b,a,c,d=this,f=e.find("#form-languages").attr("data-default-lang");$("#form-languages").detach().insertBefore($("form.jr").parent());
if(!f||""===f)f=$("#form-languages a:eq(0)").attr("lang");console.debug("default language is: "+f);2>$("#form-languages a").length?(e.find("[lang]").addClass("active"),e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")}),this.U()):($("#form-languages a").click(function(f){f.preventDefault();b=$(this).attr("lang");$("#form-languages a").removeClass("active");$(this).addClass("active");e.find("[lang]").removeClass("active").filter('[lang="'+
b+'"], [lang=""]').addClass("active");e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")});e.find("select>option").not('[value=""]').each(function(){a=$(this).attr("value");c=$(this).parent("select").next(".jr-option-translations").children('.active[data-option-value="'+a+'"]').text().trim();c="undefined"!==typeof c&&0<c.length?c:"[MISSING TRANSLATION]";$(this).text(c)});e.find("legend span.active:not(.jr-hint, .jr-constraint-msg), label span.active:not(.jr-hint, .jr-constraint-msg)").each(function(){0===
$(this).text().trim().length&&$(this).text("[MISSING TRANSLATION]")});d.U();e.trigger("changelanguage")}),$('#form-languages a[lang="'+f+'"]').click())};d.prototype.U=function(){var b,a;e.find("*>.jr-hint").parent().each(function(){a="label"!==$(this).prop("nodeName").toLowerCase()&&"fieldset"!==$(this).prop("nodeName").toLowerCase()?$(this).parent("fieldset"):$(this);b=0<a.length?$(this).find(".jr-hint.active").text().trim():$(this).find("span.jr-hint").text().trim();0<b.length?a.find(".question-icons .hint").attr("title",
b).addClass("ui-icon ui-icon-help"):a.find(".question-icons .hint").removeAttr("title").removeClass("ui-icon ui-icon-help")});e.tooltip()};d.prototype.w={set:function(b){e.attr("data-edited",b.toString());e.trigger("edit",b)},get:function(){return"true"===e.attr("data-edited")?h:m}};d.prototype.oa={set:function(b){e.attr("data-stored-with-key",b);e.find("h2 span").text(b)},get:function(){return e.attr("data-stored-with-key")||i},reset:function(){e.removeAttr("data-stored-with-key")}};d.prototype.pa=
{set:function(b){e.attr("data-stored-final",b.toString())},get:function(){return"true"===e.attr("data-stored-final")?h:m},reset:function(){e.removeAttr("data-stored-final")}};d.prototype.$={a:function(){e.on("click",".jr-branch",function(){var b=$(this);$(this).hasClass("busy")||($(this).hasClass("show")?$(this).addClass("busy").removeClass("show").next().hide("blind",{},600,function(){b.removeClass("busy")}):$(this).addClass("busy show").next().show("blind",{},600,function(){b.removeClass("busy");
b.next().z()}))});this.update()},update:function(b){var a,c,d,j,l,p={},u=this;j="undefined"!==typeof b?b.split(","):[];l=0<j.length?[]:["[data-relevant]"];for(b=0;b<j.length;b++)l.push('[data-relevant*="'+j[b]+'"]');e.find(l.join()).each(function(){a=g.input.fa($(this));c=g.input.f($(this));if(!("radio"==a.B||"checkbox"==a.B)||!p[a.path]){if(1!==c.length)return console.error("could not find branch node"),m;try{d=f.evaluate(a.Sa,"boolean",a.path,a.N)}catch(b){return console.error('Serious error occurred trying to evaluate skip logic for node with name: "'+
a.path+'" (message: '+b.message+")"),m}p[a.path]=h;return d===h?u.enable(c):u.disable(c)}})},enable:function(b){b.prev(".jr-branch").hide("slow",function(){$(this).remove()});b.removeClass("disabled").show("blind",{direction:"up"},1E3,function(){$(this).z()});return"label"==b.prop("nodeName").toLowerCase()?b.children("input, select, textarea").removeAttr("disabled"):b.removeAttr("disabled")},disable:function(b){b.addClass("disabled").hide();0===b.prev(".jr-branch").length&&(b.before('<div class="jr-branch ui-corner-all"></div>'),
b.ba("change"));return"label"==b.prop("nodeName").toLowerCase()?b.children("input, select, textarea").attr("disabled","disabled"):b.attr("disabled","disabled")}};d.prototype.P=function(b){var a,c,d,g="";console.log("updating active outputs that contain: "+b);c="undefined"!==typeof b?b.split(","):[];d=0<c.length?[]:[".jr-output[data-value]"];for(b=0;b<c.length;b++)d.push('.jr-output[data-value*="'+c[b]+'"]');e.find(":not([disabled]) span.active").find(d.join()).each(function(){try{a=$(this).attr("data-value"),
g=f.evaluate(a,"string")}catch(b){console.error("error occurred trying to evaluate output value from expression: "+a+", (message:"+b.message+")"),g="[ERROR]"}$(this).text(g)});e.z();this.U()};d.prototype.aa=function(b){var a,c,d,g,j,p,u;p="undefined"!==typeof b?b.split(","):[];u=0<p.length?[]:["input[data-calculate]"];for(b=0;b<p.length;b++)u.push('input[data-calculate*="'+p[b]+'"]');e.find("#jr-calculated-items").find(u.join()).each(function(){a=$(this).attr("name");c=$(this).attr("data-calculate");
d=$(this).attr("data-type-xml");j=$(this).attr("data-constraint");g=f.evaluate(c,"string",a,i);f.b(a,i).l(g,j,d)})};d.prototype.wa=function(){e.find(".jr-group, .jr-repeat").addClass("ui-corner-all");e.find("h2#form-title").addClass("ui-widget-header ui-corner-all");e.find(".trigger").addClass("ui-state-highlight ui-corner-all");$("fieldset:not(.jr-appearance-compact)>label, fieldset:not(.jr-appearance-compact)>legend").children("img,video,audio").parent().addClass("ui-helper-clearfix with-media")};
d.prototype.$a={a:function(){this.Aa();this.Ea();this.Xa();this.Da();this.Ra();this.Ja();this.va()},Aa:function(){e.find(".jr-appearance-compact>label>span").hide()},Ea:function(){Modernizr.inputtypes.date||e.find('input[type="date"]').datepicker({})},Xa:function(){Modernizr.inputtypes.time||e.find('input[type="time"]').timepicker({})},Da:function(){Modernizr.inputtypes.datetime||e.find('input[type="datetime"]').datetimepicker()},nb:function(){e.find("select:not([multiple])").attr("size","1");$("select:not([multiple])").multiselect({multiple:m,
header:"Select one option",noneSelectedText:"Select one option",selectedList:1,position:{my:"left top",at:"left bottom"}})},mb:function(){e.find("select[multiple]").attr("size","5").find('[value=""]').remove();$("select[multiple]").multiselect({header:"false",position:{my:"left top",at:"left bottom"}})},Ra:function(){e.find('input[readonly]:not([data-type-xml="geopoint"])').parent("label").each(function(){var b=$(this).html(),a=$(this).find("input").attr("data-relevant"),c='name="'+$(this).find("input").attr("name")+
'"';$('<fieldset class="trigger ui-state-highlight ui-corner-all" '+("undefined"!==typeof a?'data-relevant="'+a+'" '+c:c)+"></fieldset>").insertBefore($(this)).append(b).find("input").remove();$(this).remove()})},ib:n(),rb:n(),qb:n(),Ja:function(){e.find('input[data-type-xml="geopoint"]').attr("placeholder","Awesome geopoint widget will follow in the future!")},bb:n(),va:function(){e.find('input[data-type-xml="barcode"]').attr("placeholder","This probably does not require support for browser data entry.")}};
d.prototype.Qa={a:function(){var b,a,c,d,g=this;e.find("#jr-preload-items input").each(function(){b=$(this).attr("data-preload").toLowerCase();a=$(this).attr("data-preload-params").toLowerCase();c=$(this).attr("name");"undefined"!==typeof g[b]?(d=f.b(c).m(),g.l($(this),g[b]({param:a,r:d,b:$(this)}))):console.error('Preload "'+b+'"" not supported. May or may not be a big deal.')})},l:function(b,a){b.val(a.toString()).trigger("change")},timestamp:function(b){var a=this;return"start"==b.param&&""!==
b.r?""===b.r?b.r:f.evaluate("now()","string"):"end"==b.param?(e.on("beforesave",function(){a.l(b.b,f.evaluate("now()","string"))}),f.evaluate("now()","string")):""},date:function(a){var c,d;return""!==a.r?(c=new Date(f.evaluate("today()","string")),a=y(c.getUTCFullYear().toString(),4),d=y((c.getUTCMonth()+1).toString(),2),c=y(c.getUTCDate().toString(),2),a+"-"+d+"-"+c):a.r},property:o("no property preload in Rapaide"),context:function(a){return"application"==a.param?"rapaide":""},patient:o("not supported in Rapaide"),
user:o("user preload item not functioning yet"),uid:o("no uid"),browser:function(a){if("name"==a.param)return $.browser.webkit?"webkit":$.browser.mozilla?"mozilla":$.browser.opera?"opera":$.browser.msie?"msie":"unknown";if("version"==a.param)return $.browser.version},os:o("not known")};d.prototype.repeat={a:function(){var a,c,d,g,j,l=this;e.find("fieldset.jr-repeat").prepend('<span class="repeat-number"></span>');e.find("fieldset.jr-repeat:not([data-repeat-fixed])").append('<button type="button" class="repeat"></button><button type="button" class="remove"></button>');
e.find("button.repeat").button({text:m,icons:{primary:"ui-icon-plusthick"}});e.find("button.remove").button({disabled:h,text:m,icons:{primary:"ui-icon-minusthick"}});e.on("click","button.repeat:enabled",function(){l.clone($(this).parent("fieldset.jr-repeat"));return m});e.on("click","button.remove:enabled",function(){l.remove($(this).parent("fieldset.jr-repeat.clone"));return m});e.find("fieldset.jr-repeat").each(function(){d=$(this).attr("data-repeat-count")||"";c=0<d.length?parseInt(f.b(d).m(),
10):0;g=f.b($(this).attr("name")).get().length;j=c>g?c:g;for(a=1;a<j;a++)l.clone($(this).siblings().andSelf().last(),"")})},clone:function(a,c){var d,g,j,l,p,u,w=this;if(1!==a.length)return console.error("Nothing to clone"),m;d=a.parent("fieldset.jr-group").children("fieldset.jr-repeat:not(.clone)").eq(0);g=d.clone(m);g.find(".clone").remove();g.addClass("clone");g.find("button.remove").button({text:m,icons:{primary:"ui-icon-minusthick"}});g.find("button.repeat").button({text:m,icons:{primary:"ui-icon-plusthick"}});
g.insertAfter(a).parent(".jr-group").na();g.hide().show("highlight",{},600);g.ba(c);g.find(".invalid input, .invalid select, .invalid textarea").each(function(){w.W($(this))});j=e.find('fieldset.jr-repeat[name="'+a.attr("name")+'"]').index(a);l=[];g.find('input[type="radio"]').each(function(){-1===$.inArray($(this).attr("data-name"),l)&&l.push($(this).attr("data-name"))});for(p=0;p<l.length;p++)u=(new Date).getTime().toString(),g.find('input[type="radio"][data-name="'+l[p]+'"]').attr("name",u);this.ra(d.parent());
d=d.attr("name");0<d.length&&0<=j&&f.za(d,j);e.trigger("changerepeat");return h},remove:function(a){var c=this,d=a.attr("name"),g=e.find('[name="'+d+'"]').index(a),j=a.parent("fieldset.jr-group");a.hide("drop",{},600,function(){a.remove();j.na();c.ra(j)});f.b(d,g).remove();e.trigger("changerepeat")},ra:function(a){a="undefined"==typeof a||0===a.length||!a?a=e:a;a.find("button.repeat, button.remove").button("disable").removeClass("ui-state-hover");a.find("fieldset.jr-repeat:last-child > button.repeat").button("enable");
a.find("fieldset.jr-repeat:not(:nth-child(2)) > button.remove").button("enable")}};d.prototype.T=function(){var a,c,d=this;$("form.jr").attr("onsubmit","return false;");e.on("change validate","input, select, textarea",function(e){a=d.input.fa($(this));c="validate"==e.type?a.enabled&&"hidden"!==a.B?f.b(a.path,a.N).d(a.da,a.sa):h:f.b(a.path,a.N).l(a.val,a.da,a.sa);c=a.enabled&&"hidden"!==a.B&&a.required&&1>a.val.length?m:c;if("undefined"!==typeof c&&c!==i)return c===m?d.Ua($(this)):d.W($(this))});e.on("dataupdate",
function(a,b){d.aa(b);d.$.update(b);d.P(b)});e.on("change changerepeat",function(){d.w.set(h)});e.on("changerepeat",function(){d.R()});e.on("beforesave",function(){console.debug("beforesave event detected");d.H()});$(window).resize(function(){e.z()});e.on("changelanguage",function(){d.P()})};d.prototype.W=function(a){this.input.f(a).removeClass("invalid ui-state-error")};d.prototype.Ua=function(a){this.input.f(a).addClass("invalid ui-state-error")};d.prototype.Ia=function(a){for(var c=[a.prop("nodeName")],
a=a.parent();1==a.length&&"#document"!==a.prop("nodeName");)c.push(a.prop("nodeName")),a=a.parent();return"/"+c.reverse().join("/")};d.prototype.H=function(){var a=this;e.find("fieldset:disabled input, fieldset:disabled select, fieldset:disabled textarea, input:disabled, select:disabled, textarea:disabled").each(function(){a.W($(this))});e.find("input, select, textarea").trigger("validate");return this.D()};d.prototype.D=function(){return 0<e.find(".invalid").length?m:h}}t.prototype.S=n();var H=jQuery;
H.fn.na=function(){this.each(function(){H(this).find("fieldset.jr-repeat").each(function(){var a,c,d;0===H(this).prev("fieldset.jr-repeat").length&&(a=H(this).siblings("fieldset.jr-repeat"),c=a.length+1,1<c?(H(this).find("span.repeat-number").text("1"),d=2,a.each(function(){H(this).find("span.repeat-number").text(d);d++})):H(this).find("span.repeat-number").empty())})})};
H.fn.ba=function(a){a=a||"edit";this.each(function(){H(this).find("input, select, textarea").each(function(){var c=H(this).attr("type");"SELECT"===H(this).prop("nodeName").toUpperCase()&&(c="select");"TEXTAREA"===H(this).prop("nodeName").toUpperCase()&&(c="textarea");switch(c){case "date":case "number":case "search":case "color":case "range":case "url":case "email":case "password":case "text":case "file":case "hidden":case "textarea":H(this).val("").trigger(a);break;case "radio":case "checkbox":H(this).prop("checked")&&
(H(this).prop("checked",m),H(this).trigger(a));break;case "select":H(this)[0].selectedIndex=-1;H(this).trigger(a);break;default:console.error("Unrecognized input type found when trying to reset: "+c)}})})};H.fn.z=function(){var a;this.each(function(){H(this).find("legend + label").each(function(){a=0<H(this).prev().find(".jr-constraint-msg.active").length&&36>H(this).prev().height()?36:19>H(this).prev().height()?19:H(this).prev().height();H(this).animate({"margin-top":a+6+"px"},600)})})};
H.fn.Y=function(a){var c,d,a=a.replace(/\/\//g," "),a=a.replace(/^\//,""),a=a.replace(/\/\.$/,""),a=a.replace(/\//g,">"),a=a.replace(/\[([^@].*?)\]/g,function(a,c){return":has("+c+")"});if(0<=a.indexOf(">..")){a=a.split(/>\.\.>?/g);c=jQuery(a[0],this);for(d=1;d<a.length;d++)c=c.parent(a[d]);return c.get()}return this.find(a)};var I,J,M,N,C,s={autoUpload:h,buttonLocation:"bottom",autoNotifyBackup:m};
$(document).ready(function(){var a,c,d;C=new aa;I=new G(jrDataStr);N=new B;N.a();J=new O;C.isSupported()?$(document).trigger("browsersupport","local-storage"):window.location="modern_browsers";c=(a=C.s("__bookmark"))?a.shown:0;3>c&&setTimeout(function(){d=1===c?"time":"times";x("Please bookmark this page for easy offline launch. This reminder will be shown "+(2-c)+" more "+d+".",20);c++;C.V("__bookmark",{shown:c})},5E3);$("html").attr("manifest")&&(M=new ba,M.a(),M.isSupported()?($(document).trigger("browsersupport",
"offline-launch"),ca(),window.setInterval(function(){ca()},36E5)):(a={g:"Show options",h:"Use it",i:function(){window.location="modern_browsers"}},r.confirm("Offline application launch not supported by your browser. You can use it without this feature or see options for resolving this",a,"Application cannot launch offline")),console.log("cache initialized"));I.a();J.a();r.X();$("form.jr").trigger("save",JSON.stringify(C.A()))});
function ca(){M.checkForUpdate();window.setTimeout(function(){console.log("going to provide cache feedback to user. cache.getError="+M.getError());M.Ya()?x("A new version of this application has been downloaded. Please save your work and refresh to update.",20):M.getError()&&("security"===M.getError()?x("Please allow site to store data for offline use and refresh.",60):r.alert("An error occurred with the application cache. You may have a problem launching offline (error: "+M.getError()+"). Please save your work, refresh and check if offline launch works."))},
3E4)}function da(a,c){var d;!c&&I.ea()?(d={posAction:function(){da("'+formName+'",h)}},r.confirm("Would you like to proceed without saving changes to the form you were working on?",d)):(d=C.s(a),d.data!==i?(I.reset(),I=new G(d.data),I.a(),I.qa(a),$("#page-close").click(),$("button#delete-form").button("enable"),x('"'+a+'" has been loaded',2)):r.alert("Record contained no data"))}
function P(a,c,d,f){var g,e;g=I.M();var j=I.Ma(),b={};b.data=I.Ka();b.ready=c;console.debug("new name: "+a+", before: "+g+", delOld: "+d+", overwr: "+f);if(b.data===i||""===b.data)return x("Nothing to save.");if("undefined"==typeof a||0===a.length){g=g||C.getCounterValue();$('#dialog-save input[name="record-name"]').val(g);$('#dialog-save input[name="record-final"]').attr("checked",j);var k,z,F,E,l;g=I.D();var p=$("#dialog-save");g?p.find('[name="record-final"]').removeAttr("disabled"):p.find('[name="record-final"]').attr("disabled",
"disabled");z=z||"Record Details";k="undefined"==typeof k?{}:k;k.g=k.g||"Ok";k.h=k.h||"Cancel";F=k.i||function(){return P(p.find('[name="record-name"]').val(),Boolean(p.find('[name="record-final"]:checked').val()))};E=k.u||o(m);l=function(){p.dialog("destroy");p.find("#dialog-save-msg").text("")};p.find("#dialog-save-msg").text(e||"").L();p.dialog({title:z,resizable:m,modal:h,buttons:[{text:k.g,click:function(){F.call();l.call()}},{text:k.h,click:function(){E.call();l.call()}}],beforeClose:l})}else{if(g&&
g!==a&&"undefined"==typeof d)return e={g:"Yes, delete",h:"No, keep",i:function(){P(a,c,h)},u:function(){P(a,c,m)}},r.confirm("Record name has changed. Would you like to delete the record saved under the old name:"+g+"?",e,"Delete old Record?");g=C.V(a,b,d,f,g);console.log("result of save: "+g);"success"===g?(x('Form with name "'+a+'" has been saved.',2),I.qa(a),I.Wa(c),I.Ta(),$("button#delete-form").button("enable"),$("form.jr").trigger("save",JSON.stringify(C.A()))):"existing"===g?(e={g:"Yes, overwrite",
i:function(){P(a,c,d,h)},u:function(){x("Form was not saved.")}},r.confirm("Record with name "+a+" already exists. Would you like to overwrite existing record? ",e)):"forbidden"===g?(r.alert("This name is not allowed. Please change it"),x("Form was NOT saved.")):x("Error occurred. Form was NOT saved.")}}
function Z(a){!a&&I.ea()?(a={i:function(){Z(h)}},r.confirm("There are unsaved changes, would you like to reset without saving those?",a)):(I.reset(),I=new G(jrDataStr),I.a(),$("button#delete-form").button("disable"))}
function ea(a){var c=I.M();""!==c&&c!==i?a?C.Q(c)?(Z(h),x("Successfully deleted form."),$("form.jr").trigger("delete",JSON.stringify(C.A()))):x("An error occurred when trying to delete this form."):(a={g:"Delete",i:function(){ea(h)}},r.confirm("Please confirm that you would like to remove this form from storage.",a)):x("Please first load the form you would like to delete or choose reset if you'd like to reset the current form.")}
function ba(){var a,c,d,f;this.a=function(){window.applicationCache&&(a="html5Cache",c=window.applicationCache,c.addEventListener("updateready",function(){c.swapCache();d=h},m),c.addEventListener("error",function(){console.log("HTML5 cache error event");fa()&&(console.log("noticed online status"),f="error downloading application")},m))};this.isSupported=function(){return"html5Cache"===a||"gearsCache"===a?h:m};this.checkForUpdate=function(){console.log("checking for cache update");try{c.update()}catch(a){"NS_ERROR_DOM_SECURITY_ERR"===
a.name&&(f="security"),console.log("error thrown during cache update. error name: "+a.name+"  message: "+a.message)}};this.Ya=function(){console.log("updateReady() returns: "+d);return d};this.getError=function(){return f}}function O(){var a=this;this.Za=m;this.a=function(){$(window).on("offline online",function(){var c=fa();c!==a.Ca&&(console.log("status changed to: "+c+", triggering window.onlinestatuschange"),$(window).trigger("onlinestatuschange",c));a.Ca=c});$(window).trigger("online")}}
function fa(){console.log("checking connection status");return navigator.onLine}O.prototype.upload=function(a,c){var d="true"===D()||D()===h?h:m;if(("undefined"==typeof this.o||0===this.o.length)&&(d===h||a)){this.e={p:[],fail:[],Ha:a};this.o=C.ha(h,c);if(0===this.o.length)return a?x('Nothing marked "final" to upload (or record is currently open).'):m;ga(this)}};
function ga(a){var c,d,f;0<a.o.length&&(c=a.o.pop(),d=new FormData,d.append("xml_submission_data",c.data),d.append("Date",(new Date).toUTCString()),f=0===a.o.length?h:m,$.ajax("data/submission",{type:"POST",data:d,cb:m,contentType:m,processData:m,complete:function(d){var e=d.status,j=c.name,b,d="";b=[];var k={"0":{success:m,c:"Uploading of data failed (probably offline)"},200:{success:m,c:"Data server did not accept data for "+j+". Contact Enketo helpdesk please."},201:{success:h,c:""},202:{success:h,
c:j+" may have had errors. Contact survey administrator please."},"2xx":{success:m,c:"Unknown error occurred when submitting data for "+j+". Contact Enketo helpdesk please"},400:{success:m,c:"Data server did not accept data for "+j+" Contact survey administrator please."},403:{success:m,c:"You are not allowed to post data to this data server. Contact survey administrator please."},404:{success:m,c:"Submission area on data server not found or not properly configured."},"4xx":{success:m,c:"Unknown submission problem on data server."},
413:{success:m,c:"Data for "+j+" is too large. Please export the data and contact the Enketo helpdesk please."},500:{success:m,c:"Sorry, the Enketo server is down or being maintained. Please try again later or contact Enketo helpdesk please."},503:{success:m,c:"Sorry, the Enketo server is down or being maintained. Please try again later or contact Enketo helpdesk please."},"5xx":{success:m,c:"Sorry, the Enketo server is down or being maintained. Please try again later or contact Enketo helpdesk please."}};
console.debug("name: "+j);console.debug(e);"undefined"!==typeof k[e]?k[e].success===h?(C.Q(j),$("form.jr").trigger("delete",JSON.stringify(C.A())),console.log("tried to remove record with key: "+j),a.e.p.push([j,k[e].c])):k[e].success===m&&a.e.fail.push([j,k[e].c]):500<e?(console.error("error during uploading, received unexpected statuscode: "+e),a.e.fail.push([j,k["5xx"].c])):400<e?(console.error("error during uploading, received unexpected statuscode: "+e),a.e.fail.push([j,k["4xx"].c])):200<e&&
(console.error("error during uploading, received unexpected statuscode: "+e),a.e.fail.push([j,k["2xx"].c]));if(f===h){if(0<a.e.p.length){for(e=0;e<a.e.p.length;e++)b.push(a.e.p[e][0]),d="undefined"!==typeof a.e.p[e][2]?d+a.e.p[e][1]+" ":"";b=b.join(", ");x(b.substring(0,b.length)+(1<e?" were":" was")+" successfully uploaded. "+d)}if(0<a.e.fail.length&&a.e.Ha===h){for(e=0;e<a.e.fail.length;e++)d+=a.e.fail[e][0]+": "+a.e.fail[e][1]+"<br />";r.alert(d,"Failed data submission")}a.Za=m}ga(a)}}))}
B.prototype.autoUpload=B.prototype.ua;B.prototype.buttonLocation=B.prototype.xa;B.prototype.ua=n();B.prototype.xa=function(a){$("#form-controls").removeClass("bottom right mobile").addClass(a);$(window).trigger("resize")};
t.prototype.S=function(){var a=this;$("button#save-form").button({icons:{primary:"ui-icon-disk"}}).click(function(){I.d();P()});$("button#reset-form").button({icons:{primary:"ui-icon-refresh"}}).click(function(){Z()});$("button#delete-form").button({icons:{primary:"ui-icon-trash"},disabled:h}).click(function(){ea(m)});$("#form-controls button").Ga();$(document).on("click","#records-saved li:not(.no-click)",function(a){a.preventDefault();a=$(this).find(".name").text();da(a);$(this).siblings().removeClass("ui-state-active");
$(this).addClass("ui-state-active")}).on("mouseenter","#records-saved li:not(.no-click)",function(){$(this).addClass("ui-state-hover")}).on("mouseleave","#records-saved li:not(.no-click)",function(){$(this).removeClass("ui-state-hover")});v(this).get("records").find("button#records-force-upload").button({icons:{primary:"ui-icon-arrowthick-1-n"}}).click(function(){J.upload(h,I.M())}).hover(function(){$("#records-force-upload-info").show()},function(){$("#records-force-upload-info").hide()});v(this).get("records").find("button#records-export").button({icons:{primary:"ui-icon-suitcase"}}).click(function(){var a;
(a=C.Na(m||h))?(a="data:text/xml,"+encodeURIComponent(a),window.open(a,"exportedData")):r.alert('No data marked "final" to export.')}).hover(function(){$("#records-export-info").show()},function(){$("#records-export-info").hide()});$(document).on("save delete","form.jr",function(c,d){console.debug("save or delete event detected with new formlist: "+d);var f=JSON.parse(d),g,e,j,b,k,z,F=0,E=0;console.debug("updating recordlist in GUI");g||(g=v(a).get("records"));z=g.find("#records-saved ol");z.children().remove();
f=f||[];if(0<f.length)for(b=0;b<f.length;b++)e=f[b].key,j=(new Date(f[b].t)).toDateString(),f[b].ready===h?(k="check",F++):(k="pencil",E++),j=$('<li><span class="ui-icon ui-icon-'+k+'"></span><span class="name"></span><span class="date"> ('+j+")</span></li>"),j.find(".name").text(e),z.append(j);else $('<li class="no-click">no locally saved records found</li>').appendTo(z);g.find("#records-draft-qty").text(E);g.find("#records-final-qty").text(F)});$(document).on("setsettings",function(c,d){console.debug("settingschange detected, GUI will be updated with settings:");
console.debug(d);var f;console.log("gui updateSettings() started");$.each(d,function(c,d){f=d?v(a).get("settings").find('input[name="'+c+'"][value="'+d+'"]'):v(a).get("settings").find('input[name="'+c+'"]');0<f.length&&f.attr("checked",d?h:m).trigger("change")})});v(this).get("settings").on("change","input",function(){var a=$(this).attr("name"),d=$(this).is(":checked")?$(this).val().toString():"";console.debug("settings change by user detected");N.set(a,d)});$("#dialog-save").hide()};