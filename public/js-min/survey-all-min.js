var i=!0,j=null,k=!1;function l(){return function(){}}function m(a){return function(){return a}}var p,q,r={};$(document).ready(function(){q=new s;q.a();"undefined"==typeof console&&(console={log:l()});"undefined"==typeof window.console.debug&&(console.debug=console.log);var a;a:{a=window.location.search.substring(1).split("&");for(var b=0;b<a.length;b++){var d=a[b].split("=");if("debug"==d[0]){a=encodeURI(d[1]);break a}}a=k}"true"!==a&&(window.console.log=l(),window.console.debug=l())});
function s(){}p=s.prototype;p.a=function(){this.na.V();t(this).a();this.R();"function"===typeof this.Q&&this.Q();$(".dialog [title]").tooltip();Modernizr.borderradius&&(Modernizr.boxshadow&&Modernizr.csstransitions&&Modernizr.opacity)&&$(document).trigger("browsersupport","fancy-visuals");$("footer").detach().appendTo("#container")};p.V=function(){$(window).trigger("resize")};
p.R=function(){var a=this;$("#feedback-bar-close").button({icons:{primary:"ui-icon-closethick"},text:k}).click(function(a){a.preventDefault();$("#feedback-bar p").remove();$("#feedback-bar").trigger("change")});$("#page-close").button({icons:{primary:"ui-icon-closethick"},text:k}).click(function(b){b.preventDefault();t(a).close()});$("#feedback-bar-close, #page-close").removeClass().addClass("custom-button ui-widget-header ui-corner-all");$(document).on("click",'a[href^="#"]:not([href="#"]):not(nav ul li a)',
function(a){var d=$(this).attr("href");"#"!==d&&(a.preventDefault(),$('nav li a[href="'+d+'"]').click())});$('nav ul li a[href^="#"]').click(function(b){b.preventDefault();b=$(this).attr("href").substr(1);t(a).open(b);$(this).closest("li").addClass("nav-state-active")});$(window).on("onlinestatuschange",function(b,d){a.updateStatus.Aa(d)});$(document).on("edit","form.jr",function(b,d){a.updateStatus.Ea(d)});$(document).on("browsersupport",function(b,d){a.updateStatus.support(d)});$("#page, #feedback-bar").on("change",
function(){a.display()});$("header #status-connection").click(function(a){x($(this).attr("title"));a.stopPropagation()});$(window).resize(function(){$("#container").css("top",$("header").outerHeight());$("body:not(.no-scroll) #container").height($(window).height()-$("header").outerHeight()-$("#form-controls.bottom").outerHeight());var a=$("nav").offset().left,d=$("#logo").offset().left+$("#logo").outerWidth();a<d?$("#logo").css("visibility","hidden"):$("#logo").css("visibility","visible")})};
p.na={V:function(){$("article.page").each(function(){var a,b="",d;d=$(this).attr("id");a=$(this).attr("data-display")?$(this).attr("data-display"):d;b=$(this).attr("data-title")?$(this).attr("data-title"):d;d=$(this).attr("data-ext-link")?$(this).attr("data-ext-link"):"#"+d;$('<li class="ui-corner-tl ui-corner-tr"><a href="'+d+'" title="'+b+'" >'+a+"</a></li>").appendTo($("nav ul"))})},reset:function(){$("nav ul li").removeClass("nav-state-active")}};
function t(a){a.a=function(){this.I=$("<pages></pages>");$("article.page").detach().appendTo(this.I)};a.get=function(a){var d=this.I.find('article[id="'+a+'"]');return d=0<d.length?d:$('article[id="'+a+'"]')};a.A=function(a){return 0<$("#page article.page"+("undefined"!==typeof a?'[id="'+a+'"]':"")).length};a.open=function(a){var d;if(!this.A(a)){d=this.get(a);if(1!==d.length)return console.error("page not found");this.A()&&this.close();$("#page-content").prepend(d.show()).trigger("change");$("#overlay").show();
setTimeout(function(){d.find(".scroll-list").ua();$("#overlay, header").bind("click.pageEvents",function(){$("#page-close").trigger("click")})},50);$(window).bind("resize.pageEvents",function(){$("#page").trigger("change")})}};a.close=function(){var a;a=$("#page .page").detach();this.I.append(a);$("#page").trigger("change");this.na.reset();$("#overlay").hide();$("#overlay, header").unbind(".pageEvents");$(window).unbind(".pageEvents")};return a}
function x(a,b){var d,b=b?1E3*b:1E4;$("#feedback-bar p").eq(1).remove();$("#feedback-bar p").html()!==a&&(d=$("<p></p>"),d.text(a),$("#feedback-bar").prepend(d));$("#feedback-bar").trigger("change");setTimeout(function(){typeof d!=="undefined"&&d.remove();$("#feedback-bar").trigger("change")},b)}
p.alert=function(a,b){var d,f=$("#dialog-alert"),b=b||"Alert";d=function(){f.dialog("destroy");f.find("#dialog-alert-msg").text("")};f.find("#dialog-alert-msg").html(a).ba();f.dialog({title:b,modal:i,resizable:k,closeOnEscape:i,buttons:{Ok:d},beforeClose:d,width:500})};
p.confirm=function(a,b){var d,f,h,e,g;"string"===typeof a?d=a:"string"===typeof a.b&&(d=a.b);d="undefined"!==typeof d?d:"Please confirm action";f="undefined"!==typeof a.heading?a.heading:"Are you sure?";e="undefined"!==typeof a.dialog?a.dialog:"confirm";b="undefined"!==typeof b?b:{};b.l=b.l||"Confirm";b.D=b.D||"Cancel";b.i=b.i||m(k);b.C=b.C||m(k);b.Z=b.Z||l();h=function(){g.dialog("destroy");g.find(".dialog-msg, .dialog-error").text("");console.debug("dialog destroyed")};g=$("#dialog-"+e);g.find(".dialog-msg").text(d).ba();
g.dialog({open:b.Z,title:f,resizable:k,modal:i,closeOnEscape:i,buttons:[{text:b.l,click:function(){b.i.call();g.find(".dialog-error").text().length===0&&h.call()}},{text:b.D,click:function(){b.C.call();h.call()}}],width:500,beforeClose:h})};
p.updateStatus={Aa:function(a){console.log("updating online status in menu bar to:");console.log(a);a?$("header #status-connection").removeClass().addClass("ui-icon ui-icon-signal-diag").attr("title","It appears there is currently an Internet connection available."):$("header #status-connection").removeClass().addClass("ui-icon ui-icon-cancel").attr("title","It appears there is currently no Internet connection")},Ea:function(a){a?$("header #status-editing").removeClass().addClass("ui-icon ui-icon-pencil").attr("title",
"Form is being edited."):$("header #status-editing").removeClass().attr("title","")},support:function(a){var b=t(q).get("settings");0<b.length&&(console.debug("updating browser support for "+a),b.find("#settings-browserSupport-"+a+" span.ui-icon").addClass("ui-icon-check"))}};
p.display=function(){var a,b;b=$("header");var d=$("#feedback-bar"),f=$("#page");0<d.find("p").length?(a=b.outerHeight(),b=t(this).A()?b.outerHeight()+d.outerHeight():b.outerHeight()+d.outerHeight()-f.outerHeight()):(a=b.outerHeight()-d.outerHeight(),b=t(this).A()?b.outerHeight():b.outerHeight()-f.outerHeight());d.css("top",a);f.css("top",b)};function y(a,b){for(var d=a;d.length<b;)d="0"+d;return d}var z=jQuery;z.fn.Fa=function(){var a=0;this.each(function(){z(this).width()>a&&(a=z(this).width())}).each(function(){z(this).width(a)})};
z.fn.reverse=[].reverse;
z.fn.Y=function(a){a=z.extend({la:"!@#$%^&*()+=[]\\';,/{}|\":<>?~`.- ",h:"",J:""},a);this.each(function(){a.ib&&(a.h+="ABCDEFGHIJKLMNOPQRSTUVWXYZ");a.$a&&(a.h+="abcdefghijklmnopqrstuvwxyz");for(var b=a.J.split(""),d=0;d<b.length;d++)-1!=a.la.indexOf(b[d])&&(b[d]="\\"+b[d]);a.J=b.join("|");var f=a.la+a.h,f=f.replace(RegExp(a.J,"gi"),"");z(this).keypress(function(a){var b;b=a.charCode?String.fromCharCode(a.charCode):String.fromCharCode(a.which);f.indexOf(b)!=-1&&a.preventDefault();a.ctrlKey&&b=="v"&&
a.preventDefault()});z(this).bind("contextmenu",m(k))})};z.fn.jb=function(a){var b="abcdefghijklmnopqrstuvwxyz",b=b+b.toUpperCase(),a=z.extend({h:b},a);return this.each(function(){z(this).Y(a)})};z.fn.alpha=function(a){a=z.extend({h:"1234567890"},a);return this.each(function(){z(this).Y(a)})};
z.fn.ba=function(){var a;a||(a=1);var b=this.contents().filter(function(){return 3==this.nodeType}).first(),d=b.text();a=d.split(" ",a).join(" ");b.length&&(b[0].nodeValue=d.slice(a.length),b.before('<span class="capitalize">'+a+"</span>"))};
z.fn.ua=function(){this.each(function(){var a=z(this),b=z(this).find("ol");a.css("overflow","hidden");var d=b.height()-a.height();if(0<d){var f=d/b.height(),f=Math.round((1-f)*a.height()),f=f-f%2;z("#records .column.middle").html('<div id="slider-wrap" class="ui-corner-all"><div id="slider-vertical"></div></div>');z("#slider-wrap").height(a.outerHeight());z("#slider-vertical").slider({orientation:"vertical",kb:"max",min:0,max:100,value:100,ob:function(a,e){b.css({top:-((100-e.value)*d/100)})}});z("#slider-wrap").css("margin-top",
z("#records-saved h3").outerHeight(i));z(".ui-slider-handle").css({height:f,"margin-bottom":-0.5*f});a=z("#slider-vertical").height();f=a-f;a=0.5*(a-f);z(".ui-slider").css({height:f,"margin-top":a});z(".ui-slider-range").css({top:-a});z("#slider-wrap").click(function(){z("#slider-vertical").slider("value",0);b.css({top:-d})})}})};function aa(){function a(a){var d;for(d=0;d<b.length;d++)if(a===b[d])return i;return k}var b="__settings null __history Firebug undefined __bookmark __counter".split(" "),d=window.localStorage;this.isSupported=function(){try{return"localStorage"in window&&window.localStorage!==j}catch(a){return k}};this.gb=function(){return b};this.T=function(b,h,e,g,c){if(!b||1>b.length)return console.error("no key provided for record"),"require";b=b.trim();c="string"===typeof c?c.trim():j;g="undefined"!==typeof g&&
g===i?i:k;if("string"===typeof h.data&&a(b))return"forbidden";if("string"===typeof h.data&&c!==b&&d.getItem(b)&&g!==i)return"existing";try{return"string"===typeof h.data&&(h.s=(new Date).getTime(),d.setItem("__counter",JSON.stringify({counter:this.getCounterValue()}))),d.setItem(b,JSON.stringify(h)),console.debug("saved: "+b+", old key was: "+c),c!==j&&(""!==c&&c!==b)&&e&&(console.log("going to remove old record with key:"+c),this.O(c)),"success"}catch(n){return console.log("error in store.setRecord:"+
n.message),"error"}};this.r=function(a){var b;try{return b=JSON.parse(d.getItem(a))}catch(e){return console.log("error with loading data from store: "+e.message),j}};this.O=function(a){try{return d.removeItem(a),i}catch(b){return console.log("error with removing data from store: "+b.message),k}};this.w=function(){var a,b,d=[],g=this.ja(k);for(a=0;a<g.length;a++)b=g[a],b.ready="true"===b.ready||b.ready===i?i:k,d.push({key:b.key,ready:b.ready,s:b.s});d.sort(function(c,a){return a.s-c.s});return d};
this.ja=function(b,h){var e,g,c=[],n={},b=b||k,h=h||j;for(e=0;e<d.length;e++)if(g=d.key(e),n=d.getItem(g),!a(g))try{n=JSON.parse(n),n.key=g,g!==h&&(!b||"true"===n.ready||n.ready===i)&&c.push(n)}catch(C){console.log("record found that was probably not in the correct JSON format (e.g. Firebug settings or corrupt record) (error: "+C.message+"), record was ignored")}return c};this.ia=function(a,b){var d,g,c=[];g=this.ja(a||i,b);for(d=0;d<g.length;d++)c.push({name:g[d].key,data:g[d].data});return c};this.Ma=
function(a){for(var b=this.ia(a),d=[],a=0;a<b.length;a++)d.push(b[a].data);return 0<d.length?"<exported>"+d.join("")+"</exported>":j};this.getCounterValue=function(){var a=this.r("__counter");return y(((a&&"undefined"!==typeof a.counter&&!isNaN(parseFloat(a.counter))&&isFinite(a.counter)?Number(a.counter):0)+1).toString(),4)}}function A(){}A.prototype.a=function(){var a=this.get();$(document).trigger("setsettings",a)};A.prototype.get=function(){return B.r("__settings")||r};
function D(){var a=B.r("__settings")||r;return"undefined"!==typeof a.autoUpload?a.autoUpload:j}A.prototype.set=function(a,b){var d;d=this.get();console.debug("going to store setting: "+a+" with value:"+b);d[a]=b;d=B.T("__settings",d);if("undefined"!==typeof this[a])this[a](b);return"success"===d?i:console.error("error storing settings")};function E(a){function b(c){function a(c,b,d){this.m="undefined"!==typeof c&&c?c:"*";this.filter=d="undefined"!==typeof d&&d!==j?d:{};this.filter.F="undefined"!==typeof d.F?d.F:i;this.filter.M="undefined"!==typeof d.M?d.M:k;this.filter.G="undefined"!==typeof d.G?d.G:k;this.filter.t="undefined"!==typeof d.t?d.t:k;this.index=b}var b,d=this,c=c.replace(/<[\/]?instance(>|\s+[^>]*>)/gi,"");this.xml=$.parseXML(c);this.H=b=$(this.xml);XPathJS.bindDomLevel3XPath();this.c=function(c,b,d){return new a(c,b,
d)};a.prototype.get=function(){var c,a;c=this.filter.G===i?b.X(this.m).filter("[template]"):this.filter.F===i?b.X(this.m).not("[template], [template] *"):b.X(this.m);this.filter.t===i?c=c.filter(function(){a=$(this).text();return 0===$(this).children().length&&0<a.trim().length}):this.filter.M===i&&(c=c.filter(function(){return 0===$(this).children().length}));return c="undefined"!==typeof this.index&&this.index!==j?c.eq(this.index):c};a.prototype.j=function(c,a,b){var d,n;n=this.k().join(" ");c=
"undefined"!==typeof c?$.isArray(c)?c.join(" "):c:"";c=this.p(c,b);d=this.get();if(1===d.length&&c.toString().trim()!==n.toString().trim())return d.text(c),c=this.d(a,b),e.trigger("dataupdate",d.prop("nodeName")),c;if(1<d.length)return console.error("nodeset.setVal expected nodeset with one node, but received multiple"),j;0===d.length&&console.error("Data node: "+this.m+" with null-based index: "+this.index+" not found!");return j};a.prototype.k=function(){var c=[];this.get().each(function(){c.push($(this).text())});
return c};a.prototype.clone=function(c){var a,b;a=this.get();c=c||a;1===a.length&&1===c.length?(a.clone().insertAfter(c).find("*").andSelf().removeAttr("template"),b=[a.prop("nodeName")],a.find("*").each(function(){b.push($(this).prop("nodeName"))}),e.trigger("dataupdate",b.join())):console.error("node.clone() function did not receive origin and target nodes")};a.prototype.remove=function(){var c=this.get();0<c.length?(c.remove(),e.trigger("dataupdate",c.prop("nodeName"))):console.error("could not find node "+
this.m+" with index "+this.index+"to remove ")};a.prototype.p=function(c,a){return""===c.toString()?c:"undefined"!==typeof a&&a!==j&&"undefined"!==typeof this.types[a.toLowerCase()]&&"undefined"!==typeof this.types[a.toLowerCase()].p?this.types[a.toLowerCase()].p(c):c};a.prototype.d=function(c,a){var b,e;b=this.k();if(""===b.toString())return i;if("undefined"==typeof a||a===j||"undefined"==typeof this.types[a.toLowerCase()])console.error("data type "+a+" set to string"),a="string";b=this.types[a.toLowerCase()].d(b);
e="undefined"!==typeof c&&c!==j&&0<c.length?d.evaluate(c,"boolean",this.m,this.index):i;return b&&e};a.prototype.types={string:{d:m(i)},select:{d:m(i)},select1:{d:m(i)},decimal:{d:function(c){return!isNaN(c-0)&&c!==j?i:k}},"int":{d:function(c){return!isNaN(c-0)&&c!==j&&Math.round(c)==c?i:k}},date:{d:function(c){return"Invalid Date"!==(new Date(c.toString())).toString()},p:function(c){c=new Date(c);c.setUTCHours(0,0,0,0);return(new Date(c)).toUTCString()}},datetime:{d:function(c){return"Invalid Date"!==
(new Date(c)).toString()}},time:{d:function(c){return"Invalid Date"!==(new Date("2012-01-01 "+c)).toString()},p:function(c){c=new Date("2012-01-01 "+c);return y(c.getHours().toString(),2)+":"+y(c.getMinutes().toString(),2)+":"+y(c.getSeconds().toString(),2)}},barcode:{d:m(i)},geopoint:{d:m(i)},binary:{d:m(i)}}}function d(c){e=$(c)}var f,h,e,g;this.cb=function(c,a,b,d){return f.evaluate(c,a,b,d)};this.nb=function(){return h.P()};this.eb=function(){return f.get()};this.data=function(c){return new b(c)};
this.form=function(c){return new d(c)};this.fb=function(){return f.ka()};this.W=function(){return h.W()};this.a=function(){g=$("form.jr:eq(0)").clone().appendTo("<original></original>");f=new b(a);f.a();h=new d("form.jr:eq(0)");h.a()};this.Ja=function(){return f.ha(i,i)};this.K=function(){return h.pa.get()};this.ra=function(c){h.pa.set(c)};this.La=function(){return h.qa.get()};this.Va=function(c){h.qa.set(c)};this.Sa=function(){h.u.set(k)};this.fa=function(){return h.u.get()};this.reset=function(){$("#form-languages").remove();
e.replaceWith(g)};this.d=function(){return h.W()};this.B=function(){return h.B()};b.prototype.a=function(){var c,a;this.c(j,j,{t:i,F:k}).get().each(function(){a=$(this).text();$(this).text(a.trim())});c=this.c(":first",0).get();this.namespace=c.attr("xmlns");c.removeAttr("xmlns");this.da()};b.prototype.ya=function(c,a){var b,d,e=this.c(c,0,{G:i}),e=0===e.get().length?this.c(c,0):e;d=e.get().prop("nodeName");b=this.c(c,a).get();1===e.get().length&&1===b.length&&b.next().prop("nodeName")!==d?e.clone(b):
b.next().prop("nodeName")!==d&&console.error("Could not find template node and/or node to insert the clone after")};b.prototype.da=function(c){var a=this;if("undefined"==typeof c||0===c.length)c=this.H.find(":first");c.children("[template]").each(function(){"undefined"==typeof $(this).parent().attr("template")&&0===$(this).siblings($(this).prop("nodeName")).not("[template]").length&&$(this).clone().insertAfter($(this)).find("*").andSelf().removeAttr("template")});c.children().not("[template]").each(function(){a.da($(this))})};
b.prototype.get=function(){return this.H||j};b.prototype.ka=function(){return this.xml||j};b.prototype.ha=function(c,a){var b,c="undefined"!==typeof c?c:k,a="undefined"!==typeof a?a:i;b=$("<root></root");this.H.find(":first").clone().appendTo(b);c===k&&b.find("[template]").remove();a===i&&("undefined"!==typeof this.namespace&&0<this.namespace.length)&&b.children().eq(0).attr("xmlns",this.namespace);b=(new XMLSerializer).serializeToString(b.children().eq(0)[0]);b=b.replace(/xmlns\=\"[A-z0-9\:\/\.\-\%\_\?&amp;]*\"/gi,
" ");return b=b.replace(/\t/g,"")};b.prototype.Oa=function(c,a){var b,d,e,f=c;for(b=0;b<a.length;b++)d=a.eq(b).attr("name"),e=a.eq(b).siblings('[name="'+d+'"]').andSelf().index(a.eq(b)),f=f.replace(d,d+"["+(e+1)+"]");return f};b.prototype.evaluate=function(c,a,d,f){var h,g,o,a=a||"any",f=f||0;h=new b(this.ha(k,k));"undefined"!==typeof d||d!==j?(h=h.c(d,f,{}).get()[0],0<e.find('[name="'+d+'"]').parents(".jr-repeat").length&&(d=e.find('[name="'+d+'"]').eq(f).parents(".jr-repeat"),c=this.Oa(c,d))):h=
h.ka();d={"0":["any","ANY_TYPE"],1:["number","NUMBER_TYPE","numberValue"],2:["string","STRING_TYPE","stringValue"],3:["boolean","BOOLEAN_TYPE","booleanValue"],7:["nodes","ORDERED_NODE_SNAPSHOT_TYPE"],9:["node","FIRST_ORDERED_NODE_TYPE"]};for(g in d)if(g=Number(g),d[g][0]==a)break;else g=0;c=c.replace(/&lt;/g,"<");c=c.replace(/&gt;/g,">");c=c.replace(/&quot;/g,'"');try{o=document.evaluate(c,h,j,g,j);if(0===g){for(g in d)if(g=Number(g),g==Number(o.resultType))return o=0<g&&4>g?o[d[g][2]]:o,console.debug("evaluated "+
c+" to: "+o),o;console.error("Expression: "+c+" did not return any boolean, string or number value as expected")}console.debug("evaluated "+c+" to: "+o[d[g][2]]);return o[d[g][2]]}catch(u){console.error("Error occurred trying to evaluate: "+c+", message: "+u.message)}};d.prototype.a=function(){var c;this.xa();if("undefined"==typeof f||!(f instanceof b))return console.error("variable data needs to be defined as instance of DataXML");e.find('label>input[type="checkbox"], label>input[type="radio"]').parent().parent("fieldset").prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');
e.parent().find("label>select, :not(#jr-preload-items, #jr-calculated-items)>label>input").not('[type="checkbox"], [type="radio"]').parent().prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');e.find('label>input[type="checkbox"][required], label>input[type="radio"][required]').parent().parent("fieldset").find(".question-icons .required").addClass("ui-icon ui-icon-notice");e.parent().find("label>select[required], :not(#jr-preload-items, #jr-calculated-items)>label>input[required]").not('[type="checkbox"], [type="radio"]').parent().find(".question-icons .required").addClass("ui-icon ui-icon-notice");
e.find('input[type="radio"]').each(function(){c=$(this).attr("name");$(this).attr("data-name",c)});e.find("h2").first().append("<span/>");this.repeat.a();this.P();this.wa();this.Za.a();this.$.a();this.aa();this.N();this.R();this.Pa.a();this.Ua();this.u.set(k)};d.prototype.xa=function(){var c,a=[],b,d,h,g,o,u,w,Q,R,S,T,U,V,W,X,Y,I,J;w=e.find("#stats");c=parseInt(w.find('[id="jrItem"]').text(),10);b=parseInt(w.find('[id="jrInput"]').text(),10);d=parseInt(w.find('[id="jrUpload"]').text(),10);h=parseInt(w.find('[id="jrTrigger"]').text(),
10);g=parseInt(w.find('[id="jrConstraint"]').text(),10);o=parseInt(w.find('[id="jrRelevant"]').text(),10);u=parseInt(w.find('[id="jrCalculate"]').text(),10);w=parseInt(w.find('[id="jrPreload"]').text(),10);Q=e.find('input[type="radio"]').length;R=e.find('input[type="checkbox"]').length;e.find("select");S=e.find('option[value!=""]').length;T=e.find('input:not([type="radio"],[type="checkbox"])').length;U=e.find(".trigger").length;V=e.find('[data-relevant]:not([type="radio"],[type="checkbox"])').length;
W=e.find('input[data-relevant][type="radio"],input[data-relevant][type="checkbox"]').parent().parent("fieldset").length;X=e.find('[data-constraint]:not([type="radio"],[type="checkbox"])').length;Y=e.find('input[data-constraint][type="radio"],input[data-constraint][type="checkbox"]').parent().parent("fieldset").length;I=e.find("[data-calculate]").length;J=e.find("#jr-preload-items input").length;c!==S+Q+R&&console.error(" total select-type filter differs between XML form and HTML form");b+d!==T-I-
J&&console.error(" total amount of input/upload fields differs between XML form and HTML form");h!=U&&console.error(" total triggers differs between XML form and HTML form");o!=V+W&&console.error(" total amount of branches differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form)");g!=X+Y&&console.error(" total amount of constraints differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form). Note that constraints on &lt;trigger&gt; elements are ignored in the transformation and could cause this error too.");
u!=I&&console.error(" total amount of calculated items differs between XML form and HTML formprel");w!=J&&console.error(" total amount of preload items differs between XML form and HTML form");e.find("[name]").each(function(){$.inArray($(this).attr("name"),a)&&a.push($(this).attr("name"))});for(c=0;c<a.length;c++)1>f.c(a[c]).get().length&&console.error("Found name attribute: "+a[c]+" that does not have a corresponding data node. Transformation error or XML form error (relative nodesets perhaps?")};
d.prototype.input={f:function(c){var a=this.g(c.eq(0));return"radio"==a||"checkbox"==a?c.parent("label").parent("fieldset"):"fieldset"==a?c:c.parent("label")},ga:function(c){return 1!==c.length?console.error("getProps(): no input node provided or multiple"):{path:this.getName(c),L:this.Ka(c),z:this.g(c),ta:this.Na(c),ea:c.attr("data-constraint"),Ra:c.attr("data-relevant"),val:this.k(c),required:void 0!==c.attr("required")?i:k,enabled:this.isEnabled(c),multiple:this.ma(c)}},g:function(c){return 1!==
c.length?"":"input"==c.prop("nodeName").toLowerCase()?0<c.attr("type").length?c.attr("type").toLowerCase():console.error("<input> node has no type"):"select"==c.prop("nodeName").toLowerCase()?"select":"fieldset"==c.prop("nodeName").toLowerCase()?"fieldset":console.error("unexpected input node type provided")},Na:function(c){return 1!==c.length?console.error("getXMLType(): no input node provided or multiple"):c.attr("data-type-xml")},getName:function(c){return 1!==c.length?console.error("getName(): no input node provided or multiple"):
"radio"==this.g(c)?c.attr("data-name"):0<c.attr("name").length?c.attr("name"):console.error("input node has no name")},Ka:function(c){var a,b,d;if(1!==c.length)return console.error("getIndex(): no input node provided or multiple");a=this.g(c);b=this.getName(c);d=this.f(c);return("radio"===a&&b!==c.attr("name")?this.f(e.find('[data-name="'+b+'"]')):this.f(e.find('[name="'+b+'"]'))).index(d)},ma:function(c){return"checkbox"==this.g(c)||void 0!==c.attr("multiple")?i:k},isEnabled:function(c){return void 0!==
c.attr("disabled")||0!==c.parents("fieldset:disabled").length?k:i},k:function(c){var a,b=[],d;if(1!==c.length)return console.error("getVal(): no inputNode provided or multiple");a=this.g(c);d=this.getName(c);return"radio"==a?this.f(c).find("input:checked").val()||"":"checkbox"==a?(this.f(c).find('input[name="'+d+'"]:checked').each(function(){b.push($(this).val())}),b):c.val()||""},j:function(c,a,b){a=a||0;if("radio"==this.g(e.find('[data-name="'+c+'"]').eq(0)))return this.f(e.find('[data-name="'+
c+'"]')).eq(a).find('input[value="'+b+'"]').attr("checked",i);c=this.f(e.find('[name="'+c+'"]')).eq(a).find("input, select, textarea");this.ma(c.eq(0))===i&&(b=b.split(" "));return c.val(b)}};d.prototype.P=function(){var c,a,b,d=this;f.c(j,j,{t:i}).get().each(function(){b=$(this).text();c=f.c($(this).prop("nodeName")).get().index($(this));a=d.Ha($(this));d.input.j(a,c,b)})};d.prototype.Ua=function(){var c,a,b,d=this,f=e.find("#form-languages").attr("data-default-lang");$("#form-languages").detach().insertBefore($("form.jr").parent());
if(!f||""===f)f=$("#form-languages a:eq(0)").attr("lang");console.debug("default language is: "+f);2>$("#form-languages a").length?(e.find("[lang]").addClass("active"),e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")}),this.S()):($("#form-languages a").click(function(f){f.preventDefault();c=$(this).attr("lang");$("#form-languages a").removeClass("active");$(this).addClass("active");e.find("[lang]").removeClass("active").filter('[lang="'+
c+'"], [lang=""]').addClass("active");e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")});e.find("select>option").not('[value=""]').each(function(){a=$(this).attr("value");b=$(this).parent("select").next(".jr-option-translations").children('.active[data-option-value="'+a+'"]').text().trim();b="undefined"!==typeof b&&0<b.length?b:"[MISSING TRANSLATION]";$(this).text(b)});e.find("legend span.active:not(.jr-hint, .jr-constraint-msg), label span.active:not(.jr-hint, .jr-constraint-msg)").each(function(){0===
$(this).text().trim().length&&$(this).text("[MISSING TRANSLATION]")});d.S();e.trigger("changelanguage")}),$('#form-languages a[lang="'+f+'"]').click())};d.prototype.S=function(){var c,a;e.find("*>.jr-hint").parent().each(function(){a="label"!==$(this).prop("nodeName").toLowerCase()&&"fieldset"!==$(this).prop("nodeName").toLowerCase()?$(this).parent("fieldset"):$(this);c=0<a.length?$(this).find(".jr-hint.active").text().trim():$(this).find("span.jr-hint").text().trim();0<c.length?a.find(".question-icons .hint").attr("title",
c).addClass("ui-icon ui-icon-help"):a.find(".question-icons .hint").removeAttr("title").removeClass("ui-icon ui-icon-help")});e.tooltip()};d.prototype.u={set:function(c){e.attr("data-edited",c.toString());e.trigger("edit",c)},get:function(){return"true"===e.attr("data-edited")?i:k}};d.prototype.pa={set:function(c){e.attr("data-stored-with-key",c);e.find("h2 span").text(c)},get:function(){return e.attr("data-stored-with-key")||j},reset:function(){e.removeAttr("data-stored-with-key")}};d.prototype.qa=
{set:function(c){e.attr("data-stored-final",c.toString())},get:function(){return"true"===e.attr("data-stored-final")?i:k},reset:function(){e.removeAttr("data-stored-final")}};d.prototype.$={a:function(){e.on("click",".jr-branch",function(){var c=$(this);$(this).hasClass("busy")||($(this).hasClass("show")?$(this).addClass("busy").removeClass("show").next().hide("blind",{},600,function(){c.removeClass("busy")}):$(this).addClass("busy show").next().show("blind",{},600,function(){c.removeClass("busy");
c.next().v()}))});this.update()},update:function(c){var a,b,d,g,v,o={},u=this;g="undefined"!==typeof c?c.split(","):[];v=0<g.length?[]:["[data-relevant]"];for(c=0;c<g.length;c++)v.push('[data-relevant*="'+g[c]+'"]');e.find(v.join()).each(function(){a=h.input.ga($(this));b=h.input.f($(this));if(!("radio"==a.z||"checkbox"==a.z)||!o[a.path]){if(1!==b.length)return console.error("could not find branch node"),k;try{d=f.evaluate(a.Ra,"boolean",a.path,a.L)}catch(c){return console.error('Serious error occurred trying to evaluate skip logic for node with name: "'+
a.path+'" (message: '+c.message+")"),k}o[a.path]=i;return d===i?u.enable(b):u.disable(b)}})},enable:function(c){c.prev(".jr-branch").hide("slow",function(){$(this).remove()});c.removeClass("disabled").show("blind",{direction:"up"},1E3,function(){$(this).v()});return"label"==c.prop("nodeName").toLowerCase()?c.children("input, select, textarea").removeAttr("disabled"):c.removeAttr("disabled")},disable:function(c){c.addClass("disabled").hide();0===c.prev(".jr-branch").length&&(c.before('<div class="jr-branch ui-corner-all"></div>'),
c.ca("change"));return"label"==c.prop("nodeName").toLowerCase()?c.children("input, select, textarea").attr("disabled","disabled"):c.attr("disabled","disabled")}};d.prototype.N=function(c){var a,b,d,h="";console.log("updating active outputs that contain: "+c);b="undefined"!==typeof c?c.split(","):[];d=0<b.length?[]:[".jr-output[data-value]"];for(c=0;c<b.length;c++)d.push('.jr-output[data-value*="'+b[c]+'"]');e.find(":not([disabled]) span.active").find(d.join()).each(function(){try{a=$(this).attr("data-value"),
h=f.evaluate(a,"string")}catch(c){console.error("error occurred trying to evaluate output value from expression: "+a+", (message:"+c.message+")"),h="[ERROR]"}$(this).text(h)});e.v();this.S()};d.prototype.aa=function(c){var a,b,d,h,g,o,u;o="undefined"!==typeof c?c.split(","):[];u=0<o.length?[]:["input[data-calculate]"];for(c=0;c<o.length;c++)u.push('input[data-calculate*="'+o[c]+'"]');e.find("#jr-calculated-items").find(u.join()).each(function(){a=$(this).attr("name");b=$(this).attr("data-calculate");
d=$(this).attr("data-type-xml");g=$(this).attr("data-constraint");h=f.evaluate(b,"string",a,j);f.c(a,j).j(h,g,d)})};d.prototype.wa=function(){e.find(".jr-group, .jr-repeat").addClass("ui-corner-all");e.find("h2#form-title").addClass("ui-widget-header ui-corner-all");e.find(".trigger").addClass("ui-state-highlight ui-corner-all");$("fieldset:not(.jr-appearance-compact)>label, fieldset:not(.jr-appearance-compact)>legend").children("img,video,audio").parent().addClass("ui-helper-clearfix with-media")};
d.prototype.Za={a:function(){this.za();this.Da();this.Wa();this.Ca();this.Qa();this.Ia();this.va()},za:function(){e.find(".jr-appearance-compact>label>span").hide()},Da:function(){Modernizr.inputtypes.date||e.find('input[type="date"]').datepicker({})},Wa:function(){Modernizr.inputtypes.time||e.find('input[type="time"]').timepicker({})},Ca:function(){Modernizr.inputtypes.datetime||e.find('input[type="datetime"]').datetimepicker()},mb:function(){e.find("select:not([multiple])").attr("size","1");$("select:not([multiple])").multiselect({multiple:k,
header:"Select one option",noneSelectedText:"Select one option",selectedList:1,position:{my:"left top",at:"left bottom"}})},lb:function(){e.find("select[multiple]").attr("size","5").find('[value=""]').remove();$("select[multiple]").multiselect({header:"false",position:{my:"left top",at:"left bottom"}})},Qa:function(){e.find('input[readonly]:not([data-type-xml="geopoint"])').parent("label").each(function(){var c=$(this).html(),a=$(this).find("input").attr("data-relevant"),b='name="'+$(this).find("input").attr("name")+
'"';$('<fieldset class="trigger ui-state-highlight ui-corner-all" '+("undefined"!==typeof a?'data-relevant="'+a+'" '+b:b)+"></fieldset>").insertBefore($(this)).append(c).find("input").remove();$(this).remove()})},hb:l(),qb:l(),pb:l(),Ia:function(){e.find('input[data-type-xml="geopoint"]').attr("placeholder","Awesome geopoint widget will follow in the future!")},ab:l(),va:function(){e.find('input[data-type-xml="barcode"]').attr("placeholder","This probably does not require support for browser data entry.")}};
d.prototype.Pa={a:function(){var a,b,d,h,g=this;e.find("#jr-preload-items input").each(function(){a=$(this).attr("data-preload").toLowerCase();b=$(this).attr("data-preload-params").toLowerCase();d=$(this).attr("name");"undefined"!==typeof g[a]?(h=f.c(d).k(),g.j($(this),g[a]({param:b,q:h,c:$(this)}))):console.error('Preload "'+a+'"" not supported. May or may not be a big deal.')})},j:function(a,b){a.val(b.toString()).trigger("change")},timestamp:function(a){var b=this;return"start"==a.param&&""!==
a.q?""===a.q?a.q:f.evaluate("now()","string"):"end"==a.param?(e.on("beforesave",function(){b.j(a.c,f.evaluate("now()","string"))}),f.evaluate("now()","string")):""},date:function(a){var b,d;return""!==a.q?(b=new Date(f.evaluate("today()","string")),a=y(b.getUTCFullYear().toString(),4),d=y((b.getUTCMonth()+1).toString(),2),b=y(b.getUTCDate().toString(),2),a+"-"+d+"-"+b):a.q},property:m("no property preload in Rapaide"),context:function(a){return"application"==a.param?"rapaide":""},patient:m("not supported in Rapaide"),
user:m("user preload item not functioning yet"),uid:m("no uid"),browser:function(a){if("name"==a.param)return $.browser.webkit?"webkit":$.browser.mozilla?"mozilla":$.browser.opera?"opera":$.browser.msie?"msie":"unknown";if("version"==a.param)return $.browser.version},os:m("not known")};d.prototype.repeat={a:function(){var a,b,d,h,g,v=this;e.find("fieldset.jr-repeat").prepend('<span class="repeat-number"></span>');e.find("fieldset.jr-repeat:not([data-repeat-fixed])").append('<button type="button" class="repeat"></button><button type="button" class="remove"></button>');
e.find("button.repeat").button({text:k,icons:{primary:"ui-icon-plusthick"}});e.find("button.remove").button({disabled:i,text:k,icons:{primary:"ui-icon-minusthick"}});e.on("click","button.repeat:enabled",function(){v.clone($(this).parent("fieldset.jr-repeat"));return k});e.on("click","button.remove:enabled",function(){v.remove($(this).parent("fieldset.jr-repeat.clone"));return k});e.find("fieldset.jr-repeat").each(function(){d=$(this).attr("data-repeat-count")||"";b=0<d.length?parseInt(f.c(d).k(),
10):0;h=f.c($(this).attr("name")).get().length;g=b>h?b:h;for(a=1;a<g;a++)v.clone($(this).siblings().andSelf().last(),"")})},clone:function(a,b){var d,h,g,v,o,u,w=this;if(1!==a.length)return console.error("Nothing to clone"),k;d=a.parent("fieldset.jr-group").children("fieldset.jr-repeat:not(.clone)").eq(0);h=d.clone(k);h.find(".clone").remove();h.addClass("clone");h.find("button.remove").button({text:k,icons:{primary:"ui-icon-minusthick"}});h.find("button.repeat").button({text:k,icons:{primary:"ui-icon-plusthick"}});
h.insertAfter(a).parent(".jr-group").oa();h.hide().show("highlight",{},600);h.ca(b);h.find(".invalid input, .invalid select, .invalid textarea").each(function(){w.U($(this))});g=e.find('fieldset.jr-repeat[name="'+a.attr("name")+'"]').index(a);v=[];h.find('input[type="radio"]').each(function(){-1===$.inArray($(this).attr("data-name"),v)&&v.push($(this).attr("data-name"))});for(o=0;o<v.length;o++)u=(new Date).getTime().toString(),h.find('input[type="radio"][data-name="'+v[o]+'"]').attr("name",u);this.sa(d.parent());
d=d.attr("name");0<d.length&&0<=g&&f.ya(d,g);e.trigger("changerepeat");return i},remove:function(a){var b=this,d=a.attr("name"),h=e.find('[name="'+d+'"]').index(a),g=a.parent("fieldset.jr-group");a.hide("drop",{},600,function(){a.remove();g.oa();b.sa(g)});f.c(d,h).remove();e.trigger("changerepeat")},sa:function(a){a="undefined"==typeof a||0===a.length||!a?a=e:a;a.find("button.repeat, button.remove").button("disable").removeClass("ui-state-hover");a.find("fieldset.jr-repeat:last-child > button.repeat").button("enable");
a.find("fieldset.jr-repeat:not(:nth-child(2)) > button.remove").button("enable")}};d.prototype.R=function(){var a,b,d=this;$("form.jr").attr("onsubmit","return false;");e.on("change validate","input, select, textarea",function(e){a=d.input.ga($(this));b="validate"==e.type?a.enabled&&"hidden"!==a.z?f.c(a.path,a.L).d(a.ea,a.ta):i:f.c(a.path,a.L).j(a.val,a.ea,a.ta);b=a.enabled&&"hidden"!==a.z&&a.required&&1>a.val.length?k:b;if("undefined"!==typeof b&&b!==j)return b===k?d.Ta($(this)):d.U($(this))});e.on("dataupdate",
function(a,b){d.aa(b);d.$.update(b);d.N(b)});e.on("change changerepeat",function(){d.u.set(i)});e.on("changerepeat",function(){d.P()});$(window).resize(function(){e.v()});e.on("changelanguage",function(){d.N()})};d.prototype.U=function(a){this.input.f(a).removeClass("invalid ui-state-error")};d.prototype.Ta=function(a){this.input.f(a).addClass("invalid ui-state-error")};d.prototype.Ha=function(a){for(var b=[a.prop("nodeName")],a=a.parent();1==a.length&&"#document"!==a.prop("nodeName");)b.push(a.prop("nodeName")),
a=a.parent();return"/"+b.reverse().join("/")};d.prototype.W=function(){var a=this;e.find("fieldset:disabled input, fieldset:disabled select, fieldset:disabled textarea, input:disabled, select:disabled, textarea:disabled").each(function(){a.U($(this))});e.find("input, select, textarea").trigger("validate");return this.B()};d.prototype.B=function(){return 0<e.find(".invalid").length?k:i}}s.prototype.Q=l();var F=jQuery;
F.fn.oa=function(){this.each(function(){F(this).find("fieldset.jr-repeat").each(function(){var a,b,d;0===F(this).prev("fieldset.jr-repeat").length&&(a=F(this).siblings("fieldset.jr-repeat"),b=a.length+1,1<b?(F(this).find("span.repeat-number").text("1"),d=2,a.each(function(){F(this).find("span.repeat-number").text(d);d++})):F(this).find("span.repeat-number").empty())})})};
F.fn.ca=function(a){a=a||"edit";this.each(function(){F(this).find("input, select, textarea").each(function(){var b=F(this).attr("type");"SELECT"===F(this).prop("nodeName").toUpperCase()&&(b="select");"TEXTAREA"===F(this).prop("nodeName").toUpperCase()&&(b="textarea");switch(b){case "date":case "number":case "search":case "color":case "range":case "url":case "email":case "password":case "text":case "file":case "hidden":case "textarea":F(this).val("").trigger(a);break;case "radio":case "checkbox":F(this).prop("checked")&&
(F(this).prop("checked",k),F(this).trigger(a));break;case "select":F(this)[0].selectedIndex=-1;F(this).trigger(a);break;default:console.error("Unrecognized input type found when trying to reset: "+b)}})})};F.fn.v=function(){var a;this.each(function(){F(this).find("legend + label").each(function(){a=0<F(this).prev().find(".jr-constraint-msg.active").length&&36>F(this).prev().height()?36:19>F(this).prev().height()?19:F(this).prev().height();F(this).animate({"margin-top":a+6+"px"},600)})})};
F.fn.X=function(a){var b,d,a=a.replace(/\/\//g," "),a=a.replace(/^\//,""),a=a.replace(/\/\.$/,""),a=a.replace(/\//g,">"),a=a.replace(/\[([^@].*?)\]/g,function(a,b){return":has("+b+")"});if(0<=a.indexOf(">..")){a=a.split(/>\.\.>?/g);b=jQuery(a[0],this);for(d=1;d<a.length;d++)b=b.parent(a[d]);return b.get()}return this.find(a)};var G,H,K,L,B,r={autoUpload:i,buttonLocation:"bottom",autoNotifyBackup:k};
$(document).ready(function(){var a,b,d;B=new aa;G=new E(jrDataStr);L=new A;L.a();H=new M;B.isSupported()?$(document).trigger("browsersupport","local-storage"):window.location="modern_browsers";b=(a=B.r("__bookmark"))?a.shown:0;3>b&&setTimeout(function(){d=1===b?"time":"times";x("Please bookmark this page for easy offline launch. This reminder will be shown "+(2-b)+" more "+d+".",20);b++;B.T("__bookmark",{shown:b})},5E3);$("html").attr("manifest")&&(K=new ba,K.a(),K.isSupported()?($(document).trigger("browsersupport",
"offline-launch"),ca(),window.setInterval(function(){ca()},36E5)):(a={l:"Show options",D:"Use it",i:function(){window.location="modern_browsers"}},q.confirm({msg:"Offline application launch not supported by your browser. You can use it without this feature or see options for resolving this",heading:"Application cannot launch offline"},a)),console.log("cache initialized"));G.a();H.a();q.V();$("form.jr").trigger("save",JSON.stringify(B.w()))});
function ca(){K.checkForUpdate();window.setTimeout(function(){console.log("going to provide cache feedback to user. cache.getError="+K.getError());K.Xa()?x("A new version of this application has been downloaded. Please save your work and refresh to update.",20):K.getError()&&("security"===K.getError()?x("Please allow site to store data for offline use and refresh.",60):q.alert("An error occurred with the application cache. You may have a problem launching offline (error: "+K.getError()+"). Please save your work, refresh and check if offline launch works."))},
3E4)}function da(a,b){var d;!b&&G.fa()?(d={posAction:function(){da("'+formName+'",i)}},q.confirm("Would you like to proceed without saving changes to the form you were working on?",d)):(d=B.r(a),d.data!==j?(G.reset(),G=new E(d.data),G.a(),G.ra(a),$("#page-close").click(),$("button#delete-form").button("enable"),x('"'+a+'" has been loaded',2)):q.alert("Record contained no data"))}
function N(a,b,d,f){var h;h=G.K();var e=G.La(),g={};g.data=G.Ja();g.ready=b;console.debug("new name: "+a+", before: "+h+", delOld: "+d+", overwr: "+f);if(g.data===j||""===g.data)return x("Nothing to save.");if("undefined"==typeof a||0===a.length){h=h||B.getCounterValue();$('#dialog-save input[name="record-name"]').val(h);$('#dialog-save input[name="record-final"]').attr("checked",e);h=q;var c=$("#dialog-save");h.confirm({dialog:"save",msg:"",heading:"Record Details"},{posButton:"Ok",negButton:"Cancel",
posAction:function(){return N(c.find('[name="record-name"]').val(),Boolean(c.find('[name="record-final"]:checked').val()))},negAction:m(k),beforeAction:function(){G.B()?(console.log("form valid"),c.find('[name="record-final"]').removeAttr("disabled")):(console.log("form invalid"),c.find('[name="record-final"]').attr("disabled","disabled"))}})}else{if(h&&h!==a&&"undefined"==typeof d)return f={l:"Yes, delete",D:"No, keep",i:function(){N(a,b,i)},C:function(){N(a,b,k)}},q.confirm({msg:"Record name has changed. Would you like to delete the record saved under the old name:"+
h+"?",heading:"Delete old Record?"},f);$("form.jr").trigger("beforesave");h=B.T(a,g,d,f,h);console.log("result of save: "+h);"success"===h?(x('Form with name "'+a+'" has been saved.',2),G.ra(a),G.Va(b),G.Sa(),$("button#delete-form").button("enable"),$("form.jr").trigger("save",JSON.stringify(B.w()))):"existing"===h?(f={l:"Yes, overwrite",i:function(){N(a,b,d,i)},C:function(){x("Form was not saved.")}},q.confirm("Record with name "+a+" already exists. Would you like to overwrite existing record? ",
f)):"forbidden"===h?(q.alert("This name is not allowed. Please change it"),x("Form was NOT saved.")):x("Error occurred. Form was NOT saved.")}}function Z(a){!a&&G.fa()?(a={i:function(){Z(i)}},q.confirm("There are unsaved changes, would you like to reset without saving those?",a)):(G.reset(),G=new E(jrDataStr),G.a(),$("button#delete-form").button("disable"))}
function ea(a){var b=G.K();""!==b&&b!==j?a?B.O(b)?(Z(i),x("Successfully deleted form."),$("form.jr").trigger("delete",JSON.stringify(B.w()))):x("An error occurred when trying to delete this form."):(a={l:"Delete",i:function(){ea(i)}},q.confirm("Please confirm that you would like to remove this form from storage.",a)):x("Please first load the form you would like to delete or choose reset if you'd like to reset the current form.")}
function ba(){var a,b,d,f;this.a=function(){window.applicationCache&&(a="html5Cache",b=window.applicationCache,b.addEventListener("updateready",function(){b.swapCache();d=i},k),b.addEventListener("error",function(){console.log("HTML5 cache error event");fa()&&(console.log("noticed online status"),f="error downloading application")},k))};this.isSupported=function(){return"html5Cache"===a||"gearsCache"===a?i:k};this.checkForUpdate=function(){console.log("checking for cache update");try{b.update()}catch(a){"NS_ERROR_DOM_SECURITY_ERR"===
a.name&&(f="security"),console.log("error thrown during cache update. error name: "+a.name+"  message: "+a.message)}};this.Xa=function(){console.log("updateReady() returns: "+d);return d};this.getError=function(){return f}}function M(){var a=this;this.Ya=k;this.a=function(){$(window).on("offline online",function(){var b=fa();b!==a.Ba&&(console.log("status changed to: "+b+", triggering window.onlinestatuschange"),$(window).trigger("onlinestatuschange",b));a.Ba=b});$(window).trigger("online")}}
function fa(){console.log("checking connection status");return navigator.onLine}M.prototype.upload=function(a,b){var d="true"===D()||D()===i?i:k;if(("undefined"==typeof this.n||0===this.n.length)&&(d===i||a)){this.e={o:[],fail:[],Ga:a};this.n=B.ia(i,b);if(0===this.n.length)return a?x('Nothing marked "final" to upload (or record is currently open).'):k;ga(this)}};
function ga(a){var b,d,f;0<a.n.length&&(b=a.n.pop(),d=new FormData,d.append("xml_submission_data",b.data),d.append("Date",(new Date).toUTCString()),f=0===a.n.length?i:k,$.ajax("data/submission",{type:"POST",data:d,bb:k,contentType:k,processData:k,complete:function(d){var e=d.status,g=b.name,c,d="";c=[];var n={"0":{success:k,b:"Uploading of data failed (probably offline)"},200:{success:k,b:"Data server did not accept data for "+g+". Contact Enketo helpdesk please."},201:{success:i,b:""},202:{success:i,
b:g+" may have had errors. Contact survey administrator please."},"2xx":{success:k,b:"Unknown error occurred when submitting data for "+g+". Contact Enketo helpdesk please"},400:{success:k,b:"Data server did not accept data for "+g+" Contact survey administrator please."},403:{success:k,b:"You are not allowed to post data to this data server. Contact survey administrator please."},404:{success:k,b:"Submission area on data server not found or not properly configured."},"4xx":{success:k,b:"Unknown submission problem on data server."},
413:{success:k,b:"Data for "+g+" is too large. Please export the data and contact the Enketo helpdesk please."},500:{success:k,b:"Sorry, the Enketo server is down or being maintained. Please try again later or contact Enketo helpdesk please."},503:{success:k,b:"Sorry, the Enketo server is down or being maintained. Please try again later or contact Enketo helpdesk please."},"5xx":{success:k,b:"Sorry, the Enketo server is down or being maintained. Please try again later or contact Enketo helpdesk please."}};
console.debug("name: "+g);console.debug(e);"undefined"!==typeof n[e]?n[e].success===i?(B.O(g),$("form.jr").trigger("delete",JSON.stringify(B.w())),console.log("tried to remove record with key: "+g),a.e.o.push([g,n[e].b])):n[e].success===k&&a.e.fail.push([g,n[e].b]):500<e?(console.error("error during uploading, received unexpected statuscode: "+e),a.e.fail.push([g,n["5xx"].b])):400<e?(console.error("error during uploading, received unexpected statuscode: "+e),a.e.fail.push([g,n["4xx"].b])):200<e&&
(console.error("error during uploading, received unexpected statuscode: "+e),a.e.fail.push([g,n["2xx"].b]));if(f===i){if(0<a.e.o.length){for(e=0;e<a.e.o.length;e++)c.push(a.e.o[e][0]),d="undefined"!==typeof a.e.o[e][2]?d+a.e.o[e][1]+" ":"";c=c.join(", ");x(c.substring(0,c.length)+(1<e?" were":" was")+" successfully uploaded. "+d)}if(0<a.e.fail.length&&a.e.Ga===i){for(e=0;e<a.e.fail.length;e++)d+=a.e.fail[e][0]+": "+a.e.fail[e][1]+"<br />";q.alert(d,"Failed data submission")}a.Ya=k}ga(a)}}))}
A.prototype.autoUpload=l();A.prototype.buttonLocation=function(a){$("#form-controls").removeClass("bottom right mobile").addClass(a);$(window).trigger("resize")};
s.prototype.Q=function(){var a=this;$("button#save-form").button({icons:{primary:"ui-icon-disk"}}).click(function(){G.d();N()});$("button#reset-form").button({icons:{primary:"ui-icon-refresh"}}).click(function(){Z()});$("button#delete-form").button({icons:{primary:"ui-icon-trash"},disabled:i}).click(function(){ea(k)});$("#form-controls button").Fa();$(document).on("click","#records-saved li:not(.no-click)",function(a){a.preventDefault();a=$(this).find(".name").text();da(a);$(this).siblings().removeClass("ui-state-active");
$(this).addClass("ui-state-active")}).on("mouseenter","#records-saved li:not(.no-click)",function(){$(this).addClass("ui-state-hover")}).on("mouseleave","#records-saved li:not(.no-click)",function(){$(this).removeClass("ui-state-hover")});t(this).get("records").find("button#records-force-upload").button({icons:{primary:"ui-icon-arrowthick-1-n"}}).click(function(){H.upload(i,G.K())}).hover(function(){$("#records-force-upload-info").show()},function(){$("#records-force-upload-info").hide()});t(this).get("records").find("button#records-export").button({icons:{primary:"ui-icon-suitcase"}}).click(function(){var a;
(a=B.Ma(k||i))?(a="data:text/xml,"+encodeURIComponent(a),window.open(a,"exportedData")):q.alert('No data marked "final" to export.')}).hover(function(){$("#records-export-info").show()},function(){$("#records-export-info").hide()});$(document).on("save delete","form.jr",function(b,d){console.debug("save or delete event detected with new formlist: "+d);var f=JSON.parse(d),h,e,g,c,n,C,P=0,O=0;console.debug("updating recordlist in GUI");h||(h=t(a).get("records"));C=h.find("#records-saved ol");C.children().remove();
f=f||[];if(0<f.length)for(c=0;c<f.length;c++)e=f[c].key,g=(new Date(f[c].s)).toDateString(),f[c].ready===i?(n="check",P++):(n="pencil",O++),g=$('<li><span class="ui-icon ui-icon-'+n+'"></span><span class="name"></span><span class="date"> ('+g+")</span></li>"),g.find(".name").text(e),C.append(g);else $('<li class="no-click">no locally saved records found</li>').appendTo(C);h.find("#records-draft-qty").text(O);h.find("#records-final-qty").text(P)});$(document).on("setsettings",function(b,d){console.debug("settingschange detected, GUI will be updated with settings:");
console.debug(d);var f;console.log("gui updateSettings() started");$.each(d,function(b,d){f=d?t(a).get("settings").find('input[name="'+b+'"][value="'+d+'"]'):t(a).get("settings").find('input[name="'+b+'"]');0<f.length&&f.attr("checked",d?i:k).trigger("change")})});t(this).get("settings").on("change","input",function(){var a=$(this).attr("name"),d=$(this).is(":checked")?$(this).val().toString():"";console.debug("settings change by user detected");L.set(a,d)});$("#dialog-save").hide()};