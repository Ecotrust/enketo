var h=!0,j=null,k=!1;function l(){return function(){}}function m(b){return function(){return b}}var q,s;$(document).ready(function(){s=new t;s.b();"undefined"==typeof console&&(console={log:l()});"undefined"==typeof window.console.debug&&(console.debug=console.log);"true"!==u("debug")&&(window.console.log=l(),window.console.debug=l())});function t(){}q=t.prototype;
q.b=function(){Modernizr.borderradius&&(Modernizr.boxshadow&&Modernizr.csstransitions&&Modernizr.opacity)&&$(document).trigger("browsersupport","fancy-visuals");this.z.J();var b,c,d,f,g;b=$("#feedback-bar").css("background-color");c=$("header").css("border-top-color");$("header").css("background-color");$("body").removeClass("ui-widget-content");$("nav").addClass("ui-state-default");$("nav").css("color");d=$("nav").css("background-color");$("nav").addClass("ui-state-hover");f=$("nav").css("background-color");
$("nav").addClass("ui-state-active");g=$("nav").css("background-color");$("nav").removeClass();$("#page, #form-controls").css("background-image","none");$("#page, #component").css("color",b);$("#survey-info").css("color",c);b=$("body").addClass("ui-widget-shadow").css("background-color");$("body").css("background-color",b).removeClass("ui-widget-shadow");b=$("#page-content").addClass("ui-widget-overlay").css("background-color");$("#page-content, #overlay").css("background-color",b).removeClass("ui-widget-overlay");
$(".page a, .page a:link, .page a:visited").css("color",d).hover(function(){$(this).css("color",f)},function(){$(this).css("color",d)}).mousedown(function(){$(this).css("color",g)}).mouseup(function(){$(this).css("color",d)});$(".tabs-nohdr .ui-tabs-panel").css("background-color","#FEEEBD");this.z.reset();w(this).b();this.F();"function"===typeof this.D&&this.D();$("footer").detach().appendTo("#container")};q.J=function(){$(window).trigger("resize")};
q.F=function(){var b=this;$("#feedback-bar-close").button({icons:{primary:"ui-icon-closethick"},text:k}).click(function(b){b.preventDefault();$("#feedback-bar p").remove();$("#feedback-bar").trigger("change")});$("#page-close").button({icons:{primary:"ui-icon-closethick"},text:k}).click(function(c){c.preventDefault();w(b).close()});$("#feedback-bar-close, #page-close").removeClass().addClass("custom-button ui-widget-header ui-corner-all");$('a[href^="#"]:not(nav ul li a)').click(function(b){var d=
$(this).attr("href");"#"!==d&&(b.preventDefault(),$('nav li a[href="'+d+'"]').click())});$('nav ul li a[href^="#"]').click(function(c){c.preventDefault();c=$(this).attr("href").substr(1);w(b).open(c)}).hover(l(),l());$(window).on("onlinestatuschange",function(c,d){b.updateStatus.ha(d)});$(document).on("edit","form.jr",function(){b.updateStatus.ka(h)});$(document).on("browsersupport",function(c,d){b.updateStatus.support(d)});$("#page, #feedback-bar").on("change",function(){b.display()});$("header #status-connection").click(function(b){x($(this).attr("title"));
b.stopPropagation()});$(window).resize(function(){$("#container").css("top",$("header").outerHeight());$("body:not(.no-scroll) #container").height($(window).height()-$("header").outerHeight()-$("#form-controls.bottom").outerHeight());var b=$("nav").offset().left,d=$("#logo").offset().left+$("#logo").outerWidth();b<d?$("#logo").css("visibility","hidden"):$("#logo").css("visibility","visible")})};
q.z={J:function(){$("article.page").each(function(){var b,c="",d;d=$(this).attr("id");b=$(this).attr("data-display")?$(this).attr("data-display"):d;c=$(this).attr("data-title")?$(this).attr("data-title"):d;d=$(this).attr("data-ext-link")?$(this).attr("data-ext-link"):"#"+d;$('<li class="ui-corner-tl ui-corner-tr"><a href="'+d+'" title="'+c+'" >'+b+"</a></li>").appendTo($("nav ul"))})},reset:l()};
function w(b){b.b=function(){this.u=$("<pages></pages>");$("article.page").detach().appendTo(this.u)};b.get=function(b){b=this.u.find('article[id="'+b+'"]');return 1===b.length?b:j};b.K=function(){return 0<$("#page article.page").length};b.open=function(b){var d=this.get(b);if(1!==d.length)return console.error("page not found");this.K()&&this.close();d.find(".scrollbar").aa();$("#page-content").prepend(this.get(b).show()).trigger("change");$("#overlay").show();setTimeout(function(){$("#overlay, header").bind("click.pageEvents",
function(){$("#page-close").trigger("click")})},50);$(window).bind("resize.pageEvents",function(){$("#page").trigger("change")})};b.close=function(){var b;b=$("#page .page").detach();this.u.append(b);$("#page").trigger("change");this.z.reset();$("#overlay").hide();$("#overlay, header").unbind(".pageEvents");$(window).unbind(".pageEvents")};return b}
function x(b,c){var d,c=c?1E3*c:1E4;$("#feedback-bar p").eq(1).remove();$("#feedback-bar p").html()!==b&&(d=$("<p></p>"),d.text(b),$("#feedback-bar").prepend(d));$("#feedback-bar").trigger("change");setTimeout(function(){d.remove();$("#feedback-bar").trigger("change")},c)}q.alert=function(b,c){var d,f=$("#dialog-alert"),c=c||"Alert";d=function(){f.dialog("destroy");f.find("#dialog-alert-msg").text("")};f.find("#dialog-alert-msg").text(b).da();f.dialog({title:c,modal:h,resizable:k,buttons:{Ok:d},beforeClose:d})};
q.updateStatus={ha:function(b){console.log("updating online status in menu bar to:");console.log(b);b?$("header #status-connection").removeClass().addClass("ui-icon ui-icon-signal-diag").attr("title","It appears there is currently an Internet connection available."):$("header #status-connection").removeClass().addClass("ui-icon ui-icon-cancel").attr("title","It appears there is currently no Internet connection")},ka:function(b){b?$("header #status-editing").removeClass().addClass("ui-icon ui-icon-pencil").attr("title",
"Form is being edited."):$("header #status-editing").removeClass().attr("title","")},support:function(b){console.debug('"this" in updateStatus.supported:');console.debug(this);var c=w(s).get("settings");console.debug("updating browser support for "+b);c.find("#settings-browserSupport-"+b+" span.ui-icon").addClass("ui-icon-check")}};
q.display=function(){var b,c;c=$("header");var d=$("#feedback-bar"),f=$("#page");0<d.find("p").length?(b=c.outerHeight(),c=w(this).K()?c.outerHeight()+d.outerHeight():c.outerHeight()+d.outerHeight()-f.outerHeight()):(b=c.outerHeight()-d.outerHeight(),c=w(this).K()?c.outerHeight():c.outerHeight()-f.outerHeight());d.css("top",b);f.css("top",c)};
function u(b){for(var c=window.location.search.substring(1).split("&"),d=0;d<c.length;d++){var f=c[d].split("=");if(f[0]==b)return encodeURI(f[1])}return k}var y=jQuery;y.fn.ya=function(){var b=0;return this.each(function(){y(this).width()>b&&(b=y(this).width())}).each(function(){y(this).width(b)})};y.fn.reverse=[].reverse;
y.fn.N=function(b){b=y.extend({W:"!@#$%^&*()+=[]\\';,/{}|\":<>?~`.- ",f:"",v:""},b);this.each(function(){b.Da&&(b.f+="ABCDEFGHIJKLMNOPQRSTUVWXYZ");b.wa&&(b.f+="abcdefghijklmnopqrstuvwxyz");for(var c=b.v.split(""),d=0;d<c.length;d++)-1!=b.W.indexOf(c[d])&&(c[d]="\\"+c[d]);b.v=c.join("|");var f=b.W+b.f,f=f.replace(RegExp(b.v,"gi"),"");y(this).keypress(function(b){var c;c=b.charCode?String.fromCharCode(b.charCode):String.fromCharCode(b.which);f.indexOf(c)!=-1&&b.preventDefault();b.ctrlKey&&c=="v"&&b.preventDefault()});
y(this).bind("contextmenu",m(k))})};y.fn.Ea=function(b){var c="abcdefghijklmnopqrstuvwxyz",c=c+c.toUpperCase(),b=y.extend({f:c},b);return this.each(function(){y(this).N(b)})};y.fn.alpha=function(b){b=y.extend({f:"1234567890"},b);return this.each(function(){y(this).N(b)})};
y.fn.da=function(){var b;b||(b=1);var c=this.contents().filter(function(){return 3==this.nodeType}).first(),d=c.text();b=d.split(" ",b).join(" ");c.length&&(c[0].nodeValue=d.slice(b.length),c.before('<span class="capitalize">'+b+"</span>"))};
y.fn.aa=function(){this.each(function(){var b=y(this),c=y(this).find("ol");b.css("overflow","hidden");var d=c.height()-b.height();if(0<d){var f=d/c.height(),f=Math.round((1-f)*b.height()),f=f-f%2;y("#records .column.middle").html('<div id="slider-wrap" class="ui-corner-all"><div id="slider-vertical"></div></div>');y("#slider-wrap").height(b.outerHeight());y("#slider-vertical").slider({orientation:"vertical",Fa:"max",min:0,max:100,value:100,Ja:function(b,e){c.css({top:-((100-e.value)*d/100)})}});y("#slider-wrap").css("margin-top",
y("#records-saved h3").outerHeight(h));y(".ui-slider-handle").css({height:f,"margin-bottom":-0.5*f});b=y("#slider-vertical").height();f=b-f;b=0.5*(b-f);y(".ui-slider").css({height:f,"margin-top":b});y(".ui-slider-range").css({top:-b});y("#slider-wrap").click(function(){y("#slider-vertical").slider("value",0);c.css({top:-d})});y("#records-saved-pane,#slider-wrap").mousewheel(function(b,e){var a=y("#slider-vertical").slider("value"),a=a+5*e;y("#slider-vertical").slider("value",a);a=-((100-a)*d/100);
0<a&&(a=0);Math.abs(a)>d&&(a=-1*d);c.css({top:a});b.preventDefault()})}})};window.XMLSerializer=XMLSerializer;
function z(b){function c(a){function b(a,c,n){this.j="undefined"!==typeof a&&a?a:"*";this.filter=n="undefined"!==typeof n&&n!==j?n:{};this.filter.q="undefined"!==typeof n.q?n.q:h;this.filter.A="undefined"!==typeof n.A?n.A:k;this.filter.r="undefined"!==typeof n.r?n.r:k;this.filter.m="undefined"!==typeof n.m?n.m:k;this.index=c}var c,d=this,a=a.replace(/<[\/]?instance(>|\s+[^>]*>)/gi,"");this.xml=$.parseXML(a);this.t=c=$(this.xml);XPathJS.bindDomLevel3XPath();this.a=function(a,c,d){return new b(a,c,
d)};b.prototype.get=function(){var a,b;a=this.filter.r===h?c.M(this.j).filter("[template]"):this.filter.q===h?c.M(this.j).not("[template], [template] *"):c.M(this.j);this.filter.m===h?a=a.filter(function(){b=$(this).text();return 0===$(this).children().length&&0<b.trim().length}):this.filter.A===h&&(a=a.filter(function(){return 0===$(this).children().length}));return a="undefined"!==typeof this.index&&this.index!==j?a.eq(this.index):a};b.prototype.g=function(a,b,n){var c,d;d=this.h().join(" ");a=
"undefined"!==typeof a?$.isArray(a)?a.join(" "):a:"";a=this.k(a,n);c=this.get();if(1===c.length&&a.toString().trim()!==d.toString().trim())return c.text(a),a=this.c(b,n),e.trigger("dataupdate",c.prop("nodeName")),a;if(1<c.length)return console.error("nodeset.setVal expected nodeset with one node, but received multiple"),j;0===c.length&&console.error("Data node: "+this.j+" with null-based index: "+this.index+" not found!");return j};b.prototype.h=function(){var a=[];this.get().each(function(){a.push($(this).text())});
return a};b.prototype.clone=function(a){var b,c;b=this.get();a=a||b;1===b.length&&1===a.length?(b.clone().insertAfter(a).find("*").andSelf().removeAttr("template"),c=[b.prop("nodeName")],b.find("*").each(function(){c.push($(this).prop("nodeName"))}),e.trigger("dataupdate",c.join())):console.error("node.clone() function did not receive origin and target nodes")};b.prototype.remove=function(){var a=this.get();0<a.length?(a.remove(),e.trigger("dataupdate",a.prop("nodeName"))):console.error("could not find node "+
this.j+" with index "+this.index+"to remove ")};b.prototype.k=function(a,b){return""===a.toString()?a:"undefined"!==typeof b&&b!==j&&"undefined"!==typeof this.types[b.toLowerCase()]&&"undefined"!==typeof this.types[b.toLowerCase()].k?this.types[b.toLowerCase()].k(a):a};b.prototype.c=function(a,b){var c,n;c=this.h();if(""===c.toString())return h;if("undefined"==typeof b||b===j||"undefined"==typeof this.types[b.toLowerCase()])console.error("data type "+b+" set to string"),b="string";c=this.types[b.toLowerCase()].c(c);
n="undefined"!==typeof a&&a!==j&&0<a.length?d.evaluate(a,"boolean",this.j,this.index):h;return c&&n};b.prototype.types={string:{c:m(h)},select:{c:m(h)},select1:{c:m(h)},decimal:{c:function(a){return!isNaN(a-0)&&a!==j?h:k}},"int":{c:function(a){return!isNaN(a-0)&&a!==j&&Math.round(a)==a?h:k}},date:{c:function(a){return"Invalid Date"!==(new Date(a.toString())).toString()},k:function(a){a=new Date(a);a.setUTCHours(0,0,0,0);return(new Date(a)).toUTCString()}},datetime:{c:function(a){return"Invalid Date"!==
(new Date(a)).toString()}},time:{c:function(a){return"Invalid Date"!==(new Date("2012-01-01 "+a)).toString()},k:function(a){a=new Date("2012-01-01 "+a);return a.getHours().toString().i(2)+":"+a.getMinutes().toString().i(2)+":"+a.getSeconds().toString().i(2)}},barcode:{c:m(h)},geopoint:{c:m(h)},binary:{c:m(h)}}}function d(a){e=$(a)}var f,g,e;this.za=function(a,b,c,d){return f.evaluate(a,b,c,d)};this.Ia=function(){return g.C()};this.Aa=function(){return f.get()};this.data=function(a){return new c(a)};
this.form=function(a){return new d(a)};this.Ba=function(){return f.V()};this.L=function(){return g.L()};this.b=function(){f=new c(b);f.b();g=new d("form.jr:eq(0)");g.b()};this.o=function(a){return f.U(a,void 0)};this.getKey=function(){return g.getKey()};this.H=function(a){return g.H(a)};this.s=function(a){return g.s(a)};c.prototype.b=function(){var a,b;this.a(j,j,{m:h,q:k}).get().each(function(){b=$(this).text();$(this).text(b.trim())});a=this.a(":first",0).get();this.namespace=a.attr("xmlns");a.removeAttr("xmlns");
this.R()};c.prototype.fa=function(a,b){var c,d,e=this.a(a,0,{r:h}),e=0===e.get().length?this.a(a,0):e;d=e.get().prop("nodeName");c=this.a(a,b).get();1===e.get().length&&1===c.length&&c.next().prop("nodeName")!==d?e.clone(c):c.next().prop("nodeName")!==d&&console.error("Could not find template node and/or node to insert the clone after")};c.prototype.R=function(a){var b=this;if("undefined"==typeof a||0===a.length)a=this.t.find(":first");a.children("[template]").each(function(){"undefined"==typeof $(this).parent().attr("template")&&
0===$(this).siblings($(this).prop("nodeName")).not("[template]").length&&$(this).clone().insertAfter($(this)).find("*").andSelf().removeAttr("template")});a.children().not("[template]").each(function(){b.R($(this))})};c.prototype.get=function(){return this.t||j};c.prototype.V=function(){return this.xml||j};c.prototype.U=function(a,b){var c,a="undefined"!==typeof a?a:k,b="undefined"!==typeof b?b:h;c=$("<root></root");this.t.find(":first").clone().appendTo(c);a===k&&c.find("[template]").remove();b===
h&&("undefined"!==typeof this.namespace&&0<this.namespace.length)&&c.children().eq(0).attr("xmlns",this.namespace);c=(new XMLSerializer).serializeToString(c.children().eq(0)[0]);return c=c.replace(/xmlns\=\"[A-z0-9\:\/\.\-\%\_\?&amp;]*\"/gi," ")};c.prototype.evaluate=function(a,b,d,e){var f,i,g,b=b||"any";f=new c(this.U(k,k));d="undefined"!==typeof d||d!==j?f.a(d,e,{}).get()[0]:f.V();e={"0":["any","ANY_TYPE"],1:["number","NUMBER_TYPE","numberValue"],2:["string","STRING_TYPE","stringValue"],3:["boolean",
"BOOLEAN_TYPE","booleanValue"],7:["nodes","ORDERED_NODE_SNAPSHOT_TYPE"],9:["node","FIRST_ORDERED_NODE_TYPE"]};for(i in e)if(i=Number(i),e[i][0]==b)break;else i=0;a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");a=a.replace(/&quot;/g,'"');try{g=document.evaluate(a,d,j,i,j);if(0===i){for(i in e)if(i=Number(i),i==Number(g.resultType))return g=0<i&&4>i?g[e[i][2]]:g,console.debug("evaluated "+a+" to: "+g),g;console.error("Expression: "+a+" did not return any boolean, string or number value as expected")}console.debug("evaluated "+
a+" to: "+g[e[i][2]]);return g[e[i][2]]}catch(o){console.error("Error occurred trying to evaluate: "+a+", message: "+o.message)}};d.prototype.b=function(){var a;this.ea();if("undefined"==typeof f||!(f instanceof c))return console.error("variable data needs to be defined as instance of DataXML");e.find('label>input[type="checkbox"], label>input[type="radio"]').parent().parent("fieldset").prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');e.parent().find("label>select, :not(#jr-preload-items, #jr-calculated-items)>label>input").not('[type="checkbox"], [type="radio"]').parent().prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');
e.find('label>input[type="checkbox"][required], label>input[type="radio"][required]').parent().parent("fieldset").find(".question-icons .required").addClass("ui-icon ui-icon-notice");e.parent().find("label>select[required], :not(#jr-preload-items, #jr-calculated-items)>label>input[required]").not('[type="checkbox"], [type="radio"]').parent().find(".question-icons .required").addClass("ui-icon ui-icon-notice");e.find('input[type="radio"]').each(function(){a=$(this).attr("name");$(this).attr("data-name",
a)});this.repeat.b();this.C();this.ca();this.va.b();this.O.b();this.P();this.B();this.F();this.pa.b();this.ta()};d.prototype.ea=function(){var a,b=[],c,d,v,i,g,o,p,H,I,J,K,L,M,N,O,P,F,G;p=e.find("#stats");a=parseInt(p.find('[id="jrItem"]').text(),10);c=parseInt(p.find('[id="jrInput"]').text(),10);d=parseInt(p.find('[id="jrUpload"]').text(),10);v=parseInt(p.find('[id="jrTrigger"]').text(),10);i=parseInt(p.find('[id="jrConstraint"]').text(),10);g=parseInt(p.find('[id="jrRelevant"]').text(),10);o=parseInt(p.find('[id="jrCalculate"]').text(),
10);p=parseInt(p.find('[id="jrPreload"]').text(),10);H=e.find('input[type="radio"]').length;I=e.find('input[type="checkbox"]').length;e.find("select");J=e.find('option[value!=""]').length;K=e.find('input:not([type="radio"],[type="checkbox"])').length;L=e.find(".trigger").length;M=e.find('[data-relevant]:not([type="radio"],[type="checkbox"])').length;N=e.find('input[data-relevant][type="radio"],input[data-relevant][type="checkbox"]').parent().parent("fieldset").length;O=e.find('[data-constraint]:not([type="radio"],[type="checkbox"])').length;
P=e.find('input[data-constraint][type="radio"],input[data-constraint][type="checkbox"]').parent().parent("fieldset").length;F=e.find("[data-calculate]").length;G=e.find("#jr-preload-items input").length;a!==J+H+I&&console.error(" total select-type filter differs between XML form and HTML form");c+d!==K-F-G&&console.error(" total amount of input/upload fields differs between XML form and HTML form");v!=L&&console.error(" total triggers differs between XML form and HTML form");g!=M+N&&console.error(" total amount of branches differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form)");
i!=O+P&&console.error(" total amount of constraints differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form). Note that constraints on &lt;trigger&gt; elements are ignored in the transformation and could cause this error too.");o!=F&&console.error(" total amount of calculated items differs between XML form and HTML formprel");p!=G&&console.error(" total amount of preload items differs between XML form and HTML form");e.find("[name]").each(function(){$.inArray($(this).attr("name"),
b)&&b.push($(this).attr("name"))});for(a=0;a<b.length;a++)1>f.a(b[a]).get().length&&console.error("Found name attribute: "+b[a]+" that does not have a corresponding data node. Transformation error or XML form error (relative nodesets perhaps?")};d.prototype.input={d:function(a){var b=this.e(a.eq(0));return"radio"==b||"checkbox"==b?a.parent("label").parent("fieldset"):"fieldset"==b?a:a.parent("label")},T:function(a){return 1!==a.length?console.error("getProps(): no input node provided or multiple"):
{path:this.getName(a),w:this.na(a),p:this.e(a),$:this.oa(a),S:a.attr("data-constraint"),ra:a.attr("data-relevant"),val:this.h(a),required:void 0!==a.attr("required")?h:k,enabled:this.isEnabled(a),multiple:this.X(a)}},e:function(a){return 1!==a.length?"":"input"==a.prop("nodeName").toLowerCase()?0<a.attr("type").length?a.attr("type").toLowerCase():console.error("<input> node has no type"):"select"==a.prop("nodeName").toLowerCase()?"select":"fieldset"==a.prop("nodeName").toLowerCase()?"fieldset":console.error("unexpected input node type provided")},
oa:function(a){return 1!==a.length?console.error("getXMLType(): no input node provided or multiple"):a.attr("data-type-xml")},getName:function(a){return 1!==a.length?console.error("getName(): no input node provided or multiple"):"radio"==this.e(a)?a.attr("data-name"):0<a.attr("name").length?a.attr("name"):console.error("input node has no name")},na:function(a){var b,c,d;if(1!==a.length)return console.error("getIndex(): no input node provided or multiple");b=this.e(a);c=this.getName(a);d=this.d(a);
return("radio"===b&&c!==a.attr("name")?this.d(e.find('[data-name="'+c+'"]')):this.d(e.find('[name="'+c+'"]'))).index(d)},X:function(a){return"checkbox"==this.e(a)||void 0!==a.attr("multiple")?h:k},isEnabled:function(a){return void 0!==a.attr("disabled")||0!==a.parents("fieldset:disabled").length?k:h},h:function(a){var b,c=[],d;if(1!==a.length)return console.error("getVal(): no inputNode provided or multiple");b=this.e(a);d=this.getName(a);return"radio"==b?this.d(a).find("input:checked").val()||"":
"checkbox"==b?(this.d(a).find('input[name="'+d+'"]:checked').each(function(){c.push($(this).val())}),c):a.val()||""},g:function(a,b,c){b=b||0;if("radio"==this.e(e.find('[data-name="'+a+'"]').eq(0)))return this.d(e.find('[data-name="'+a+'"]')).eq(b).find('input[value="'+c+'"]').attr("checked",h);a=this.d(e.find('[name="'+a+'"]')).eq(b).find("input, select, textarea");this.X(a.eq(0))===h&&(c=c.split(" "));return a.val(c)}};d.prototype.C=function(){var a,b,c,d=this;f.a(j,j,{m:h}).get().each(function(){c=
$(this).text();a=f.a($(this).prop("nodeName")).get().index($(this));b=d.la($(this));d.input.g(b,a,c)})};d.prototype.ta=function(){var a,b,c,d=this,f=e.find("#form-languages").attr("data-default-lang");$("#form-languages").detach().insertBefore($("form.jr").parent());if(!f||""===f)f=$("#form-languages a:eq(0)").attr("lang");console.debug("default language is: "+f);2>$("#form-languages a").length?(e.find("[lang]").addClass("active"),e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&
$(this).removeClass("active")}),this.G()):($("#form-languages a").click(function(f){f.preventDefault();a=$(this).attr("lang");$("#form-languages a").removeClass("active");$(this).addClass("active");e.find("[lang]").removeClass("active").filter('[lang="'+a+'"], [lang=""]').addClass("active");e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")});e.find("select>option").not('[value=""]').each(function(){b=$(this).attr("value");
c=$(this).parent("select").next(".jr-option-translations").children('.active[data-option-value="'+b+'"]').text().trim();c="undefined"!==typeof c&&0<c.length?c:"[MISSING TRANSLATION]";$(this).text(c)});e.find("legend span.active:not(.jr-hint, .jr-constraint-msg), label span.active:not(.jr-hint, .jr-constraint-msg)").each(function(){0===$(this).text().trim().length&&$(this).text("[MISSING TRANSLATION]")});d.G();e.trigger("changelanguage")}),$('#form-languages a[lang="'+f+'"]').click())};d.prototype.G=
function(){var a,b;e.find("*>.jr-hint").parent().each(function(){b="label"!==$(this).prop("nodeName").toLowerCase()&&"fieldset"!==$(this).prop("nodeName").toLowerCase()?$(this).parent("fieldset"):$(this);a=0<b.length?$(this).find(".jr-hint.active").text().trim():$(this).find("span.jr-hint").text().trim();0<a.length?b.find(".question-icons .hint").attr("title",a).addClass("ui-icon ui-icon-help"):b.find(".question-icons .hint").removeAttr("title").removeClass("ui-icon ui-icon-help")});e.tooltip()};
d.prototype.reset=function(){var a;e.find("form.jr:eq(0)")[0].reset();this.H("");g.s(k);$("#survey-title").text("New Survey");$("button#delete-form").hide();a=$("#saved-forms option:first").val();$("#saved-forms").val(a)};d.prototype.s=function(a){e.attr("data-edited",a.toString());e.trigger("edit")};d.prototype.H=function(a){e.find("form.jr:eq(0)").attr("data-stored-with-key",a);$("#survey-title").text(a)};d.prototype.getKey=function(){return e.find("form.jr:eq(0)").attr("data-stored-with-key")||
j};d.prototype.O={b:function(){e.on("click",".jr-branch",function(){var a=$(this);$(this).hasClass("busy")||($(this).hasClass("show")?$(this).addClass("busy").removeClass("show").next().hide("blind",{},600,function(){a.removeClass("busy")}):$(this).addClass("busy show").next().show("blind",{},600,function(){a.removeClass("busy");a.next().n()}))});this.update()},update:function(a){var b,c,d,v,i,r={},o=this;v="undefined"!==typeof a?a.split(","):[];i=0<v.length?[]:["[data-relevant]"];for(a=0;a<v.length;a++)i.push('[data-relevant*="'+
v[a]+'"]');e.find(i.join()).each(function(){b=g.input.T($(this));c=g.input.d($(this));if(!("radio"==b.p||"checkbox"==b.p)||!r[b.path]){if(1!==c.length)return console.error("could not find branch node"),k;try{d=f.evaluate(b.ra,"boolean",b.path,b.w)}catch(a){return console.error('Serious error occurred trying to evaluate skip logic for node with name: "'+b.path+'" (message: '+a.message+")"),k}r[b.path]=h;return d===h?o.enable(c):o.disable(c)}})},enable:function(a){a.prev(".jr-branch").hide("slow",function(){$(this).remove()});
a.removeClass("disabled").show("blind",{direction:"up"},1E3,function(){$(this).n()});return"label"==a.prop("nodeName").toLowerCase()?a.children("input, select, textarea").removeAttr("disabled"):a.removeAttr("disabled")},disable:function(a){a.addClass("disabled").hide();0===a.prev(".jr-branch").length&&(a.before('<div class="jr-branch ui-corner-all"></div>'),a.Q("change"));return"label"==a.prop("nodeName").toLowerCase()?a.children("input, select, textarea").attr("disabled","disabled"):a.attr("disabled",
"disabled")}};d.prototype.B=function(a){var b,c,d,g="";console.log("updating active outputs that contain: "+a);c="undefined"!==typeof a?a.split(","):[];d=0<c.length?[]:[".jr-output[data-value]"];for(a=0;a<c.length;a++)d.push('.jr-output[data-value*="'+c[a]+'"]');console.debug("the clever selector created: "+d.join());e.find(":not([disabled]) span.active").find(d.join()).each(function(){try{b=$(this).attr("data-value"),g=f.evaluate(b,"string")}catch(a){console.error("error occurred trying to evaluate output value from expression: "+
b+", (message:"+a.message+")"),g="[ERROR]"}$(this).text(g)});e.n();this.G()};d.prototype.P=function(a){var b,c,d,g,i,r,o;r="undefined"!==typeof a?a.split(","):[];o=0<r.length?[]:["input[data-calculate]"];for(a=0;a<r.length;a++)o.push('input[data-calculate*="'+r[a]+'"]');e.find("#jr-calculated-items").find(o.join()).each(function(){b=$(this).attr("name");c=$(this).attr("data-calculate");d=$(this).attr("data-type-xml");i=$(this).attr("data-constraint");g=f.evaluate(c,"string",b,j);f.a(b,j).g(g,i,d)})};
d.prototype.ca=function(){e.find(".jr-group, .jr-repeat").addClass("ui-corner-all");e.find("h2#form-title").addClass("ui-widget-header ui-corner-all");e.find(".trigger").addClass("ui-state-highlight ui-corner-all");$("fieldset:not(.jr-appearance-compact)>label, fieldset:not(.jr-appearance-compact)>legend").children("img,video,audio").parent().addClass("ui-helper-clearfix with-media")};d.prototype.va={b:function(){this.ga();this.ja();this.ua();this.ia();this.qa();this.ma();this.ba()},ga:function(){e.find(".jr-appearance-compact>label>span").hide()},
ja:function(){Modernizr.inputtypes.date||e.find('input[type="date"]').datepicker({})},ua:function(){Modernizr.inputtypes.time||e.find('input[type="time"]').timepicker({})},ia:function(){Modernizr.inputtypes.datetime||e.find('input[type="datetime"]').datetimepicker()},Ha:function(){e.find("select:not([multiple])").attr("size","1");$("select:not([multiple])").multiselect({multiple:k,header:"Select one option",noneSelectedText:"Select one option",selectedList:1,position:{my:"left top",at:"left bottom"}})},
Ga:function(){e.find("select[multiple]").attr("size","5").find('[value=""]').remove();$("select[multiple]").multiselect({header:"false",position:{my:"left top",at:"left bottom"}})},qa:function(){e.find("input[readonly]").parent("label").each(function(){var a=$(this).html();$('<fieldset class="trigger ui-state-highlight ui-corner-all"></fieldset>').insertBefore($(this)).append(a).find("input").remove();$(this).remove()})},Ca:l(),La:l(),Ka:l(),ma:function(){e.find('input[data-type-xml="geopoint"]').attr("placeholder",
"Awesome geopoint widget will follow in the future!")},xa:l(),ba:function(){e.find('input[data-type-xml="barcode"]').attr("placeholder","This probably does not require support for browser data entry.")}};d.prototype.pa={b:function(){var a,b,c,d,g=this;e.find("#jr-preload-items input").each(function(){a=$(this).attr("data-preload").toLowerCase();b=$(this).attr("data-preload-params").toLowerCase();c=$(this).attr("name");"undefined"!==typeof g[a]?(d=f.a(c).h(),g.g($(this),g[a]({param:b,l:d,a:$(this)}))):
console.error('Preload "'+a+'"" not supported. May or may not be a big deal.')})},g:function(a,b){a.val(b.toString()).trigger("change")},timestamp:function(a){var b=this;return"start"==a.param&&""!==a.l?""===a.l?a.l:f.evaluate("now()","string"):"end"==a.param?(e.on("beforesave",function(){b.g(a.a,f.evaluate("now()","string"))}),f.evaluate("now()","string")):""},date:function(a){var b,c;return""!==a.l?(b=new Date(f.evaluate("today()","string")),a=b.getUTCFullYear().toString().i(4),c=(b.getUTCMonth()+
1).toString().i(2),b=b.getUTCDate().toString().i(2),a+"-"+c+"-"+b):a.l},property:m("no property preload in Rapaide"),context:function(a){return"application"==a.param?"rapaide":""},patient:m("not supported in Rapaide"),user:m("user preload item not functioning yet"),uid:m("no uid"),browser:function(a){if("name"==a.param)return $.browser.webkit?"webkit":$.browser.mozilla?"mozilla":$.browser.opera?"opera":$.browser.msie?"msie":"unknown";if("version"==a.param)return $.browser.version},os:m("not known")};
d.prototype.repeat={b:function(){var a,b,c,d,g,i=this;e.find("fieldset.jr-repeat").prepend('<span class="repeat-number"></span>');e.find("fieldset.jr-repeat:not([data-repeat-fixed])").append('<button type="button" class="repeat"></button><button type="button" class="remove"></button>');e.find("button.repeat").button({text:k,icons:{primary:"ui-icon-plusthick"}});e.find("button.remove").button({disabled:h,text:k,icons:{primary:"ui-icon-minusthick"}});e.on("click","button.repeat:enabled",function(){i.clone($(this).parent("fieldset.jr-repeat"));
return k});e.on("click","button.remove:enabled",function(){i.remove($(this).parent("fieldset.jr-repeat.clone"));return k});e.find("fieldset.jr-repeat").each(function(){c=$(this).attr("data-repeat-count")||"";b=0<c.length?parseInt(f.a(c).h(),10):0;d=f.a($(this).attr("name")).get().length;g=b>d?b:d;for(a=1;a<g;a++)i.clone($(this).siblings().andSelf().last(),"")})},clone:function(a,b){var c,d,g,i,r,o,p=this;if(1!==a.length)return console.error("Nothing to clone"),k;c=a.parent("fieldset.jr-group").children("fieldset.jr-repeat:not(.clone)").eq(0);
d=c.clone(k);d.find(".clone").remove();d.addClass("clone");d.find("button.remove").button({text:k,icons:{primary:"ui-icon-minusthick"}});d.find("button.repeat").button({text:k,icons:{primary:"ui-icon-plusthick"}});d.insertAfter(a).parent(".jr-group").Y();d.hide().show("highlight",{},600);d.Q(b);d.find(".invalid input, .invalid select, .invalid textarea").each(function(){p.I($(this))});g=e.find('fieldset.jr-repeat[name="'+a.attr("name")+'"]').index(a);i=[];d.find('input[type="radio"]').each(function(){-1===
$.inArray($(this).attr("data-name"),i)&&i.push($(this).attr("data-name"))});for(r=0;r<i.length;r++)o=(new Date).getTime().toString(),d.find('input[type="radio"][data-name="'+i[r]+'"]').attr("name",o);this.Z(c.parent());c=c.attr("name");0<c.length&&0<=g&&f.fa(c,g);e.trigger("changerepeat");return h},remove:function(a){var b=this,c=a.attr("name"),d=e.find('[name="'+c+'"]').index(a),g=a.parent("fieldset.jr-group");a.hide("drop",{},600,function(){a.remove();g.Y();b.Z(g)});f.a(c,d).remove();e.trigger("changerepeat")},
Z:function(a){a="undefined"==typeof a||0===a.length||!a?a=e:a;a.find("button.repeat, button.remove").button("disable").removeClass("ui-state-hover");a.find("fieldset.jr-repeat:last-child > button.repeat").button("enable");a.find("fieldset.jr-repeat:not(:nth-child(2)) > button.remove").button("enable")}};d.prototype.F=function(){var a,b,c=this;$("form.jr").attr("onsubmit","return false;");e.on("change validate","input, select, textarea",function(d){a=c.input.T($(this));b="validate"==d.type?a.enabled&&
"hidden"!==a.p?f.a(a.path,a.w).c(a.S,a.$):h:f.a(a.path,a.w).g(a.val,a.S,a.$);b=a.enabled&&"hidden"!==a.p&&a.required&&1>a.val.length?k:b;if("undefined"!==typeof b&&b!==j)return b===k?c.sa($(this)):c.I($(this))});e.on("dataupdate",function(a,b){c.P(b);c.O.update(b);c.B(b)});e.on("change changerepeat",function(){c.s(h)});e.on("changerepeat",function(){c.C()});e.on("beforesave",function(){c.L()});$(window).resize(function(){e.n()});e.on("changelanguage",function(){c.B()})};d.prototype.I=function(a){this.input.d(a).removeClass("invalid ui-state-error")};
d.prototype.sa=function(a){this.input.d(a).addClass("invalid ui-state-error")};d.prototype.la=function(a){for(var b=[a.prop("nodeName")],a=a.parent();1==a.length&&"#document"!==a.prop("nodeName");)b.push(a.prop("nodeName")),a=a.parent();return"/"+b.reverse().join("/")};d.prototype.L=function(){var a=this;e.find("fieldset:disabled input, fieldset:disabled select, fieldset:disabled textarea, input:disabled, select:disabled, textarea:disabled").each(function(){a.I($(this))});e.find("input, select, textarea").trigger("validate")};
String.prototype.i=function(a){for(var b=this;b.length<a;)b="0"+b;return b}}t.prototype.D=l();var A=jQuery;A.fn.Y=function(){this.each(function(){A(this).find("fieldset.jr-repeat").each(function(){var b,c,d;0===A(this).prev("fieldset.jr-repeat").length&&(b=A(this).siblings("fieldset.jr-repeat"),c=b.length+1,1<c?(A(this).find("span.repeat-number").text("1"),d=2,b.each(function(){A(this).find("span.repeat-number").text(d);d++})):A(this).find("span.repeat-number").empty())})})};
A.fn.Q=function(b){b=b||"edit";this.each(function(){A(this).find("input, select, textarea").each(function(){var c=A(this).attr("type");"SELECT"===A(this).prop("nodeName").toUpperCase()&&(c="select");"TEXTAREA"===A(this).prop("nodeName").toUpperCase()&&(c="textarea");switch(c){case "date":case "number":case "search":case "color":case "range":case "url":case "email":case "password":case "text":case "file":case "hidden":case "textarea":A(this).val("").trigger(b);break;case "radio":case "checkbox":A(this).prop("checked")&&
(A(this).prop("checked",k),A(this).trigger(b));break;case "select":A(this)[0].selectedIndex=-1;A(this).trigger(b);break;default:console.error("Unrecognized input type found when trying to reset: "+c)}})})};A.fn.n=function(){var b;this.each(function(){A(this).find("legend + label").each(function(){b=0<A(this).prev().find(".jr-constraint-msg.active").length&&36>A(this).prev().height()?36:19>A(this).prev().height()?19:A(this).prev().height();A(this).animate({"margin-top":b+6+"px"},600)})})};
A.fn.M=function(b){var c,d,b=b.replace(/\/\//g," "),b=b.replace(/^\//,""),b=b.replace(/\/\.$/,""),b=b.replace(/\//g,">"),b=b.replace(/\[([^@].*?)\]/g,function(b,c){return":has("+c+")"});if(0<=b.indexOf(">..")){b=b.split(/>\.\.>?/g);c=jQuery(b[0],this);for(d=1;d<b.length;d++)c=c.parent(b[d]);return c.get()}return this.find(b)};var B,C,D,E,Q,R='There were errors. Please see the "report" tab for details.',S=k;
$(document).ready(function(){Q=console.error;console.error=function(){var b=arguments[0];1!==$("#jserrors div ol").length&&$("#jserrors div").append("<ol></ol>");$("#jserrors div ol").append('<li class="error"><span class="ui-icon ui-icon-alert"></span>'+b+"</li>");x(R);return Q.apply(console,arguments)};C=u("source")||k;D=u("formurl")||k;C||($("#html5-form-source").hide(),$('li a[href="#html5-form-source"]').parent("li").remove());$("#tabs").tabs();$('li a[href="#upload"]').parent("li").hide();E=
$("ul.ui-tabs-nav");E.hide();x("This is an incomplete pre-alpha preview to test the JavaRosa form functionality in Google Chrome. It is not ready for actual use.",3);$(".main .ui-tabs-nav").removeClass("ui-widget-header");$(".main h2").addClass("ui-widget-header ui-corner-all");$("article").addClass("ui-corner-tr");s.J();$("#upload-form #input-switcher a#xml_url").click();D&&(D=decodeURIComponent(decodeURI(u("formurl"))),console.log("formurl : "+D),D.match(/^(https?:\/\/)?([\da-z\.\-]+)\.([a-z\.]{2,6})([\/\w \.\-]*)*\/?[\/\w \.\-\=\&\?]*$/)?
($("#upload-form label, #input-switcher").hide(),$('#upload-form input[name="xml_url"]').val(D),$("#upload-form").submit()):s.alert("not a valid url"))});
t.prototype.D=function(){$('#upload-form [name="xml_file"]').change(function(){$("#upload-form").submit()});$("#upload-form").ajaxForm({dataType:"xml",beforeSubmit:function(){$("#upload-form label, #input-switcher").hide();$("#upload-form img.loading").show()},success:T});$("#upload-form #input-switcher a").hover(function(){$(this).toggleClass("ui-state-hover")});$("#upload-form #input-switcher a").click(function(b){b.preventDefault();$("#upload-form label").hide().find('input[name="'+$(this).attr("id")+
'"]').parents("label").show();$(this).siblings().removeClass("ui-state-active");$(this).addClass("ui-state-active")});$("#data-template-show input").change(function(){S=$(this).is(":checked")?h:k;U()});$("#html5-form-source form").submit(function(){var b,c=$(this),d=c.attr("action"),c='<!DOCTYPE html><html><head><meta charset="utf-8" /><title></title></head><body>'+c.find('textarea[name="content"]').val()+"</body></html>",f=new FormData;f.append("level","error");f.append("content",c);$("#html5validationmessages div").html('<img class="loading" src="images/ajax-loader.gif" />');
$.ajax(d,{type:"POST",data:f,contentType:k,processData:k,success:function(c){var d=$("<div></div>");d.append(c.replace(/<script[A-z =".]*><\/script>/gi,""));d.find("ol:not(.source) li>*:first-child").each(function(){b=$(this).parent("li").attr("class");$(this).addClass(b)});V(d.find("p.success, ol:not(.source) li>*:first-child"),$("#html5validationmessages div"));$("#html5validationmessages div li.info").hide()},error:function(){$("#html5validationmessages div").empty().append('<ol><li class="info"><span class="ui-icon ui-icon-info"></span>This validation is currently not functional</li></ol>')}});
return k});$("button#reset-form").button({icons:{primary:"ui-icon-refresh"}}).click(function(){$("#upload-form")[0].reset();$("#upload-form img.loading").hide();$("#input-switcher").show().find("a#xml_file").click();$("#form-languages").remove();$("#survey-form div, #xsltmessages div, #html5validationmessages div, #jrvalidationmessages div, #xmlerrors div, #xslerrors div, #html5-form-source textarea, #data textarea").empty();B=j;$('#tabs li a[href="#upload"]').click();E.hide()});$("button#launch-form").button({icons:{primary:"ui-icon-arrowthick-1-e"}}).click(function(){s.alert("In the future this button will launch the form in Rapaide.survey (now it just triggers validation of the whole form).",
"Not functional");$("form.jr").trigger("beforesave")})};
function T(b){var c=$(b);E.show();var b=(new XMLSerializer).serializeToString(c.find("form")[0]),d=(new XMLSerializer).serializeToString(c.find("instance")[0]),f=c.find("xsltmessages message"),g=c.find("jrvalidationmessages message"),e=c.find("xmlerrors message"),c=c.find("xslformerrors message, xsldataerrors message");$("#upload-form img.loading").remove();0<b.length?($("#html5-form-source textarea").empty().text(vkbeautify.xml(b)),$("#html5-form-source form").submit(),$("#survey-form div").empty().append(b),
B=new z(d),B.b(),$('#tabs li a[href="#survey-form"]').click(),$("form.jr").on({change:U,dataupdate:U})):($("#survey-form div").empty(),$('#tabs li a[href="#report"]').click());B&&0<B.o().length?U():$("#data div").text("An error occurred whilst trying to extract the data.");B&&(0<B.o().length&&0===f.length)&&(f=$('<message class="success">Nothing reported back. A good sign if there are no other errors!</message>'));V(f,$("#xsltmessages div"));0===g.length&&(g=$('<message class="info">Something went wrong</message>'));
V(g,$("#jrvalidationmessages div"));0===e.length&&(e=$('<message class="success">Valid XML document!</message>'));V(e,$("#xmlerrors div"));0<c.length&&c.each(function(){console.error("XSLT stylesheet error: "+$(this).text())});B&&(0<B.o().length&&0<$("#report .level-2, #report .level-3").length)&&x(R)}function U(){if(B){var b=B.o(S);$("#data textarea").empty().text(vkbeautify.xml(b))}}
function V(b,c){var d=$("<ol></ol>");b.each(function(){var b="",c="",e=$(this).text(),a={"level-0":"info",info:"info","info warning":"info",success:"circle-check","level-1":"info","level-2":"alert",error:"alert","level-3":"alert"},b=b+($(this).attr("level")?"level-"+$(this).attr("level"):$(this).attr("class")),c=a[b]?"ui-icon ui-icon-"+a[b]:c,b='<li class="'+b+'"><span class="'+c+'"></span>'+e+"</li>";0===d.find("li").filter(function(){return $(this).text()==e}).length&&d.append(b)});c.empty().append(d)}
;