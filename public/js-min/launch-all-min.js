var i=!0,j=null,m=!1;function n(){return function(){}}function q(c){return function(){return c}}var r,s,t,v;$(document).ready(function(){r=new z;"undefined"==typeof console&&(console={log:n()});"undefined"==typeof window.console.debug&&(console.debug=console.log);"true"!==A("debug")&&(window.console.log=n(),window.console.debug=n())});function D(){}
function z(){function c(){$("nav ul li").removeClass("active").css("border-color",y);$("nav ul li a").css("color",o)}var f,e,h,l,d,a,b,k,w,g,x,y,o,p,B,C,u=this;this.b=function(){l=$("header");d=$("#feedback-bar");a=$("#page");k=$("#dialog-confirm");w=$("#dialog-alert");$("form.jr:eq(0)");Modernizr.borderradius&&(Modernizr.boxshadow&&Modernizr.csstransitions&&Modernizr.opacity)&&this.sa();$("article.page").each(function(){var a,g="",b;b=$(this).attr("id");a=$(this).attr("data-display")?$(this).attr("data-display"):
b;g=$(this).attr("data-title")?$(this).attr("data-title"):b;b=$(this).attr("data-ext-link")?$(this).attr("data-ext-link"):"#"+b;$('<li class="ui-corner-tl ui-corner-tr"><a href="'+b+'" title="'+g+'" >'+a+"</a></li>").appendTo($("nav ul"))});var b;g=$("#feedback-bar").css("background-color");x=$("header").css("border-top-color");y=$("header").css("background-color");$("body").removeClass("ui-widget-content");$("nav").addClass("ui-state-default");$("nav").css("color");o=$("nav").css("background-color");
$("nav").addClass("ui-state-hover");p=$("nav").css("background-color");$("nav").addClass("ui-state-active");B=$("nav").css("background-color");$("nav").removeClass();$("#page, #form-controls").css("background-image","none");$("#page, #component").css("color",g);$("#survey-info").css("color",x);b=$("body").addClass("ui-widget-shadow").css("background-color");$("body").css("background-color",b).removeClass("ui-widget-shadow");b=$("#page-content").addClass("ui-widget-overlay").css("background-color");
$("#page-content, #overlay").css("background-color",b).removeClass("ui-widget-overlay");$(".page a, .page a:link, .page a:visited").css("color",o).hover(function(){$(this).css("color",p)},function(){$(this).css("color",o)}).mousedown(function(){$(this).css("color",B)}).mouseup(function(){$(this).css("color",o)});$(".tabs-nohdr .ui-tabs-panel").css("background-color","#FEEEBD");c();$("button#save-form").button({icons:{primary:"ui-icon-disk"}}).click(n());$("button#reset-form").button({icons:{primary:"ui-icon-refresh"}}).click(function(){$("#upload-form")[0].reset();
$("#upload-form img.loading").hide();$("#input-switcher").show().find("a#xml_file").click();$("#form-languages").remove();$("#survey-form div, #xsltmessages div, #html5validationmessages div, #jrvalidationmessages div, #xmlerrors div, #xslerrors div, #html5-form-source textarea, #data textarea").empty();E=j;$('#tabs li a[href="#upload"]').click();F.hide()});$("button#delete-form").button({icons:{primary:"ui-icon-trash"}}).click(n());$("button#launch-form").button({icons:{primary:"ui-icon-arrowthick-1-e"}}).click(function(){r.alert("In the future this button will launch the form in Rapaide.survey (now it just triggers validation of the whole form).",
"Not functional");$("form.jr").trigger("beforesave")});$("#form-controls button").ja();$("#feedback-bar-close").button({icons:{primary:"ui-icon-closethick"},text:m}).click(function(a){a.preventDefault();u.T()});$("#page-close").button({icons:{primary:"ui-icon-closethick"},text:m}).click(function(a){a.preventDefault();u.O()});$("#feedback-bar-close, #page-close").removeClass().addClass("custom-button ui-widget-header ui-corner-all");$('a[href^="#"]:not(nav ul li a)').click(function(a){console.log("captured click to internal link that is not in nav");
var b=$(this).attr("href");"#"!==b&&(a.preventDefault(),$('nav li a[href="'+b+'"]').click())});$('nav ul li a[href^="#"]').click(function(a){a.preventDefault();a=$(this).attr("href").substr(1);u.oa(a);$(this).closest("li").addClass("active").css("border-color",x);$(this).css("color",g)}).hover(function(){$("nav ul li:not(.active)").css("border-color",y);$(this).closest("li:not(.active)").css("border-color",g).find("a").css("color",p)},function(){$("nav ul li:not(.active)").css("border-color",y).find("a").css("color",
o)});$(window).on("onlinestatuschange",function(a,b){u.ya(b)});$(document).on("edit","form.jr",function(){C(i)});$("header #status-connection").click(function(a){u.s($(this).attr("title"));a.stopPropagation()});$("#settings input").change(D);$("#records-saved li:not(.no-click)").on("click","li",function(a){a.preventDefault()}).on("mouseenter","li",function(){$(this).addClass("ui-state-hover");$(this).mousedown(function(){$(this).addClass("ui-state-active")})}).on("mouseleave","li",function(){$(this).removeClass("ui-state-hover")});
$("button#records-force-upload").button({icons:{La:"ui-icon-arrowthick-1-n"}}).click(n()).hover(function(){$("#records-force-upload-info").show()},function(){$("#records-force-upload-info").hide()});$("button#records-export").button({icons:{primary:"ui-icon-suitcase"}}).click(n()).hover(function(){$("#records-export-info").show()},function(){$("#records-export-info").hide()});$("#export-excel").button({icons:{primary:"ui-icon-suitcase"}});$(window).resize(function(){$("#container").css("top",$("header").outerHeight());
$("body:not(.no-scroll) #container").height($(window).height()-$("header").outerHeight()-$("#form-controls.bottom").outerHeight());var a=$("nav").offset().left,b=$("#logo").offset().left+$("#logo").outerWidth();a<b?$("#logo").css("visibility","hidden"):$("#logo").css("visibility","visible")});$("footer").detach().appendTo("#container")};this.wa=function(){$(window).trigger("resize");b=$("<pages></pages>");$("article.page").detach().appendTo(b).css("display","block")};this.sa=function(){var a={"fancy-visuals":i},
b;for(b in a);};this.Ha=function(){return f};this.Ia=function(){return e};this.oa=function(b){e&&this.O();e=i;b&&(a.find("#page-content").prepend(s(b)),"records"===b&&t());v();$("#overlay").show();setTimeout(function(){$("#overlay, header").bind("click.pageEvents",function(){$("#page-close").trigger("click")})},50);$(window).bind("resize.pageEvents",function(){v()})};this.O=function(){e=m;a.find(".page").detach();v();c();$("#overlay").hide();$("#overlay, header").unbind(".pageEvents");$(window).unbind(".pageEvents")};
this.s=function(a,b){b=b?1E3*b:1E4;clearTimeout(h);h=setTimeout(function(){u.T()},b);f=i;1<d.find("p").length&&d.find("p:eq(1)").remove();if(d.find("p").html()!==a||0===d.find("p").length){var g=$("<p></p>");g.text(a);d.prepend(g)}v()};this.T=function(){f=m;d.find("p").remove();v()};this.alert=function(a,b){var g,b=b||"Alert";g=function(){w.dialog("destroy");w.find("#dialog-alert-msg").text("")};w.find("#dialog-alert-msg").text(a).L();w.dialog({title:b,modal:i,resizable:m,buttons:{Ok:g},beforeClose:g})};
this.confirm=function(a,b,g){var d,c,x,g=g||"Are you sure?",b="undefined"==typeof b?{B:"Confirm",w:"Cancel"}:b;b.B=b.B||"Confirm";b.w=b.w||"Cancel";b.Y=b.Y||n();b.W=b.W||n();d=b.Y;c=b.W;x=function(){k.dialog("destroy");k.find("#dialog-confirm-msg").text("")};k.find("#dialog-confirm-msg").text(a||"Please confirm action").L();k.dialog({title:g,resizable:m,modal:i,buttons:[{text:b.B,click:function(){d.call();x.call()}},{text:b.w,click:function(){c.call();x.call()}}],beforeClose:x})};this.ya=function(a){console.log("updating online status in menu bar to:");
console.log(a);a?$("header #status-connection").removeClass().addClass("ui-icon ui-icon-signal-diag").attr("title","It appears there is currently an Internet connection available."):$("header #status-connection").removeClass().addClass("ui-icon ui-icon-cancel").attr("title","It appears there is currently no Internet connection")};C=function(a){a?$("header #status-editing").removeClass().addClass("ui-icon ui-icon-pencil").attr("title","Form is being edited."):$("header #status-editing").removeClass().attr("title",
"")};v=function(){var b,g;f?(b=l.outerHeight(),g=e?l.outerHeight()+d.outerHeight():l.outerHeight()+d.outerHeight()-a.outerHeight()):(b=l.outerHeight()-d.outerHeight(),g=e?l.outerHeight():l.outerHeight()-a.outerHeight());d.css("top",b);a.css("top",g)};s=function(a){e=b.find('article[id="'+a+'"]').clone(i);switch(a){case "records":u.za(e)}return e};t=function(){var a=$("#records-saved-pane"),b=$("#records-saved ol");a.css("overflow","hidden");var g=b.height()-a.height();if(0<g){var d=g/b.height(),d=
Math.round((1-d)*a.height()),d=d-d%2;$("#records .column.middle").html('<div id="slider-wrap" class="ui-corner-all"><div id="slider-vertical"></div></div>');$("#slider-wrap").height(a.outerHeight());$("#slider-vertical").slider({orientation:"vertical",Ma:"max",min:0,max:100,value:100,Qa:function(a,d){var k=-((100-d.value)*g/100);console.log("new topValue:"+k);b.css({top:k})}});$("#slider-wrap").css("margin-top",$("#records-saved h3").outerHeight(i));$(".ui-slider-handle").css({height:d,"margin-bottom":-0.5*
d});a=$("#slider-vertical").height();d=a-d;a=0.5*(a-d);$(".ui-slider").css({height:d,"margin-top":a});$(".ui-slider-range").css({top:-a});$("#slider-wrap").click(function(){$("#slider-vertical").slider("value",0);b.css({top:-g})});$("#records-saved-pane,#slider-wrap").mousewheel(function(a,d){var k=$("#slider-vertical").slider("value"),k=k+5*d;$("#slider-vertical").slider("value",k);k=-((100-k)*g/100);0<k&&(k=0);Math.abs(k)>g&&(k=-1*g);b.css({top:k});a.preventDefault()})}};this.za=function(a){a||
(a=b.find('article[id="records"]'));a.find("#records-saved ol").children().remove();a.find("#records-draft-qty").text(0);a.find("#records-final-qty").text(0)}}function A(c){for(var f=window.location.search.substring(1).split("&"),e=0;e<f.length;e++){var h=f[e].split("=");if(h[0]==c)return encodeURI(h[1])}return m}var G=jQuery;G.fn.ja=function(){var c=0;this.each(function(){G(this).width()>c&&(c=G(this).width())}).each(function(){G(this).width(c)})};G.fn.reverse=[].reverse;
G.fn.I=function(c){c=G.extend({U:"!@#$%^&*()+=[]\\';,/{}|\":<>?~`.- ",f:"",u:""},c);this.each(function(){c.Ja&&(c.f+="ABCDEFGHIJKLMNOPQRSTUVWXYZ");c.Ba&&(c.f+="abcdefghijklmnopqrstuvwxyz");for(var f=c.u.split(""),e=0;e<f.length;e++)-1!=c.U.indexOf(f[e])&&(f[e]="\\"+f[e]);c.u=f.join("|");var h=c.U+c.f,h=h.replace(RegExp(c.u,"gi"),"");G(this).keypress(function(c){var d;d=c.charCode?String.fromCharCode(c.charCode):String.fromCharCode(c.which);h.indexOf(d)!=-1&&c.preventDefault();c.ctrlKey&&d=="v"&&c.preventDefault()});
G(this).bind("contextmenu",q(m))})};G.fn.Ka=function(c){var f="abcdefghijklmnopqrstuvwxyz",f=f+f.toUpperCase(),c=G.extend({f:f},c);return this.each(function(){G(this).I(c)})};G.fn.alpha=function(c){c=G.extend({f:"1234567890"},c);return this.each(function(){G(this).I(c)})};
G.fn.L=function(){var c;c||(c=1);var f=this.contents().filter(function(){return 3==this.nodeType}).first(),e=f.text();c=e.split(" ",c).join(" ");f.length&&(f[0].nodeValue=e.slice(c.length),f.before('<span class="capitalize">'+c+"</span>"))};window.XMLSerializer=XMLSerializer;
function J(c){function f(a){function b(a,b,d){this.j="undefined"!==typeof a&&a?a:"*";this.filter=d="undefined"!==typeof d&&d!==j?d:{};this.filter.q="undefined"!==typeof d.q?d.q:i;this.filter.z="undefined"!==typeof d.z?d.z:m;this.filter.r="undefined"!==typeof d.r?d.r:m;this.filter.m="undefined"!==typeof d.m?d.m:m;this.index=b}var k,c=this,a=a.replace(/<[\/]?instance(>|\s+[^>]*>)/gi,"");this.xml=$.parseXML(a);this.t=k=$(this.xml);XPathJS.bindDomLevel3XPath();this.a=function(a,d,k){return new b(a,d,
k)};b.prototype.get=function(){var a,b;a=this.filter.r===i?k.H(this.j).filter("[template]"):this.filter.q===i?k.H(this.j).not("[template], [template] *"):k.H(this.j);this.filter.m===i?a=a.filter(function(){b=$(this).text();return 0===$(this).children().length&&0<b.trim().length}):this.filter.z===i&&(a=a.filter(function(){return 0===$(this).children().length}));return a="undefined"!==typeof this.index&&this.index!==j?a.eq(this.index):a};b.prototype.g=function(a,b,k){var c,w;w=this.h().join(" ");a=
"undefined"!==typeof a?$.isArray(a)?a.join(" "):a:"";a=this.k(a,k);c=this.get();if(1===c.length&&a.toString().trim()!==w.toString().trim())return c.text(a),a=this.c(b,k),d.trigger("dataupdate",c.prop("nodeName")),a;if(1<c.length)return console.error("nodeset.setVal expected nodeset with one node, but received multiple"),j;0===c.length&&console.error("Data node: "+this.j+" with null-based index: "+this.index+" not found!");return j};b.prototype.h=function(){var a=[];this.get().each(function(){a.push($(this).text())});
return a};b.prototype.clone=function(a){var b,k;b=this.get();a=a||b;1===b.length&&1===a.length?(b.clone().insertAfter(a).find("*").andSelf().removeAttr("template"),k=[b.prop("nodeName")],b.find("*").each(function(){k.push($(this).prop("nodeName"))}),d.trigger("dataupdate",k.join())):console.error("node.clone() function did not receive origin and target nodes")};b.prototype.remove=function(){var a=this.get();0<a.length?(a.remove(),d.trigger("dataupdate",a.prop("nodeName"))):console.error("could not find node "+
this.j+" with index "+this.index+"to remove ")};b.prototype.k=function(a,b){return""===a.toString()?a:"undefined"!==typeof b&&b!==j&&"undefined"!==typeof this.types[b.toLowerCase()]&&"undefined"!==typeof this.types[b.toLowerCase()].k?this.types[b.toLowerCase()].k(a):a};b.prototype.c=function(a,b){var d,k;d=this.h();if(""===d.toString())return i;if("undefined"==typeof b||b===j||"undefined"==typeof this.types[b.toLowerCase()])console.error("data type "+b+" set to string"),b="string";d=this.types[b.toLowerCase()].c(d);
k="undefined"!==typeof a&&a!==j&&0<a.length?c.evaluate(a,"boolean",this.j,this.index):i;return d&&k};b.prototype.types={string:{c:q(i)},select:{c:q(i)},select1:{c:q(i)},decimal:{c:function(a){return!isNaN(a-0)&&a!==j?i:m}},"int":{c:function(a){return!isNaN(a-0)&&a!==j&&Math.round(a)==a?i:m}},date:{c:function(a){return"Invalid Date"!==(new Date(a.toString())).toString()},k:function(a){a=new Date(a);a.setUTCHours(0,0,0,0);return(new Date(a)).toUTCString()}},datetime:{c:function(a){return"Invalid Date"!==
(new Date(a)).toString()}},time:{c:function(a){return"Invalid Date"!==(new Date("2012-01-01 "+a)).toString()},k:function(a){a=new Date("2012-01-01 "+a);return a.getHours().toString().i(2)+":"+a.getMinutes().toString().i(2)+":"+a.getSeconds().toString().i(2)}},barcode:{c:q(i)},geopoint:{c:q(i)},binary:{c:q(i)}}}function e(a){d=$(a)}var h,l,d;this.Da=function(a,b,d,c){return h.evaluate(a,b,d,c)};this.Pa=function(){return l.C()};this.Ea=function(){return h.get()};this.data=function(a){return new f(a)};
this.form=function(a){return new e(a)};this.Fa=function(){return h.S()};this.G=function(){return l.G()};this.b=function(){h=new f(c);h.b();l=new e("form.jr:eq(0)");l.b()};this.o=function(a){return h.R(a,void 0)};f.prototype.b=function(){var a,b;this.a(j,j,{m:i,q:m}).get().each(function(){b=$(this).text();$(this).text(b.trim())});a=this.a(":first",0).get();this.namespace=a.attr("xmlns");a.removeAttr("xmlns");this.N()};f.prototype.fa=function(a,b){var d,c,g=this.a(a,0,{r:i}),g=0===g.get().length?this.a(a,
0):g;c=g.get().prop("nodeName");d=this.a(a,b).get();1===g.get().length&&1===d.length&&d.next().prop("nodeName")!==c?g.clone(d):d.next().prop("nodeName")!==c&&console.error("Could not find template node and/or node to insert the clone after")};f.prototype.N=function(a){var b=this;if("undefined"==typeof a||0===a.length)a=this.t.find(":first");a.children("[template]").each(function(){"undefined"==typeof $(this).parent().attr("template")&&0===$(this).siblings($(this).prop("nodeName")).not("[template]").length&&
$(this).clone().insertAfter($(this)).find("*").andSelf().removeAttr("template")});a.children().not("[template]").each(function(){b.N($(this))})};f.prototype.get=function(){return this.t||j};f.prototype.S=function(){return this.xml||j};f.prototype.R=function(a,b){var d,a="undefined"!==typeof a?a:m,b="undefined"!==typeof b?b:i;d=$("<root></root");this.t.find(":first").clone().appendTo(d);a===m&&d.find("[template]").remove();b===i&&("undefined"!==typeof this.namespace&&0<this.namespace.length)&&d.children().eq(0).attr("xmlns",
this.namespace);d=(new XMLSerializer).serializeToString(d.children().eq(0)[0]);return d=d.replace(/xmlns\=\"[A-z0-9\:\/\.\-\%\_\?&amp;]*\"/gi," ")};f.prototype.evaluate=function(a,b,d,c){var g,e,h,b=b||"any";g=new f(this.R(m,m));d="undefined"!==typeof d||d!==j?g.a(d,c,{}).get()[0]:g.S();c={"0":["any","ANY_TYPE"],1:["number","NUMBER_TYPE","numberValue"],2:["string","STRING_TYPE","stringValue"],3:["boolean","BOOLEAN_TYPE","booleanValue"],7:["nodes","ORDERED_NODE_SNAPSHOT_TYPE"],9:["node","FIRST_ORDERED_NODE_TYPE"]};
for(e in c)if(e=Number(e),c[e][0]==b)break;else e=0;a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");a=a.replace(/&quot;/g,'"');try{h=document.evaluate(a,d,j,e,j);if(0===e){for(e in c)if(e=Number(e),e==Number(h.resultType))return h=0<e&&4>e?h[c[e][2]]:h,console.debug("evaluated "+a+" to: "+h),h;console.error("Expression: "+a+" did not return any boolean, string or number value as expected")}console.debug("evaluated "+a+" to: "+h[c[e][2]]);return h[c[e][2]]}catch(l){console.error("Error occurred trying to evaluate: "+
a+", message: "+l.message)}};e.prototype.b=function(){var a;this.ea();if("undefined"==typeof h||!(h instanceof f))return console.error("variable data needs to be defined as instance of DataXML");d.find('label>input[type="checkbox"], label>input[type="radio"]').parent().parent("fieldset").prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');d.parent().find("label>select, :not(#jr-preload-items, #jr-calculated-items)>label>input").not('[type="checkbox"], [type="radio"]').parent().prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');
d.find('label>input[type="checkbox"][required], label>input[type="radio"][required]').parent().parent("fieldset").find(".question-icons .required").addClass("ui-icon ui-icon-notice");d.parent().find("label>select[required], :not(#jr-preload-items, #jr-calculated-items)>label>input[required]").not('[type="checkbox"], [type="radio"]').parent().find(".question-icons .required").addClass("ui-icon ui-icon-notice");d.find('input[type="radio"]').each(function(){a=$(this).attr("name");$(this).attr("data-name",
a)});this.$();this.repeat.b();this.C();this.da();this.Aa.b();this.J.b();this.K();this.A();this.ta();this.pa.b();this.$()};e.prototype.ea=function(){var a,b=[],c,e,g,f,l,o,p,B,C,u,O,L,M,N,P,Q,H,I;p=d.find("#stats");a=parseInt(p.find('[id="jrItem"]').text(),10);c=parseInt(p.find('[id="jrInput"]').text(),10);e=parseInt(p.find('[id="jrUpload"]').text(),10);g=parseInt(p.find('[id="jrTrigger"]').text(),10);f=parseInt(p.find('[id="jrConstraint"]').text(),10);l=parseInt(p.find('[id="jrRelevant"]').text(),
10);o=parseInt(p.find('[id="jrCalculate"]').text(),10);p=parseInt(p.find('[id="jrPreload"]').text(),10);B=d.find('input[type="radio"]').length;C=d.find('input[type="checkbox"]').length;d.find("select");u=d.find('option[value!=""]').length;O=d.find('input:not([type="radio"],[type="checkbox"])').length;L=d.find(".trigger").length;M=d.find('[data-relevant]:not([type="radio"],[type="checkbox"])').length;N=d.find('input[data-relevant][type="radio"],input[data-relevant][type="checkbox"]').parent().parent("fieldset").length;
P=d.find('[data-constraint]:not([type="radio"],[type="checkbox"])').length;Q=d.find('input[data-constraint][type="radio"],input[data-constraint][type="checkbox"]').parent().parent("fieldset").length;H=d.find("[data-calculate]").length;I=d.find("#jr-preload-items input").length;a!==u+B+C&&console.error(" total select-type filter differs between XML form and HTML form");c+e!==O-H-I&&console.error(" total amount of input/upload fields differs between XML form and HTML form");g!=L&&console.error(" total triggers differs between XML form and HTML form");
l!=M+N&&console.error(" total amount of branches differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form)");f!=P+Q&&console.error(" total amount of constraints differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form). Note that constraints on &lt;trigger&gt; elements are ignored in the transformation and could cause this error too.");o!=H&&console.error(" total amount of calculated items differs between XML form and HTML formprel");
p!=I&&console.error(" total amount of preload items differs between XML form and HTML form");d.find("[name]").each(function(){$.inArray($(this).attr("name"),b)&&b.push($(this).attr("name"))});for(a=0;a<b.length;a++)1>h.a(b[a]).get().length&&console.error("Found name attribute: "+b[a]+" that does not have a corresponding data node. Transformation error or XML form error (relative nodesets perhaps?")};e.prototype.input={d:function(a){var b=this.e(a.eq(0));return"radio"==b||"checkbox"==b?a.parent("label").parent("fieldset"):
"fieldset"==b?a:a.parent("label")},Q:function(a){return 1!==a.length?console.error("getProps(): no input node provided or multiple"):{path:this.getName(a),v:this.ma(a),p:this.e(a),ba:this.na(a),P:a.attr("data-constraint"),ra:a.attr("data-relevant"),val:this.h(a),required:void 0!==a.attr("required")?i:m,enabled:this.isEnabled(a),multiple:this.V(a)}},e:function(a){return 1!==a.length?"":"input"==a.prop("nodeName").toLowerCase()?0<a.attr("type").length?a.attr("type").toLowerCase():console.error("<input> node has no type"):
"select"==a.prop("nodeName").toLowerCase()?"select":"fieldset"==a.prop("nodeName").toLowerCase()?"fieldset":console.error("unexpected input node type provided")},na:function(a){return 1!==a.length?console.error("getXMLType(): no input node provided or multiple"):a.attr("data-type-xml")},getName:function(a){return 1!==a.length?console.error("getName(): no input node provided or multiple"):"radio"==this.e(a)?a.attr("data-name"):0<a.attr("name").length?a.attr("name"):console.error("input node has no name")},
ma:function(a){var b,c,e;if(1!==a.length)return console.error("getIndex(): no input node provided or multiple");b=this.e(a);c=this.getName(a);e=this.d(a);return("radio"===b&&c!==a.attr("name")?this.d(d.find('[data-name="'+c+'"]')):this.d(d.find('[name="'+c+'"]'))).index(e)},V:function(a){return"checkbox"==this.e(a)||void 0!==a.attr("multiple")?i:m},isEnabled:function(a){return void 0!==a.attr("disabled")||0!==a.parents("fieldset:disabled").length?m:i},h:function(a){var b,d=[],c;if(1!==a.length)return console.error("getVal(): no inputNode provided or multiple");
b=this.e(a);c=this.getName(a);return"radio"==b?this.d(a).find("input:checked").val()||"":"checkbox"==b?(this.d(a).find('input[name="'+c+'"]:checked').each(function(){d.push($(this).val())}),d):a.val()||""},g:function(a,b,c){b=b||0;if("radio"==this.e(d.find('[data-name="'+a+'"]').eq(0)))return this.d(d.find('[data-name="'+a+'"]')).eq(b).find('input[value="'+c+'"]').attr("checked",i);a=this.d(d.find('[name="'+a+'"]')).eq(b).find("input, select, textarea");this.V(a.eq(0))===i&&(c=c.split(" "));return a.val(c)}};
e.prototype.C=function(){var a,b,d,c=this;h.a(j,j,{m:i}).get().each(function(){d=$(this).text();a=h.a($(this).prop("nodeName")).get().index($(this));b=c.ka($(this));c.input.g(b,a,d)})};e.prototype.$=function(){var a,b,c,e=this,g=d.find("#form-languages").attr("data-default-lang");$("#form-languages").detach().insertBefore($("form.jr").parent());if(!g||""===g)g=$("#form-languages a:eq(0)").attr("lang");2>$("#form-languages a").length?(d.find("[lang]").addClass("active"),d.find(".jr-form-short.active").each(function(){0<
$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")}),this.D()):($("#form-languages a").click(function(g){g.preventDefault();a=$(this).attr("lang");$("#form-languages a").removeClass("active");$(this).addClass("active");d.find("[lang]").removeClass("active").filter('[lang="'+a+'"], [lang=""]').addClass("active");d.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")});d.find("select>option").not('[value=""]').each(function(){b=
$(this).attr("value");c=$(this).parent("select").next(".jr-option-translations").children('.active[data-option-value="'+b+'"]').text().trim();c="undefined"!==typeof c&&0<c.length?c:"[MISSING TRANSLATION]";$(this).text(c)});d.find("legend span.active:not(.jr-hint, .jr-constraint-msg), label span.active:not(.jr-hint, .jr-constraint-msg)").each(function(){0===$(this).text().trim().length&&$(this).text("[MISSING TRANSLATION]")});e.D();d.trigger("changelanguage")}),$('#form-languages a[lang="'+g+'"]').click())};
e.prototype.D=function(){var a,b;d.find("*>.jr-hint").parent().each(function(){b="label"!==$(this).prop("nodeName").toLowerCase()&&"fieldset"!==$(this).prop("nodeName").toLowerCase()?$(this).parent("fieldset"):$(this);a=0<b.length?$(this).find(".jr-hint.active").text().trim():$(this).find("span.jr-hint").text().trim();0<a.length?b.find(".question-icons .hint").attr("title",a).addClass("ui-icon ui-icon-help"):b.find(".question-icons .hint").removeAttr("title").removeClass("ui-icon ui-icon-help")});
d.tooltip()};e.prototype.reset=function(){var a;d.find("form.jr:eq(0)")[0].reset();this.va();l.Z(m);$("#survey-title").text("New Survey");$("button#delete-form").hide();a=$("#saved-forms option:first").val();$("#saved-forms").val(a)};e.prototype.Z=function(a){d.attr("data-edited",a.toString());d.trigger("edit")};e.prototype.va=function(){d.find("form.jr:eq(0)").attr("data-stored-with-key","");$("#survey-title").text("")};e.prototype.J={b:function(){d.on("click",".jr-branch",function(){var a=$(this);
$(this).hasClass("busy")||($(this).hasClass("show")?$(this).addClass("busy").removeClass("show").next().hide("blind",{},600,function(){a.removeClass("busy")}):$(this).addClass("busy show").next().show("blind",{},600,function(){a.removeClass("busy");a.next().n()}))});this.update()},update:function(a){var b,c,e,g,f,y={},o=this;g="undefined"!==typeof a?a.split(","):[];f=0<g.length?[]:["[data-relevant]"];for(a=0;a<g.length;a++)f.push('[data-relevant*="'+g[a]+'"]');d.find(f.join()).each(function(){b=l.input.Q($(this));
c=l.input.d($(this));if(!("radio"==b.p||"checkbox"==b.p)||!y[b.path]){if(1!==c.length)return console.error("could not find branch node"),m;try{e=h.evaluate(b.ra,"boolean",b.path,b.v)}catch(a){return console.error('Serious error occurred trying to evaluate skip logic for node with name: "'+b.path+'" (message: '+a.message+")"),m}y[b.path]=i;return e===i?o.enable(c):o.disable(c)}})},enable:function(a){a.prev(".jr-branch").hide("slow",function(){$(this).remove()});a.removeClass("disabled").show("blind",
{direction:"up"},1E3,function(){$(this).n()});return"label"==a.prop("nodeName").toLowerCase()?a.children("input, select, textarea").removeAttr("disabled"):a.removeAttr("disabled")},disable:function(a){a.addClass("disabled").hide();0===a.prev(".jr-branch").length&&(a.before('<div class="jr-branch ui-corner-all"></div>'),a.M("change"));return"label"==a.prop("nodeName").toLowerCase()?a.children("input, select, textarea").attr("disabled","disabled"):a.attr("disabled","disabled")}};e.prototype.A=function(a){var b,
c,e,g="";console.log("updating active outputs that contain: "+a);c="undefined"!==typeof a?a.split(","):[];e=0<c.length?[]:[".jr-output[data-value]"];for(a=0;a<c.length;a++)e.push('.jr-output[data-value*="'+c[a]+'"]');console.debug("the clever selector created: "+e.join());d.find(":not([disabled]) span.active").find(e.join()).each(function(){try{b=$(this).attr("data-value"),g=h.evaluate(b,"string")}catch(a){console.error("error occurred trying to evaluate output value from expression: "+b+", (message:"+
a.message+")"),g="[ERROR]"}$(this).text(g)});d.n();this.D()};e.prototype.K=function(a){var b,c,e,g,f,l,o;l="undefined"!==typeof a?a.split(","):[];o=0<l.length?[]:["input[data-calculate]"];for(a=0;a<l.length;a++)o.push('input[data-calculate*="'+l[a]+'"]');d.find("#jr-calculated-items").find(o.join()).each(function(){b=$(this).attr("name");c=$(this).attr("data-calculate");e=$(this).attr("data-type-xml");f=$(this).attr("data-constraint");g=h.evaluate(c,"string",b,j);h.a(b,j).g(g,f,e)})};e.prototype.da=
function(){d.find(".jr-group, .jr-repeat").addClass("ui-corner-all");d.find("h2#form-title").addClass("ui-widget-header ui-corner-all");d.find(".trigger").addClass("ui-state-highlight ui-corner-all");$("fieldset:not(.jr-appearance-compact)>label, fieldset:not(.jr-appearance-compact)>legend").children("img,video,audio").parent().addClass("ui-helper-clearfix with-media")};e.prototype.Aa={b:function(){this.ga();this.ia();this.xa();this.ha();this.qa();this.la();this.ca()},ga:function(){d.find(".jr-appearance-compact>label>span").hide()},
ia:function(){Modernizr.inputtypes.date||d.find('input[type="date"]').datepicker({})},xa:function(){Modernizr.inputtypes.time||d.find('input[type="time"]').timepicker({})},ha:function(){Modernizr.inputtypes.datetime||d.find('input[type="datetime"]').datetimepicker()},Oa:function(){d.find("select:not([multiple])").attr("size","1");$("select:not([multiple])").multiselect({multiple:m,header:"Select one option",noneSelectedText:"Select one option",selectedList:1,position:{my:"left top",at:"left bottom"}})},
Na:function(){d.find("select[multiple]").attr("size","5").find('[value=""]').remove();$("select[multiple]").multiselect({header:"false",position:{my:"left top",at:"left bottom"}})},qa:function(){d.find("input[readonly]").parent("label").each(function(){var a=$(this).html();$('<fieldset class="trigger ui-state-highlight ui-corner-all"></fieldset>').insertBefore($(this)).append(a).find("input").remove();$(this).remove()})},Ga:n(),Sa:n(),Ra:n(),la:function(){d.find('input[data-type-xml="geopoint"]').attr("placeholder",
"Awesome geopoint widget will follow in the future!")},Ca:n(),ca:function(){d.find('input[data-type-xml="barcode"]').attr("placeholder","This probably does not require support for browser data entry.")}};e.prototype.pa={b:function(){var a,b,c,e,g=this;d.find("#jr-preload-items input").each(function(){a=$(this).attr("data-preload").toLowerCase();b=$(this).attr("data-preload-params").toLowerCase();c=$(this).attr("name");"undefined"!==typeof g[a]?(e=h.a(c).h(),g.g($(this),g[a]({param:b,l:e,a:$(this)}))):
console.error('Preload "'+a+'"" not supported. May or may not be a big deal.')})},g:function(a,b){a.val(b.toString()).trigger("change")},timestamp:function(a){var b=this;return"start"==a.param&&""!==a.l?""===a.l?a.l:h.evaluate("now()","string"):"end"==a.param?(d.on("beforesave",function(){b.g(a.a,h.evaluate("now()","string"))}),h.evaluate("now()","string")):""},date:function(a){var b,d;return""!==a.l?(b=new Date(h.evaluate("today()","string")),a=b.getUTCFullYear().toString().i(4),d=(b.getUTCMonth()+
1).toString().i(2),b=b.getUTCDate().toString().i(2),a+"-"+d+"-"+b):a.l},property:q("no property preload in Rapaide"),context:function(a){return"application"==a.param?"rapaide":""},patient:q("not supported in Rapaide"),user:q("user preload item not functioning yet"),uid:q("no uid"),browser:function(a){if("name"==a.param)return $.browser.webkit?"webkit":$.browser.mozilla?"mozilla":$.browser.opera?"opera":$.browser.msie?"msie":"unknown";if("version"==a.param)return $.browser.version},os:q("not known")};
e.prototype.repeat={b:function(){var a,b,c,e,g,f=this;d.find("fieldset.jr-repeat").prepend('<span class="repeat-number"></span>');d.find("fieldset.jr-repeat:not([data-repeat-fixed])").append('<button type="button" class="repeat"></button><button type="button" class="remove"></button>');d.find("button.repeat").button({text:m,icons:{primary:"ui-icon-plusthick"}});d.find("button.remove").button({disabled:i,text:m,icons:{primary:"ui-icon-minusthick"}});d.on("click","button.repeat:enabled",function(){f.clone($(this).parent("fieldset.jr-repeat"));
return m});d.on("click","button.remove:enabled",function(){f.remove($(this).parent("fieldset.jr-repeat.clone"));return m});d.find("fieldset.jr-repeat").each(function(){c=$(this).attr("data-repeat-count")||"";b=0<c.length?parseInt(h.a(c).h(),10):0;e=h.a($(this).attr("name")).get().length;g=b>e?b:e;for(a=1;a<g;a++)f.clone($(this).siblings().andSelf().last(),"")})},clone:function(a,b){var c,e,g,f,l,o,p=this;if(1!==a.length)return console.error("Nothing to clone"),m;c=a.parent("fieldset.jr-group").children("fieldset.jr-repeat:not(.clone)").eq(0);
e=c.clone(m);e.find(".clone").remove();e.addClass("clone");e.find("button.remove").button({text:m,icons:{primary:"ui-icon-minusthick"}});e.find("button.repeat").button({text:m,icons:{primary:"ui-icon-plusthick"}});e.insertAfter(a).parent(".jr-group").X();e.hide().show("highlight",{},600);e.M(b);e.find(".invalid input, .invalid select, .invalid textarea").each(function(){p.F($(this))});g=d.find('fieldset.jr-repeat[name="'+a.attr("name")+'"]').index(a);f=[];e.find('input[type="radio"]').each(function(){-1===
$.inArray($(this).attr("data-name"),f)&&f.push($(this).attr("data-name"))});for(l=0;l<f.length;l++)o=(new Date).getTime().toString(),e.find('input[type="radio"][data-name="'+f[l]+'"]').attr("name",o);this.aa(c.parent());c=c.attr("name");0<c.length&&0<=g&&h.fa(c,g);d.trigger("changerepeat");return i},remove:function(a){var b=this,c=a.attr("name"),e=d.find('[name="'+c+'"]').index(a),f=a.parent("fieldset.jr-group");a.hide("drop",{},600,function(){a.remove();f.X();b.aa(f)});h.a(c,e).remove();d.trigger("changerepeat")},
aa:function(a){a="undefined"==typeof a||0===a.length||!a?a=d:a;a.find("button.repeat, button.remove").button("disable").removeClass("ui-state-hover");a.find("fieldset.jr-repeat:last-child > button.repeat").button("enable");a.find("fieldset.jr-repeat:not(:nth-child(2)) > button.remove").button("enable")}};e.prototype.ta=function(){var a,b,c=this;$("form.jr").attr("onsubmit","return false;");d.on("change validate","input, select, textarea",function(d){a=c.input.Q($(this));b="validate"==d.type?a.enabled&&
"hidden"!==a.p?h.a(a.path,a.v).c(a.P,a.ba):i:h.a(a.path,a.v).g(a.val,a.P,a.ba);b=a.enabled&&"hidden"!==a.p&&a.required&&1>a.val.length?m:b;if("undefined"!==typeof b&&b!==j)return b===m?c.ua($(this)):c.F($(this))});d.on("dataupdate",function(a,b){c.K(b);c.J.update(b);c.A(b)});d.on("change changerepeat",function(){c.Z(i)});d.on("changerepeat",function(){c.C()});d.on("beforesave",function(){c.G()});$(window).resize(function(){d.n()});d.on("changelanguage",function(){c.A()})};e.prototype.F=function(a){this.input.d(a).removeClass("invalid ui-state-error")};
e.prototype.ua=function(a){this.input.d(a).addClass("invalid ui-state-error")};e.prototype.ka=function(a){for(var b=[a.prop("nodeName")],a=a.parent();1==a.length&&"#document"!==a.prop("nodeName");)b.push(a.prop("nodeName")),a=a.parent();return"/"+b.reverse().join("/")};e.prototype.G=function(){var a=this;d.find("fieldset:disabled input, fieldset:disabled select, fieldset:disabled textarea, input:disabled, select:disabled, textarea:disabled").each(function(){a.F($(this))});d.find("input, select, textarea").trigger("validate")};
String.prototype.i=function(a){for(var b=this;b.length<a;)b="0"+b;return b}}var K=jQuery;K.fn.X=function(){this.each(function(){K(this).find("fieldset.jr-repeat").each(function(){var c,f,e;0===K(this).prev("fieldset.jr-repeat").length&&(c=K(this).siblings("fieldset.jr-repeat"),f=c.length+1,1<f?(K(this).find("span.repeat-number").text("1"),e=2,c.each(function(){K(this).find("span.repeat-number").text(e);e++})):K(this).find("span.repeat-number").empty())})})};
K.fn.M=function(c){c=c||"edit";this.each(function(){K(this).find("input, select, textarea").each(function(){var f=K(this).attr("type");"SELECT"===K(this).prop("nodeName").toUpperCase()&&(f="select");"TEXTAREA"===K(this).prop("nodeName").toUpperCase()&&(f="textarea");switch(f){case "date":case "number":case "search":case "color":case "range":case "url":case "email":case "password":case "text":case "file":case "hidden":case "textarea":K(this).val("").trigger(c);break;case "radio":case "checkbox":K(this).prop("checked")&&
(K(this).prop("checked",m),K(this).trigger(c));break;case "select":K(this)[0].selectedIndex=-1;K(this).trigger(c);break;default:console.error("Unrecognized input type found when trying to reset: "+f)}})})};K.fn.n=function(){var c;this.each(function(){K(this).find("legend + label").each(function(){c=0<K(this).prev().find(".jr-constraint-msg.active").length&&36>K(this).prev().height()?36:19>K(this).prev().height()?19:K(this).prev().height();K(this).animate({"margin-top":c+6+"px"},600)})})};
K.fn.H=function(c){var f,e,c=c.replace(/\/\//g," "),c=c.replace(/^\//,""),c=c.replace(/\/\.$/,""),c=c.replace(/\//g,">"),c=c.replace(/\[([^@].*?)\]/g,function(c,e){return":has("+e+")"});if(0<=c.indexOf(">..")){c=c.split(/>\.\.>?/g);f=jQuery(c[0],this);for(e=1;e<c.length;e++)f=f.parent(c[e]);return f.get()}return this.find(c)};var E,R,S,F,T,U='There were errors. Please see the "report" tab for details.',V=m;
$(document).ready(function(){T=console.error;console.error=function(){var c=arguments[0];1!==$("#jserrors div ol").length&&$("#jserrors div").append("<ol></ol>");$("#jserrors div ol").append('<li class="error"><span class="ui-icon ui-icon-alert"></span>'+c+"</li>");r.s(U);return T.apply(console,arguments)};R=A("source")||m;S=A("formurl")||m;R||($("#html5-form-source").hide(),$('li a[href="#html5-form-source"]').parent("li").remove());$("#tabs").tabs();$('li a[href="#upload"]').parent("li").hide();
F=$("ul.ui-tabs-nav");F.hide();r.b();r.s("This is an incomplete pre-alpha preview to test the JavaRosa form functionality in Google Chrome. It is not ready for actual use.",3);$(".main .ui-tabs-nav").removeClass("ui-widget-header");$(".main h2").addClass("ui-widget-header ui-corner-all");$("article").addClass("ui-corner-tr");r.wa();$('#upload-form [name="xml_file"]').change(function(){$("#upload-form").submit()});$("#upload-form").ajaxForm({dataType:"xml",beforeSubmit:function(){$("#upload-form label, #input-switcher").hide();
$("#upload-form img.loading").show()},success:W});$("#upload-form #input-switcher a").hover(function(){$(this).toggleClass("ui-state-hover")});$("#upload-form #input-switcher a").click(function(c){c.preventDefault();$("#upload-form label").hide().find('input[name="'+$(this).attr("id")+'"]').parents("label").show();$(this).siblings().removeClass("ui-state-active");$(this).addClass("ui-state-active")});$("#upload-form #input-switcher a#xml_url").click();$("#data-template-show input").change(function(){V=
$(this).is(":checked")?i:m;X()});$("#html5-form-source form").submit(function(){var c,f=$(this),e=f.attr("action"),f='<!DOCTYPE html><html><head><meta charset="utf-8" /><title></title></head><body>'+f.find('textarea[name="content"]').val()+"</body></html>",h=new FormData;h.append("level","error");h.append("content",f);$("#html5validationmessages div").html('<img class="loading" src="images/ajax-loader.gif" />');$.ajax(e,{type:"POST",data:h,contentType:m,processData:m,success:function(e){var d=$("<div></div>");
d.append(e.replace(/<script[A-z =".]*><\/script>/gi,""));d.find("ol:not(.source) li>*:first-child").each(function(){c=$(this).parent("li").attr("class");$(this).addClass(c)});Y(d.find("p.success, ol:not(.source) li>*:first-child"),$("#html5validationmessages div"));$("#html5validationmessages div li.info").hide()},error:function(){$("#html5validationmessages div").empty().append('<ol><li class="info"><span class="ui-icon ui-icon-info"></span>This validation is currently not functional</li></ol>')}});
return m});S&&(S=decodeURIComponent(decodeURI(A("formurl"))),console.log("formurl : "+S),S.match(/^(https?:\/\/)?([\da-z\.\-]+)\.([a-z\.]{2,6})([\/\w \.\-]*)*\/?[\/\w \.\-\=\&\?]*$/)?($("#upload-form label, #input-switcher").hide(),$('#upload-form input[name="xml_url"]').val(S),$("#upload-form").submit()):r.alert("not a valid url"))});
function W(c){var f=$(c);F.show();var c=(new XMLSerializer).serializeToString(f.find("form")[0]),e=(new XMLSerializer).serializeToString(f.find("instance")[0]),h=f.find("xsltmessages message"),l=f.find("jrvalidationmessages message"),d=f.find("xmlerrors message"),f=f.find("xslformerrors message, xsldataerrors message");$("#upload-form img.loading").remove();0<c.length?($("#html5-form-source textarea").empty().text(vkbeautify.xml(c)),$("#html5-form-source form").submit(),$("#survey-form div").empty().append(c),
E=new J(e),E.b(),$('#tabs li a[href="#survey-form"]').click(),$("form.jr").on({change:X,dataupdate:X})):($("#survey-form div").empty(),$('#tabs li a[href="#report"]').click());E&&0<E.o().length?X():$("#data div").text("An error occurred whilst trying to extract the data.");E&&(0<E.o().length&&0===h.length)&&(h=$('<message class="success">Nothing reported back. A good sign if there are no other errors!</message>'));Y(h,$("#xsltmessages div"));0===l.length&&(l=$('<message class="info">Something went wrong</message>'));
Y(l,$("#jrvalidationmessages div"));0===d.length&&(d=$('<message class="success">Valid XML document!</message>'));Y(d,$("#xmlerrors div"));0<f.length&&f.each(function(){console.error("XSLT stylesheet error: "+$(this).text())});E&&(0<E.o().length&&0<$("#report .level-2, #report .level-3").length)&&r.s(U)}function X(){if(E){var c=E.o(V);$("#data textarea").empty().text(vkbeautify.xml(c))}}
function Y(c,f){var e=$("<ol></ol>");c.each(function(){var c="",f="",d=$(this).text(),a={"level-0":"info",info:"info","info warning":"info",success:"circle-check","level-1":"info","level-2":"alert",error:"alert","level-3":"alert"},c=c+($(this).attr("level")?"level-"+$(this).attr("level"):$(this).attr("class")),f=a[c]?"ui-icon ui-icon-"+a[c]:f,c='<li class="'+c+'"><span class="'+f+'"></span>'+d+"</li>";0===e.find("li").filter(function(){return $(this).text()==d}).length&&e.append(c)});f.empty().append(e)}
;