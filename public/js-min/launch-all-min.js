var h=!0,i=null,k=!1;function l(){return function(){}}function m(a){return function(){return a}}var q,s;$(document).ready(function(){s=new t;s.a();"undefined"==typeof console&&(console={log:l()});"undefined"==typeof window.console.debug&&(console.debug=console.log);"true"!==u("debug")&&(window.console.log=l(),window.console.debug=l())});function t(){}q=t.prototype;
q.a=function(){this.Y.J();v(this).a();this.G();"function"===typeof this.F&&this.F();$(".dialog [title]").tooltip();Modernizr.borderradius&&(Modernizr.boxshadow&&Modernizr.csstransitions&&Modernizr.opacity)&&$(document).trigger("browsersupport","fancy-visuals");$("footer").detach().appendTo("#container")};q.J=function(){$(window).trigger("resize")};
q.G=function(){var a=this;$("#feedback-bar-close").button({icons:{primary:"ui-icon-closethick"},text:k}).click(function(a){a.preventDefault();$("#feedback-bar p").remove();$("#feedback-bar").trigger("change")});$("#page-close").button({icons:{primary:"ui-icon-closethick"},text:k}).click(function(d){d.preventDefault();v(a).close()});$("#feedback-bar-close, #page-close").removeClass().addClass("custom-button ui-widget-header ui-corner-all");$(document).on("click",'a[href^="#"]:not([href="#"]):not(nav ul li a)',
function(a){var c=$(this).attr("href");"#"!==c&&(a.preventDefault(),$('nav li a[href="'+c+'"]').click())});$('nav ul li a[href^="#"]').click(function(d){d.preventDefault();d=$(this).attr("href").substr(1);v(a).open(d);$(this).closest("li").addClass("nav-state-active")});$(window).on("onlinestatuschange",function(d,c){a.updateStatus.ka(c)});$(document).on("edit","form.jr",function(d,c){a.updateStatus.S(c)});$(document).on("browsersupport",function(d,c){a.updateStatus.support(c)});$("#page, #feedback-bar").on("change",
function(){a.display()});$("header #status-connection").click(function(a){w($(this).attr("title"));a.stopPropagation()});$(window).resize(function(){$("#container").css("top",$("header").outerHeight());$("body:not(.no-scroll) #container").height($(window).height()-$("header").outerHeight()-$("#form-controls.bottom").outerHeight());var a=$("nav").offset().left,c=$("#logo").offset().left+$("#logo").outerWidth();a<c?$("#logo").css("visibility","hidden"):$("#logo").css("visibility","visible")})};
q.Y={J:function(){$("article.page").each(function(){var a,d="",c;c=$(this).attr("id");a=$(this).attr("data-display")?$(this).attr("data-display"):c;d=$(this).attr("data-title")?$(this).attr("data-title"):c;c=$(this).attr("data-ext-link")?$(this).attr("data-ext-link"):"#"+c;$('<li class="ui-corner-tl ui-corner-tr"><a href="'+c+'" title="'+d+'" >'+a+"</a></li>").appendTo($("nav ul"))})},reset:function(){$("nav ul li").removeClass("nav-state-active")}};
function v(a){a.a=function(){this.v=$("<pages></pages>");$("article.page").detach().appendTo(this.v)};a.get=function(a){var c=this.v.find('article[id="'+a+'"]');return c=0<c.length?c:$('article[id="'+a+'"]')};a.r=function(a){return 0<$("#page article.page"+("undefined"!==typeof a?'[id="'+a+'"]':"")).length};a.open=function(a){var c;if(!this.r(a)){c=this.get(a);if(1!==c.length)return console.error("page not found");this.r()&&this.close();$("#page-content").prepend(c.show()).trigger("change");$("#overlay").show();
setTimeout(function(){c.find(".scroll-list").da();$("#overlay, header").bind("click.pageEvents",function(){$("#page-close").trigger("click")})},50);$(window).bind("resize.pageEvents",function(){$("#page").trigger("change")})}};a.close=function(){var a;a=$("#page .page").detach();this.v.append(a);$("#page").trigger("change");this.Y.reset();$("#overlay").hide();$("#overlay, header").unbind(".pageEvents");$(window).unbind(".pageEvents")};return a}
function w(a,d){var c,d=d?1E3*d:1E4;$("#feedback-bar p").eq(1).remove();$("#feedback-bar p").html()!==a&&(c=$("<p></p>"),c.text(a),$("#feedback-bar").prepend(c));$("#feedback-bar").trigger("change");setTimeout(function(){typeof c!=="undefined"&&c.remove();$("#feedback-bar").trigger("change")},d)}
q.alert=function(a,d){var c,f=$("#dialog-alert"),d=d||"Alert";c=function(){f.dialog("destroy");f.find("#dialog-alert-msg").text("")};f.find("#dialog-alert-msg").html(a).ga();f.dialog({title:d,modal:h,resizable:k,closeOnEscape:h,buttons:{Ok:c},beforeClose:c,width:500})};
q.updateStatus={ka:function(a){console.log("updating online status in menu bar to:");console.log(a);a?$("header #status-connection").removeClass().addClass("ui-icon ui-icon-signal-diag").attr("title","It appears there is currently an Internet connection available."):$("header #status-connection").removeClass().addClass("ui-icon ui-icon-cancel").attr("title","It appears there is currently no Internet connection")},S:function(a){a?$("header #status-editing").removeClass().addClass("ui-icon ui-icon-pencil").attr("title",
"Form is being edited."):$("header #status-editing").removeClass().attr("title","")},support:function(a){var d=v(s).get("settings");0<d.length&&(console.debug("updating browser support for "+a),d.find("#settings-browserSupport-"+a+" span.ui-icon").addClass("ui-icon-check"))}};
q.display=function(){var a,d;d=$("header");var c=$("#feedback-bar"),f=$("#page");0<c.find("p").length?(a=d.outerHeight(),d=v(this).r()?d.outerHeight()+c.outerHeight():d.outerHeight()+c.outerHeight()-f.outerHeight()):(a=d.outerHeight()-c.outerHeight(),d=v(this).r()?d.outerHeight():d.outerHeight()-f.outerHeight());c.css("top",a);f.css("top",d)};
function u(a){for(var d=window.location.search.substring(1).split("&"),c=0;c<d.length;c++){var f=d[c].split("=");if(f[0]==a)return encodeURI(f[1])}return k}function x(a,d){for(var c=a;c.length<d;)c="0"+c;return c}var y=jQuery;y.fn.na=function(){var a=0;this.each(function(){y(this).width()>a&&(a=y(this).width())}).each(function(){y(this).width(a)})};y.fn.reverse=[].reverse;
y.fn.M=function(a){a=y.extend({W:"!@#$%^&*()+=[]\\';,/{}|\":<>?~`.- ",g:"",w:""},a);this.each(function(){a.Ja&&(a.g+="ABCDEFGHIJKLMNOPQRSTUVWXYZ");a.Aa&&(a.g+="abcdefghijklmnopqrstuvwxyz");for(var d=a.w.split(""),c=0;c<d.length;c++)-1!=a.W.indexOf(d[c])&&(d[c]="\\"+d[c]);a.w=d.join("|");var f=a.W+a.g,f=f.replace(RegExp(a.w,"gi"),"");y(this).keypress(function(a){var c;c=a.charCode?String.fromCharCode(a.charCode):String.fromCharCode(a.which);f.indexOf(c)!=-1&&a.preventDefault();a.ctrlKey&&c=="v"&&a.preventDefault()});
y(this).bind("contextmenu",m(k))})};y.fn.Ka=function(a){var d="abcdefghijklmnopqrstuvwxyz",d=d+d.toUpperCase(),a=y.extend({g:d},a);return this.each(function(){y(this).M(a)})};y.fn.alpha=function(a){a=y.extend({g:"1234567890"},a);return this.each(function(){y(this).M(a)})};
y.fn.ga=function(){var a;a||(a=1);var d=this.contents().filter(function(){return 3==this.nodeType}).first(),c=d.text();a=c.split(" ",a).join(" ");d.length&&(d[0].nodeValue=c.slice(a.length),d.before('<span class="capitalize">'+a+"</span>"))};
y.fn.da=function(){this.each(function(){var a=y(this),d=y(this).find("ol");a.css("overflow","hidden");var c=d.height()-a.height();if(0<c){var f=c/d.height(),f=Math.round((1-f)*a.height()),f=f-f%2;y("#records .column.middle").html('<div id="slider-wrap" class="ui-corner-all"><div id="slider-vertical"></div></div>');y("#slider-wrap").height(a.outerHeight());y("#slider-vertical").slider({orientation:"vertical",La:"max",min:0,max:100,value:100,Sa:function(a,e){d.css({top:-((100-e.value)*c/100)})}});y("#slider-wrap").css("margin-top",
y("#records-saved h3").outerHeight(h));y(".ui-slider-handle").css({height:f,"margin-bottom":-0.5*f});a=y("#slider-vertical").height();f=a-f;a=0.5*(a-f);y(".ui-slider").css({height:f,"margin-top":a});y(".ui-slider-range").css({top:-a});y("#slider-wrap").click(function(){y("#slider-vertical").slider("value",0);d.css({top:-c})})}})};function z(a){function d(b){function a(b,c,d){this.j="undefined"!==typeof b&&b?b:"*";this.filter=d="undefined"!==typeof d&&d!==i?d:{};this.filter.s="undefined"!==typeof d.s?d.s:h;this.filter.B="undefined"!==typeof d.B?d.B:k;this.filter.t="undefined"!==typeof d.t?d.t:k;this.filter.m="undefined"!==typeof d.m?d.m:k;this.index=c}var c,d=this,b=b.replace(/<[\/]?instance(>|\s+[^>]*>)/gi,"");this.xml=$.parseXML(b);this.u=c=$(this.xml);XPathJS.bindDomLevel3XPath();this.b=function(b,c,d){return new a(b,c,
d)};a.prototype.get=function(){var b,a;b=this.filter.t===h?c.L(this.j).filter("[template]"):this.filter.s===h?c.L(this.j).not("[template], [template] *"):c.L(this.j);this.filter.m===h?b=b.filter(function(){a=$(this).text();return 0===$(this).children().length&&0<a.trim().length}):this.filter.B===h&&(b=b.filter(function(){return 0===$(this).children().length}));return b="undefined"!==typeof this.index&&this.index!==i?b.eq(this.index):b};a.prototype.h=function(b,a,c){var d,B;B=this.i().join(" ");b=
"undefined"!==typeof b?$.isArray(b)?b.join(" "):b:"";b=this.k(b,c);d=this.get();if(1===d.length&&b.toString().trim()!==B.toString().trim())return d.text(b),b=this.c(a,c),e.trigger("dataupdate",d.prop("nodeName")),b;if(1<d.length)return console.error("nodeset.setVal expected nodeset with one node, but received multiple"),i;0===d.length&&console.error("Data node: "+this.j+" with null-based index: "+this.index+" not found!");return i};a.prototype.i=function(){var b=[];this.get().each(function(){b.push($(this).text())});
return b};a.prototype.clone=function(b){var a,c;a=this.get();b=b||a;1===a.length&&1===b.length?(a.clone().insertAfter(b).find("*").andSelf().removeAttr("template"),c=[a.prop("nodeName")],a.find("*").each(function(){c.push($(this).prop("nodeName"))}),e.trigger("dataupdate",c.join())):console.error("node.clone() function did not receive origin and target nodes")};a.prototype.remove=function(){var b=this.get();0<b.length?(b.remove(),e.trigger("dataupdate",b.prop("nodeName"))):console.error("could not find node "+
this.j+" with index "+this.index+"to remove ")};a.prototype.k=function(b,a){return""===b.toString()?b:"undefined"!==typeof a&&a!==i&&"undefined"!==typeof this.types[a.toLowerCase()]&&"undefined"!==typeof this.types[a.toLowerCase()].k?this.types[a.toLowerCase()].k(b):b};a.prototype.c=function(b,a){var c,B;c=this.i();if(""===c.toString())return h;if("undefined"==typeof a||a===i||"undefined"==typeof this.types[a.toLowerCase()])console.error("data type "+a+" set to string"),a="string";c=this.types[a.toLowerCase()].c(c);
B="undefined"!==typeof b&&b!==i&&0<b.length?d.evaluate(b,"boolean",this.j,this.index):h;return c&&B};a.prototype.types={string:{c:m(h)},select:{c:m(h)},select1:{c:m(h)},decimal:{c:function(b){return!isNaN(b-0)&&b!==i?h:k}},"int":{c:function(b){return!isNaN(b-0)&&b!==i&&Math.round(b)==b?h:k}},date:{c:function(b){return"Invalid Date"!==(new Date(b.toString())).toString()},k:function(b){b=new Date(b);b.setUTCHours(0,0,0,0);return(new Date(b)).toUTCString()}},datetime:{c:function(b){return"Invalid Date"!==
(new Date(b)).toString()}},time:{c:function(b){return"Invalid Date"!==(new Date("2012-01-01 "+b)).toString()},k:function(b){b=new Date("2012-01-01 "+b);return x(b.getHours().toString(),2)+":"+x(b.getMinutes().toString(),2)+":"+x(b.getSeconds().toString(),2)}},barcode:{c:m(h)},geopoint:{c:m(h)},binary:{c:m(h)}}}function c(b){e=$(b)}var f,g,e,n;this.Ca=function(b,a,c,d){return f.evaluate(b,a,c,d)};this.Ra=function(){return g.D()};this.Da=function(){return f.get()};this.data=function(b){return new d(b)};
this.form=function(b){return new c(b)};this.Ea=function(){return f.V()};this.K=function(){return g.K()};this.a=function(){n=$("form.jr:eq(0)").clone().appendTo("<original></original>");f=new d(a);f.a();g=new c("form.jr:eq(0)");g.a()};this.p=function(b){return f.U(b,void 0)};this.Ga=function(){return g.$.get()};this.Pa=function(b){return g.$.set(b)};this.Ha=function(){return g.aa.get()};this.Qa=function(b){return g.aa.set(b)};this.Oa=function(b){return g.n.set(b)};this.Fa=function(){return g.n.get()};
this.reset=function(){$("#form-languages").remove();e.replaceWith(n)};this.c=function(){return g.K()};this.A=function(){return g.A()};d.prototype.a=function(){var b,a;this.b(i,i,{m:h,s:k}).get().each(function(){a=$(this).text();$(this).text(a.trim())});b=this.b(":first",0).get();this.namespace=b.attr("xmlns");b.removeAttr("xmlns");this.Q()};d.prototype.ia=function(b,a){var c,d,e=this.b(b,0,{t:h}),e=0===e.get().length?this.b(b,0):e;d=e.get().prop("nodeName");c=this.b(b,a).get();1===e.get().length&&
1===c.length&&c.next().prop("nodeName")!==d?e.clone(c):c.next().prop("nodeName")!==d&&console.error("Could not find template node and/or node to insert the clone after")};d.prototype.Q=function(b){var a=this;if("undefined"==typeof b||0===b.length)b=this.u.find(":first");b.children("[template]").each(function(){"undefined"==typeof $(this).parent().attr("template")&&0===$(this).siblings($(this).prop("nodeName")).not("[template]").length&&$(this).clone().insertAfter($(this)).find("*").andSelf().removeAttr("template")});
b.children().not("[template]").each(function(){a.Q($(this))})};d.prototype.get=function(){return this.u||i};d.prototype.V=function(){return this.xml||i};d.prototype.U=function(b,a){var c,b="undefined"!==typeof b?b:k,a="undefined"!==typeof a?a:h;c=$("<root></root");this.u.find(":first").clone().appendTo(c);b===k&&c.find("[template]").remove();a===h&&("undefined"!==typeof this.namespace&&0<this.namespace.length)&&c.children().eq(0).attr("xmlns",this.namespace);c=(new XMLSerializer).serializeToString(c.children().eq(0)[0]);
c=c.replace(/xmlns\=\"[A-z0-9\:\/\.\-\%\_\?&amp;]*\"/gi," ");return c=c.replace(/\t/g,"")};d.prototype.sa=function(b,a){var c,d,e,f=b;for(c=0;c<a.length;c++)d=a.eq(c).attr("name"),e=a.eq(c).siblings('[name="'+d+'"]').andSelf().index(a.eq(c)),f=f.replace(d,d+"["+(e+1)+"]");return f};d.prototype.evaluate=function(b,a,c,f){var o,j,g,a=a||"any",f=f||0;o=new d(this.U(k,k));"undefined"!==typeof c||c!==i?(o=o.b(c,f,{}).get()[0],0<e.find('[name="'+c+'"]').parents(".jr-repeat").length&&(c=e.find('[name="'+
c+'"]').eq(f).parents(".jr-repeat"),b=this.sa(b,c))):o=o.V();c={"0":["any","ANY_TYPE"],1:["number","NUMBER_TYPE","numberValue"],2:["string","STRING_TYPE","stringValue"],3:["boolean","BOOLEAN_TYPE","booleanValue"],7:["nodes","ORDERED_NODE_SNAPSHOT_TYPE"],9:["node","FIRST_ORDERED_NODE_TYPE"]};for(j in c)if(j=Number(j),c[j][0]==a)break;else j=0;b=b.replace(/&lt;/g,"<");b=b.replace(/&gt;/g,">");b=b.replace(/&quot;/g,'"');try{g=document.evaluate(b,o,i,j,i);if(0===j){for(j in c)if(j=Number(j),j==Number(g.resultType))return g=
0<j&&4>j?g[c[j][2]]:g,console.debug("evaluated "+b+" to: "+g),g;console.error("Expression: "+b+" did not return any boolean, string or number value as expected")}console.debug("evaluated "+b+" to: "+g[c[j][2]]);return g[c[j][2]]}catch(p){console.error("Error occurred trying to evaluate: "+b+", message: "+p.message)}};c.prototype.a=function(){var b;this.ha();if("undefined"==typeof f||!(f instanceof d))return console.error("variable data needs to be defined as instance of DataXML");e.find('label>input[type="checkbox"], label>input[type="radio"]').parent().parent("fieldset").prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');
e.parent().find("label>select, :not(#jr-preload-items, #jr-calculated-items)>label>input").not('[type="checkbox"], [type="radio"]').parent().prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');e.find('label>input[type="checkbox"][required], label>input[type="radio"][required]').parent().parent("fieldset").find(".question-icons .required").addClass("ui-icon ui-icon-notice");e.parent().find("label>select[required], :not(#jr-preload-items, #jr-calculated-items)>label>input[required]").not('[type="checkbox"], [type="radio"]').parent().find(".question-icons .required").addClass("ui-icon ui-icon-notice");
e.find('input[type="radio"]').each(function(){b=$(this).attr("name");$(this).attr("data-name",b)});e.find("h2").first().append("<span/>");this.repeat.a();this.D();this.fa();this.za.a();this.N.a();this.O();this.C();this.G();this.ta.a();this.xa();this.n.set(k)};c.prototype.ha=function(){var b,a=[],c,d,o,j,g,p,r,n,M,N,O,P,Q,R,S,T,H,I;r=e.find("#stats");b=parseInt(r.find('[id="jrItem"]').text(),10);c=parseInt(r.find('[id="jrInput"]').text(),10);d=parseInt(r.find('[id="jrUpload"]').text(),10);o=parseInt(r.find('[id="jrTrigger"]').text(),
10);j=parseInt(r.find('[id="jrConstraint"]').text(),10);g=parseInt(r.find('[id="jrRelevant"]').text(),10);p=parseInt(r.find('[id="jrCalculate"]').text(),10);r=parseInt(r.find('[id="jrPreload"]').text(),10);n=e.find('input[type="radio"]').length;M=e.find('input[type="checkbox"]').length;e.find("select");N=e.find('option[value!=""]').length;O=e.find('input:not([type="radio"],[type="checkbox"])').length;P=e.find(".trigger").length;Q=e.find('[data-relevant]:not([type="radio"],[type="checkbox"])').length;
R=e.find('input[data-relevant][type="radio"],input[data-relevant][type="checkbox"]').parent().parent("fieldset").length;S=e.find('[data-constraint]:not([type="radio"],[type="checkbox"])').length;T=e.find('input[data-constraint][type="radio"],input[data-constraint][type="checkbox"]').parent().parent("fieldset").length;H=e.find("[data-calculate]").length;I=e.find("#jr-preload-items input").length;b!==N+n+M&&console.error(" total select-type filter differs between XML form and HTML form");c+d!==O-H-
I&&console.error(" total amount of input/upload fields differs between XML form and HTML form");o!=P&&console.error(" total triggers differs between XML form and HTML form");g!=Q+R&&console.error(" total amount of branches differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form)");j!=S+T&&console.error(" total amount of constraints differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form). Note that constraints on &lt;trigger&gt; elements are ignored in the transformation and could cause this error too.");
p!=H&&console.error(" total amount of calculated items differs between XML form and HTML formprel");r!=I&&console.error(" total amount of preload items differs between XML form and HTML form");e.find("[name]").each(function(){$.inArray($(this).attr("name"),a)&&a.push($(this).attr("name"))});for(b=0;b<a.length;b++)1>f.b(a[b]).get().length&&console.error("Found name attribute: "+a[b]+" that does not have a corresponding data node. Transformation error or XML form error (relative nodesets perhaps?")};
c.prototype.input={d:function(b){var a=this.f(b.eq(0));return"radio"==a||"checkbox"==a?b.parent("label").parent("fieldset"):"fieldset"==a?b:b.parent("label")},T:function(b){return 1!==b.length?console.error("getProps(): no input node provided or multiple"):{path:this.getName(b),z:this.qa(b),q:this.f(b),ca:this.ra(b),R:b.attr("data-constraint"),va:b.attr("data-relevant"),val:this.i(b),required:void 0!==b.attr("required")?h:k,enabled:this.isEnabled(b),multiple:this.X(b)}},f:function(b){return 1!==b.length?
"":"input"==b.prop("nodeName").toLowerCase()?0<b.attr("type").length?b.attr("type").toLowerCase():console.error("<input> node has no type"):"select"==b.prop("nodeName").toLowerCase()?"select":"fieldset"==b.prop("nodeName").toLowerCase()?"fieldset":console.error("unexpected input node type provided")},ra:function(b){return 1!==b.length?console.error("getXMLType(): no input node provided or multiple"):b.attr("data-type-xml")},getName:function(b){return 1!==b.length?console.error("getName(): no input node provided or multiple"):
"radio"==this.f(b)?b.attr("data-name"):0<b.attr("name").length?b.attr("name"):console.error("input node has no name")},qa:function(b){var a,c,d;if(1!==b.length)return console.error("getIndex(): no input node provided or multiple");a=this.f(b);c=this.getName(b);d=this.d(b);return("radio"===a&&c!==b.attr("name")?this.d(e.find('[data-name="'+c+'"]')):this.d(e.find('[name="'+c+'"]'))).index(d)},X:function(b){return"checkbox"==this.f(b)||void 0!==b.attr("multiple")?h:k},isEnabled:function(b){return void 0!==
b.attr("disabled")||0!==b.parents("fieldset:disabled").length?k:h},i:function(b){var a,c=[],d;if(1!==b.length)return console.error("getVal(): no inputNode provided or multiple");a=this.f(b);d=this.getName(b);return"radio"==a?this.d(b).find("input:checked").val()||"":"checkbox"==a?(this.d(b).find('input[name="'+d+'"]:checked').each(function(){c.push($(this).val())}),c):b.val()||""},h:function(b,a,c){a=a||0;if("radio"==this.f(e.find('[data-name="'+b+'"]').eq(0)))return this.d(e.find('[data-name="'+
b+'"]')).eq(a).find('input[value="'+c+'"]').attr("checked",h);b=this.d(e.find('[name="'+b+'"]')).eq(a).find("input, select, textarea");this.X(b.eq(0))===h&&(c=c.split(" "));return b.val(c)}};c.prototype.D=function(){var b,a,c,d=this;f.b(i,i,{m:h}).get().each(function(){c=$(this).text();b=f.b($(this).prop("nodeName")).get().index($(this));a=d.oa($(this));d.input.h(a,b,c)})};c.prototype.xa=function(){var b,a,c,d=this,f=e.find("#form-languages").attr("data-default-lang");$("#form-languages").detach().insertBefore($("form.jr").parent());
if(!f||""===f)f=$("#form-languages a:eq(0)").attr("lang");console.debug("default language is: "+f);2>$("#form-languages a").length?(e.find("[lang]").addClass("active"),e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")}),this.H()):($("#form-languages a").click(function(f){f.preventDefault();b=$(this).attr("lang");$("#form-languages a").removeClass("active");$(this).addClass("active");e.find("[lang]").removeClass("active").filter('[lang="'+
b+'"], [lang=""]').addClass("active");e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")});e.find("select>option").not('[value=""]').each(function(){a=$(this).attr("value");c=$(this).parent("select").next(".jr-option-translations").children('.active[data-option-value="'+a+'"]').text().trim();c="undefined"!==typeof c&&0<c.length?c:"[MISSING TRANSLATION]";$(this).text(c)});e.find("legend span.active:not(.jr-hint, .jr-constraint-msg), label span.active:not(.jr-hint, .jr-constraint-msg)").each(function(){0===
$(this).text().trim().length&&$(this).text("[MISSING TRANSLATION]")});d.H();e.trigger("changelanguage")}),$('#form-languages a[lang="'+f+'"]').click())};c.prototype.H=function(){var b,a;e.find("*>.jr-hint").parent().each(function(){a="label"!==$(this).prop("nodeName").toLowerCase()&&"fieldset"!==$(this).prop("nodeName").toLowerCase()?$(this).parent("fieldset"):$(this);b=0<a.length?$(this).find(".jr-hint.active").text().trim():$(this).find("span.jr-hint").text().trim();0<b.length?a.find(".question-icons .hint").attr("title",
b).addClass("ui-icon ui-icon-help"):a.find(".question-icons .hint").removeAttr("title").removeClass("ui-icon ui-icon-help")});e.tooltip()};c.prototype.n={set:function(b){e.attr("data-edited",b.toString());e.trigger("edit",b)},get:function(){return"true"===e.attr("data-edited")?h:k}};c.prototype.$={set:function(b){e.attr("data-stored-with-key",b);e.find("h2 span").text(b)},get:function(){return e.attr("data-stored-with-key")||i},reset:function(){e.removeAttr("data-stored-with-key")}};c.prototype.aa=
{set:function(b){e.attr("data-stored-final",b.toString())},get:function(){return"true"===e.attr("data-stored-final")?h:k},reset:function(){e.removeAttr("data-stored-final")}};c.prototype.N={a:function(){e.on("click",".jr-branch",function(){var b=$(this);$(this).hasClass("busy")||($(this).hasClass("show")?$(this).addClass("busy").removeClass("show").next().hide("blind",{},600,function(){b.removeClass("busy")}):$(this).addClass("busy show").next().show("blind",{},600,function(){b.removeClass("busy");
b.next().o()}))});this.update()},update:function(b){var a,c,d,o,j,n={},p=this;o="undefined"!==typeof b?b.split(","):[];j=0<o.length?[]:["[data-relevant]"];for(b=0;b<o.length;b++)j.push('[data-relevant*="'+o[b]+'"]');e.find(j.join()).each(function(){a=g.input.T($(this));c=g.input.d($(this));if(!("radio"==a.q||"checkbox"==a.q)||!n[a.path]){if(1!==c.length)return console.error("could not find branch node"),k;try{d=f.evaluate(a.va,"boolean",a.path,a.z)}catch(b){return console.error('Serious error occurred trying to evaluate skip logic for node with name: "'+
a.path+'" (message: '+b.message+")"),k}n[a.path]=h;return d===h?p.enable(c):p.disable(c)}})},enable:function(b){b.prev(".jr-branch").hide("slow",function(){$(this).remove()});b.removeClass("disabled").show("blind",{direction:"up"},1E3,function(){$(this).o()});return"label"==b.prop("nodeName").toLowerCase()?b.children("input, select, textarea").removeAttr("disabled"):b.removeAttr("disabled")},disable:function(b){b.addClass("disabled").hide();0===b.prev(".jr-branch").length&&(b.before('<div class="jr-branch ui-corner-all"></div>'),
b.P("change"));return"label"==b.prop("nodeName").toLowerCase()?b.children("input, select, textarea").attr("disabled","disabled"):b.attr("disabled","disabled")}};c.prototype.C=function(b){var a,c,d,g="";console.log("updating active outputs that contain: "+b);c="undefined"!==typeof b?b.split(","):[];d=0<c.length?[]:[".jr-output[data-value]"];for(b=0;b<c.length;b++)d.push('.jr-output[data-value*="'+c[b]+'"]');e.find(":not([disabled]) span.active").find(d.join()).each(function(){try{a=$(this).attr("data-value"),
g=f.evaluate(a,"string")}catch(b){console.error("error occurred trying to evaluate output value from expression: "+a+", (message:"+b.message+")"),g="[ERROR]"}$(this).text(g)});e.o();this.H()};c.prototype.O=function(b){var a,c,d,g,j,n,p;n="undefined"!==typeof b?b.split(","):[];p=0<n.length?[]:["input[data-calculate]"];for(b=0;b<n.length;b++)p.push('input[data-calculate*="'+n[b]+'"]');e.find("#jr-calculated-items").find(p.join()).each(function(){a=$(this).attr("name");c=$(this).attr("data-calculate");
d=$(this).attr("data-type-xml");j=$(this).attr("data-constraint");g=f.evaluate(c,"string",a,i);f.b(a,i).h(g,j,d)})};c.prototype.fa=function(){e.find(".jr-group, .jr-repeat").addClass("ui-corner-all");e.find("h2#form-title").addClass("ui-widget-header ui-corner-all");e.find(".trigger").addClass("ui-state-highlight ui-corner-all");$("fieldset:not(.jr-appearance-compact)>label, fieldset:not(.jr-appearance-compact)>legend").children("img,video,audio").parent().addClass("ui-helper-clearfix with-media")};
c.prototype.za={a:function(){this.ja();this.ma();this.ya();this.la();this.ua();this.pa();this.ea()},ja:function(){e.find(".jr-appearance-compact>label>span").hide()},ma:function(){Modernizr.inputtypes.date||e.find('input[type="date"]').datepicker({})},ya:function(){Modernizr.inputtypes.time||e.find('input[type="time"]').timepicker({})},la:function(){Modernizr.inputtypes.datetime||e.find('input[type="datetime"]').datetimepicker()},Na:function(){e.find("select:not([multiple])").attr("size","1");$("select:not([multiple])").multiselect({multiple:k,
header:"Select one option",noneSelectedText:"Select one option",selectedList:1,position:{my:"left top",at:"left bottom"}})},Ma:function(){e.find("select[multiple]").attr("size","5").find('[value=""]').remove();$("select[multiple]").multiselect({header:"false",position:{my:"left top",at:"left bottom"}})},ua:function(){e.find('input[readonly]:not([data-type-xml="geopoint"])').parent("label").each(function(){var b=$(this).html(),a=$(this).find("input").attr("data-relevant"),c='name="'+$(this).find("input").attr("name")+
'"';$('<fieldset class="trigger ui-state-highlight ui-corner-all" '+("undefined"!==typeof a?'data-relevant="'+a+'" '+c:c)+"></fieldset>").insertBefore($(this)).append(b).find("input").remove();$(this).remove()})},Ia:l(),Ua:l(),Ta:l(),pa:function(){e.find('input[data-type-xml="geopoint"]').attr("placeholder","Awesome geopoint widget will follow in the future!")},Ba:l(),ea:function(){e.find('input[data-type-xml="barcode"]').attr("placeholder","This probably does not require support for browser data entry.")}};
c.prototype.ta={a:function(){var b,a,c,d,g=this;e.find("#jr-preload-items input").each(function(){b=$(this).attr("data-preload").toLowerCase();a=$(this).attr("data-preload-params").toLowerCase();c=$(this).attr("name");"undefined"!==typeof g[b]?(d=f.b(c).i(),g.h($(this),g[b]({param:a,l:d,b:$(this)}))):console.error('Preload "'+b+'"" not supported. May or may not be a big deal.')})},h:function(b,a){b.val(a.toString()).trigger("change")},timestamp:function(b){var a=this;return"start"==b.param&&""!==
b.l?""===b.l?b.l:f.evaluate("now()","string"):"end"==b.param?(e.on("beforesave",function(){a.h(b.b,f.evaluate("now()","string"))}),f.evaluate("now()","string")):""},date:function(b){var a,c;return""!==b.l?(a=new Date(f.evaluate("today()","string")),b=x(a.getUTCFullYear().toString(),4),c=x((a.getUTCMonth()+1).toString(),2),a=x(a.getUTCDate().toString(),2),b+"-"+c+"-"+a):b.l},property:m("no property preload in Rapaide"),context:function(b){return"application"==b.param?"rapaide":""},patient:m("not supported in Rapaide"),
user:m("user preload item not functioning yet"),uid:m("no uid"),browser:function(b){if("name"==b.param)return $.browser.webkit?"webkit":$.browser.mozilla?"mozilla":$.browser.opera?"opera":$.browser.msie?"msie":"unknown";if("version"==b.param)return $.browser.version},os:m("not known")};c.prototype.repeat={a:function(){var b,a,c,d,g,j=this;e.find("fieldset.jr-repeat").prepend('<span class="repeat-number"></span>');e.find("fieldset.jr-repeat:not([data-repeat-fixed])").append('<button type="button" class="repeat"></button><button type="button" class="remove"></button>');
e.find("button.repeat").button({text:k,icons:{primary:"ui-icon-plusthick"}});e.find("button.remove").button({disabled:h,text:k,icons:{primary:"ui-icon-minusthick"}});e.on("click","button.repeat:enabled",function(){j.clone($(this).parent("fieldset.jr-repeat"));return k});e.on("click","button.remove:enabled",function(){j.remove($(this).parent("fieldset.jr-repeat.clone"));return k});e.find("fieldset.jr-repeat").each(function(){c=$(this).attr("data-repeat-count")||"";a=0<c.length?parseInt(f.b(c).i(),
10):0;d=f.b($(this).attr("name")).get().length;g=a>d?a:d;for(b=1;b<g;b++)j.clone($(this).siblings().andSelf().last(),"")})},clone:function(b,a){var c,d,g,j,n,p,r=this;if(1!==b.length)return console.error("Nothing to clone"),k;c=b.parent("fieldset.jr-group").children("fieldset.jr-repeat:not(.clone)").eq(0);d=c.clone(k);d.find(".clone").remove();d.addClass("clone");d.find("button.remove").button({text:k,icons:{primary:"ui-icon-minusthick"}});d.find("button.repeat").button({text:k,icons:{primary:"ui-icon-plusthick"}});
d.insertAfter(b).parent(".jr-group").Z();d.hide().show("highlight",{},600);d.P(a);d.find(".invalid input, .invalid select, .invalid textarea").each(function(){r.I($(this))});g=e.find('fieldset.jr-repeat[name="'+b.attr("name")+'"]').index(b);j=[];d.find('input[type="radio"]').each(function(){-1===$.inArray($(this).attr("data-name"),j)&&j.push($(this).attr("data-name"))});for(n=0;n<j.length;n++)p=(new Date).getTime().toString(),d.find('input[type="radio"][data-name="'+j[n]+'"]').attr("name",p);this.ba(c.parent());
c=c.attr("name");0<c.length&&0<=g&&f.ia(c,g);e.trigger("changerepeat");return h},remove:function(b){var a=this,c=b.attr("name"),d=e.find('[name="'+c+'"]').index(b),g=b.parent("fieldset.jr-group");b.hide("drop",{},600,function(){b.remove();g.Z();a.ba(g)});f.b(c,d).remove();e.trigger("changerepeat")},ba:function(b){b="undefined"==typeof b||0===b.length||!b?b=e:b;b.find("button.repeat, button.remove").button("disable").removeClass("ui-state-hover");b.find("fieldset.jr-repeat:last-child > button.repeat").button("enable");
b.find("fieldset.jr-repeat:not(:nth-child(2)) > button.remove").button("enable")}};c.prototype.G=function(){var b,a,c=this;$("form.jr").attr("onsubmit","return false;");e.on("change validate","input, select, textarea",function(d){b=c.input.T($(this));a="validate"==d.type?b.enabled&&"hidden"!==b.q?f.b(b.path,b.z).c(b.R,b.ca):h:f.b(b.path,b.z).h(b.val,b.R,b.ca);a=b.enabled&&"hidden"!==b.q&&b.required&&1>b.val.length?k:a;if("undefined"!==typeof a&&a!==i)return a===k?c.wa($(this)):c.I($(this))});e.on("dataupdate",
function(b,a){c.O(a);c.N.update(a);c.C(a)});e.on("change changerepeat",function(){c.n.set(h)});e.on("changerepeat",function(){c.D()});$(window).resize(function(){e.o()});e.on("changelanguage",function(){c.C()})};c.prototype.I=function(b){this.input.d(b).removeClass("invalid ui-state-error")};c.prototype.wa=function(b){this.input.d(b).addClass("invalid ui-state-error")};c.prototype.oa=function(b){for(var a=[b.prop("nodeName")],b=b.parent();1==b.length&&"#document"!==b.prop("nodeName");)a.push(b.prop("nodeName")),
b=b.parent();return"/"+a.reverse().join("/")};c.prototype.K=function(){var b=this;e.find("fieldset:disabled input, fieldset:disabled select, fieldset:disabled textarea, input:disabled, select:disabled, textarea:disabled").each(function(){b.I($(this))});e.find("input, select, textarea").trigger("validate");return this.A()};c.prototype.A=function(){return 0<e.find(".invalid").length?k:h}}t.prototype.F=l();var A=jQuery;
A.fn.Z=function(){this.each(function(){A(this).find("fieldset.jr-repeat").each(function(){var a,d,c;0===A(this).prev("fieldset.jr-repeat").length&&(a=A(this).siblings("fieldset.jr-repeat"),d=a.length+1,1<d?(A(this).find("span.repeat-number").text("1"),c=2,a.each(function(){A(this).find("span.repeat-number").text(c);c++})):A(this).find("span.repeat-number").empty())})})};
A.fn.P=function(a){a=a||"edit";this.each(function(){A(this).find("input, select, textarea").each(function(){var d=A(this).attr("type");"SELECT"===A(this).prop("nodeName").toUpperCase()&&(d="select");"TEXTAREA"===A(this).prop("nodeName").toUpperCase()&&(d="textarea");switch(d){case "date":case "number":case "search":case "color":case "range":case "url":case "email":case "password":case "text":case "file":case "hidden":case "textarea":A(this).val("").trigger(a);break;case "radio":case "checkbox":A(this).prop("checked")&&
(A(this).prop("checked",k),A(this).trigger(a));break;case "select":A(this)[0].selectedIndex=-1;A(this).trigger(a);break;default:console.error("Unrecognized input type found when trying to reset: "+d)}})})};A.fn.o=function(){var a;this.each(function(){A(this).find("legend + label").each(function(){a=0<A(this).prev().find(".jr-constraint-msg.active").length&&36>A(this).prev().height()?36:19>A(this).prev().height()?19:A(this).prev().height();A(this).animate({"margin-top":a+6+"px"},600)})})};
A.fn.L=function(a){var d,c,a=a.replace(/\/\//g," "),a=a.replace(/^\//,""),a=a.replace(/\/\.$/,""),a=a.replace(/\//g,">"),a=a.replace(/\[([^@].*?)\]/g,function(a,c){return":has("+c+")"});if(0<=a.indexOf(">..")){a=a.split(/>\.\.>?/g);d=jQuery(a[0],this);for(c=1;c<a.length;c++)d=d.parent(a[c]);return d.get()}return this.find(a)};var C,D,E,F,G='There were errors. Please see the "report" tab for details.',J=k;
$(document).ready(function(){F=new K;F.a();E=console.error;console.error=function(){var a=arguments[0];1!==$("#jserrors div ol").length&&$("#jserrors div").append("<ol></ol>");$("#jserrors div ol").append('<li class="error"><span class="ui-icon ui-icon-alert"></span>'+a+"</li>");w(G);return E.apply(console,arguments)};F.source||($("#html5-form-source").hide(),$('li a[href="#html5-form-source"]').parent("li").remove());$("#tabs").tabs();$('li a[href="#upload"]').parent("li").hide();D=$("ul.ui-tabs-nav");
D.hide();w("This is an incomplete pre-alpha preview to test the JavaRosa form functionality in Google Chrome. It is not ready for actual use.",3);$(".main .ui-tabs-nav").removeClass("ui-widget-header");$(".main h2").addClass("ui-widget-header ui-corner-all");s.J();$('#upload-form [name="xml_file"]').change(function(){$("#upload-form").submit()});$("#upload-form").ajaxForm({dataType:"xml",beforeSubmit:function(a,d){var c=d.find('input[name="server_url"]').val()||"",f=d.find('input[name="form_id"]').val()||
"";if(c!=="")if(L(c)){F.e=c;U(F)}else{s.alert("Not a valid server url");V();return k}if(f!==""){F.id=f;U(F)}$("#upload-form label, #input-switcher, #form-list, #upload .hurry").hide();$("#upload-form img.loading").show()},success:W,error:function(){w("Sorry, an error occured while communicating with the Enketo server.");V()}});$("#upload-form #input-switcher a").hover(function(){$(this).toggleClass("ui-state-hover")}).click(function(a){console.debug("input switcher link clicked");a.preventDefault();
$("#upload-form label").hide().find('input[name="'+$(this).attr("id")+'"]').parents("label").show();$(this).siblings().removeClass("active");$(this).addClass("active")});$("#data-template-show input").change(function(){J=$(this).is(":checked")?h:k;X()});$(document).on("click","#form-list a",function(a){var d=$(this).attr("id");a.preventDefault();$('#upload-form input[name="form_id"]').val(d);$("#upload-form").submit()});$("#html5-form-source form").submit(function(){var a,d=$(this),c=d.attr("action"),
d='<!DOCTYPE html><html><head><meta charset="utf-8" /><title></title></head><body>'+d.find('textarea[name="content"]').val()+"</body></html>",f=new FormData;f.append("level","error");f.append("content",d);$("#html5validationmessages div").html('<img class="loading" src="images/ajax-loader.gif" />');$.ajax(c,{type:"POST",data:f,contentType:k,processData:k,success:function(c){var d=$("<div></div>");d.append(c.replace(/<script[A-z =".]*><\/script>/gi,""));d.find("ol:not(.source) li>*:first-child").each(function(){a=
$(this).parent("li").attr("class");$(this).addClass(a)});Y(d.find("p.success, ol:not(.source) li>*:first-child"),$("#html5validationmessages div"));$("#html5validationmessages div li.info").hide()},error:function(){$("#html5validationmessages div").empty().append('<ol><li class="info"><span class="ui-icon ui-icon-info"></span>This validation is currently not functional</li></ol>')}});return k});$("#upload-form #input-switcher a#server_url").click();$("#dialog-launch form").submit(function(a){a.preventDefault();
console.debug("in ajax submit");$.ajax("launch/launchSurvey",{type:"POST",data:$(this).serialize(),error:function(){console.error("an error occurred when sending survey launch data")},complete:function(){console.log("form submission complete")}})});F.e&&($('#upload-form input[name="server_url"]').val(F.e),F.id&&$('#upload-form input[name="form_id"]').val(F.id),$("#upload-form").submit())});function K(){}
K.prototype.a=function(){var a=h,d=decodeURIComponent(decodeURI(u("server")));this.e=d&&L(d)?d:i;this.id=u("id")||i;this.source=u("source")||k;this.debug=u("debug")||k;U(F);$(window).on("popstate",function(){a||(window.location=location.href);a=k});setTimeout(function(){a=k},5E3)};
function U(a){var d={e:a.e,id:a.id,source:a.source,debug:a.debug},c="",f="launch",c=a.e!==i&&L(a.e)?c+"server="+encodeURIComponent(a.e):c,c=a.id!==i?c+"&id="+encodeURIComponent(a.id):c,c="true"==a.source||a.source===h?c+"&source="+encodeURIComponent(a.source):c,c="true"==a.debug||a.debug===h?c+"&debug="+encodeURIComponent(a.debug):c,c="&"==c.substring(0,1)?c.substring(1):c,f=0<c.length?f+"?"+c:f;location.href!==location.protocol+"//"+location.hostname+"/"+f&&(console.debug("pushing history state "),
console.debug(location.href),console.debug(location.hostname+"/"+f),console.debug(d),history.pushState(d,"Enketo Launch",f))}K.prototype.reset=function(){this.id=this.e=i;U(this)};
t.prototype.F=function(){$("button#reset-form").button({icons:{primary:"ui-icon-refresh"}}).click(function(){V()});$("button#validate-form").button({disabled:h,text:k,icons:{primary:"ui-icon-check"}}).click(function(){C.c()});$("button#launch-form").button({disabled:h,icons:{primary:"ui-icon-arrowthick-1-e"}}).click(function(){s.alert("In the future this button will launch the form in Rapaide.survey ","Not functional yet")});$("#form-controls button:not(#validate-form)").na();$("#dialog-launch a.advanced").click(function(a){a.preventDefault();
$(this).hasClass("active")?$(this).text("show advanced options").removeClass("active").siblings("fieldset.advanced").hide():$(this).text("hide advanced options").addClass("active").siblings("fieldset.advanced").show()})};function L(a){return/^(https?:\/\/)?([\da-z\.\-]+)\.([a-z\.]{2,6})([\/\w \.\-]*)*\/?[\/\w \.\-\=\&\?]*$/.test(a)}
function V(){F.reset();$("#upload-form")[0].reset();$('#upload-form input[type="hidden"]').val("");$("#upload-form img.loading, #form-list").hide();$("#input-switcher, #upload .hurry").show().find("a#server_url").click();$("#form-languages").remove();s.updateStatus.S(k);$("#survey-form div, #xsltmessages div, #html5validationmessages div, #jrvalidationmessages div, #xmlerrors div, #xslerrors div, #html5-form-source textarea, #data textarea").empty();C=i;$("#validate-form, #launch-form").button("disable");
$('#tabs li a[href="#upload"]').click();D.hide()}
function W(a){var d=$(a);if(0<d.find("formlist").length){var c="";0===d.find("formlist>li").length?(w("Formlist at server "+F.e+" was found to be empty or the server is asleep."),V()):(d.find("formlist>li").each(function(){c+=(new XMLSerializer).serializeToString($(this)[0])}),$("#form-list ol").empty().append(c),$("#form-list ol li a").button(),$("#upload-form img.loading").hide(),$("#form-list").show())}else{D.show();var a=(new XMLSerializer).serializeToString(d.find("form")[0]),f=(new XMLSerializer).serializeToString(d.find("instance")[0]),
g=d.find("xsltmessages message"),e=d.find("jrvalidationmessages message"),n=d.find("xmlerrors message"),d=d.find("xslformerrors message, xsldataerrors message");$("#upload-form img.loading").hide();0<a.length?($("#html5-form-source textarea").empty().text(vkbeautify.xml(a)),$("#html5-form-source form").submit(),$("#survey-form div").empty().append(a),C=new z(f),C.a(),$('#tabs li a[href="#survey-form"]').click(),$(document).on("change dataupdate","form.jr",X),$("#validate-form, #launch-form").button("enable")):
($("#survey-form div").empty(),$('#tabs li a[href="#report"]').click());C&&0<C.p().length?X():$("#data div").text("An error occurred whilst trying to extract the data.");C&&(0<C.p().length&&0===g.length)&&(g=$('<message class="success">Nothing reported back. A good sign if there are no other errors!</message>'));Y(g,$("#xsltmessages div"));0===e.length&&(e=$('<message class="info">Something went wrong</message>'));Y(e,$("#jrvalidationmessages div"));0===n.length&&(n=$('<message class="success">Valid XML document!</message>'));
Y(n,$("#xmlerrors div"));0<d.length&&d.each(function(){console.error("XSLT stylesheet error: "+$(this).text())});C&&(0<C.p().length&&0<$("#report .level-2, #report .level-3").length)&&w(G)}}function X(){if(C){var a=C.p(J);$("#data textarea").empty().text(vkbeautify.xml(a))}}
function Y(a,d){var c=$("<ol></ol>");a.each(function(){var a="",d="",e=$(this).text(),n={"level-0":"info",info:"info","info warning":"info",success:"circle-check","level-1":"info","level-2":"alert",error:"alert","level-3":"alert"},a=a+($(this).attr("level")?"level-"+$(this).attr("level"):$(this).attr("class")),d=n[a]?"ui-icon ui-icon-"+n[a]:d,a='<li class="'+a+'"><span class="'+d+'"></span>'+e+"</li>";0===c.find("li").filter(function(){return $(this).text()==e}).length&&c.append(a)});d.empty().append(c)}
;