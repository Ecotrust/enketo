var i=void 0,j=!0,k=null,m=!1;function q(){return function(){}}function r(c){return function(){return c}}var s,t,w=k,y,z,A;$(document).ready(function(){s=new C;"undefined"==typeof console&&(console={log:q()});"undefined"==typeof window.console.debug&&(console.debug=console.log);var c;a:{c=window.location.search.substring(1).split("&");for(var f=0;f<c.length;f++){var g=c[f].split("=");if("debug"==g[0]){c=encodeURI(g[1]);break a}}c=m}"true"!==c&&(window.console.log=q(),window.console.debug=q())});
function H(){}
function C(){function c(){$("nav ul li").removeClass("active").css("border-color",o);$("nav ul li a").css("color",n)}var f,g,h,e,a,b,d,v,l,x,p,o,n,B,D,E,u=this;this.a=function(){e=$("header");a=$("#feedback-bar");b=$("#page");v=$("#dialog-confirm");l=$("#dialog-alert");$("form.jr:eq(0)");Modernizr.borderradius&&(Modernizr.boxshadow&&Modernizr.csstransitions&&Modernizr.opacity)&&this.F({"fancy-visuals":j});$("article.page").each(function(){var a,b="",d;d=$(this).attr("id");a=$(this).attr("data-display")?$(this).attr("data-display"):
d;b=$(this).attr("data-title")?$(this).attr("data-title"):d;d=$(this).attr("data-ext-link")?$(this).attr("data-ext-link"):"#"+d;$('<li class="ui-corner-tl ui-corner-tr"><a href="'+d+'" title="'+b+'" >'+a+"</a></li>").appendTo($("nav ul"))});var d;x=$("#feedback-bar").css("background-color");p=$("header").css("border-top-color");o=$("header").css("background-color");$("body").removeClass("ui-widget-content");$("nav").addClass("ui-state-default");$("nav").css("color");n=$("nav").css("background-color");
$("nav").addClass("ui-state-hover");B=$("nav").css("background-color");$("nav").addClass("ui-state-active");D=$("nav").css("background-color");$("nav").removeClass();$("#page, #form-controls").css("background-image","none");$("#page, #component").css("color",x);$("#survey-info").css("color",p);d=$("body").addClass("ui-widget-shadow").css("background-color");$("body").css("background-color",d).removeClass("ui-widget-shadow");d=$("#page-content").addClass("ui-widget-overlay").css("background-color");
$("#page-content, #overlay").css("background-color",d).removeClass("ui-widget-overlay");$(".page a, .page a:link, .page a:visited").css("color",n).hover(function(){$(this).css("color",B)},function(){$(this).css("color",n)}).mousedown(function(){$(this).css("color",D)}).mouseup(function(){$(this).css("color",n)});$(".tabs-nohdr .ui-tabs-panel").css("background-color","#FEEEBD");c();$("button#save-form").button({icons:{primary:"ui-icon-disk"}}).click(q());$("button#reset-form").button({icons:{primary:"ui-icon-refresh"}}).click(function(){I()});
$("button#delete-form").button({icons:{primary:"ui-icon-trash"}}).click(q());$("button#launch-form").button({icons:{primary:"ui-icon-arrowthick-1-e"}}).click(function(){s.alert("In the future this button will launch the form in Rapaide.survey (now it just triggers validation of the whole form).","Not functional");$("form.jr").trigger("beforesave")});$("#form-controls button").oa();$("#feedback-bar-close").button({icons:{primary:"ui-icon-closethick"},text:m}).click(function(a){a.preventDefault();u.X()});
$("#page-close").button({icons:{primary:"ui-icon-closethick"},text:m}).click(function(a){a.preventDefault();u.Q()});$("#feedback-bar-close, #page-close").removeClass().addClass("custom-button ui-widget-header ui-corner-all");$('a[href^="#"]:not(nav ul li a)').click(function(a){console.log("captured click to internal link that is not in nav");var b=$(this).attr("href");"#"!==b&&(a.preventDefault(),$('nav li a[href="'+b+'"]').click())});$('nav ul li a[href^="#"]').click(function(a){a.preventDefault();
a=$(this).attr("href").substr(1);u.va(a);$(this).closest("li").addClass("active").css("border-color",p);$(this).css("color",x)}).hover(function(){$("nav ul li:not(.active)").css("border-color",o);$(this).closest("li:not(.active)").css("border-color",x).find("a").css("color",B)},function(){$("nav ul li:not(.active)").css("border-color",o).find("a").css("color",n)});$(window).on("onlinestatuschange",function(a,b){u.Ia(b)});$(document).on("edit","form.jr",function(){E(j)});$("header #status-connection").click(function(a){u.e($(this).attr("title"));
a.stopPropagation()});$("#settings input").change(H);$("#records-saved li:not(.no-click)").on("click","li",function(a){a.preventDefault()}).on("mouseenter","li",function(){$(this).addClass("ui-state-hover");$(this).mousedown(function(){$(this).addClass("ui-state-active")})}).on("mouseleave","li",function(){$(this).removeClass("ui-state-hover")});$("button#records-force-upload").button({icons:{cb:"ui-icon-arrowthick-1-n"}}).click(q()).hover(function(){$("#records-force-upload-info").show()},function(){$("#records-force-upload-info").hide()});
$("button#records-export").button({icons:{primary:"ui-icon-suitcase"}}).click(q()).hover(function(){$("#records-export-info").show()},function(){$("#records-export-info").hide()});$("#export-excel").button({icons:{primary:"ui-icon-suitcase"}});$(window).resize(function(){$("#container").css("top",$("header").outerHeight());$("body:not(.no-scroll) #container").height($(window).height()-$("header").outerHeight()-$("#form-controls.bottom").outerHeight());var a=$("nav").offset().left,b=$("#logo").offset().left+
$("#logo").outerWidth();a<b?$("#logo").css("visibility","hidden"):$("#logo").css("visibility","visible")});$("footer").detach().appendTo("#container")};this.Ea=function(){$(window).trigger("resize");d=$("<pages></pages>");$("article.page").detach().appendTo(d).css("display","block")};this.F=function(a){for(var b in a);};this.Za=function(){return f};this.$a=function(){return g};this.va=function(a){g&&this.Q();g=j;a&&(b.find("#page-content").prepend(y(a)),"records"===a&&z());A();$("#overlay").show();
setTimeout(function(){$("#overlay, header").bind("click.pageEvents",function(){$("#page-close").trigger("click")})},50);$(window).bind("resize.pageEvents",function(){A()})};this.Q=function(){g=m;b.find(".page").detach();A();c();$("#overlay").hide();$("#overlay, header").unbind(".pageEvents");$(window).unbind(".pageEvents")};this.e=function(b,d){d=d?1E3*d:1E4;clearTimeout(h);h=setTimeout(function(){u.X()},d);f=j;1<a.find("p").length&&a.find("p:eq(1)").remove();if(a.find("p").html()!==b||0===a.find("p").length){var e=
$("<p></p>");e.text(b);a.prepend(e)}A()};this.X=function(){f=m;a.find("p").remove();A()};this.alert=function(a,b){var d,b=b||"Alert";d=function(){l.dialog("destroy");l.find("#dialog-alert-msg").text("")};l.find("#dialog-alert-msg").text(a).N();l.dialog({title:b,modal:j,resizable:m,buttons:{Ok:d},beforeClose:d})};this.confirm=function(a,b,d){var e,l,c,d=d||"Are you sure?",b="undefined"==typeof b?{v:"Confirm",r:"Cancel"}:b;b.v=b.v||"Confirm";b.r=b.r||"Cancel";b.u=b.u||q();b.aa=b.aa||q();e=b.u;l=b.aa;
c=function(){v.dialog("destroy");v.find("#dialog-confirm-msg").text("")};v.find("#dialog-confirm-msg").text(a||"Please confirm action").N();v.dialog({title:d,resizable:m,modal:j,buttons:[{text:b.v,click:function(){e.call();c.call()}},{text:b.r,click:function(){l.call();c.call()}}],beforeClose:c})};this.Ia=function(a){console.log("updating online status in menu bar to:");console.log(a);a?$("header #status-connection").removeClass().addClass("ui-icon ui-icon-signal-diag").attr("title","It appears there is currently an Internet connection available."):
$("header #status-connection").removeClass().addClass("ui-icon ui-icon-cancel").attr("title","It appears there is currently no Internet connection")};E=function(a){a?$("header #status-editing").removeClass().addClass("ui-icon ui-icon-pencil").attr("title","Form is being edited."):$("header #status-editing").removeClass().attr("title","")};A=function(){var d,l;f?(d=e.outerHeight(),l=g?e.outerHeight()+a.outerHeight():e.outerHeight()+a.outerHeight()-b.outerHeight()):(d=e.outerHeight()-a.outerHeight(),
l=g?e.outerHeight():e.outerHeight()-b.outerHeight());a.css("top",d);b.css("top",l)};y=function(a){g=d.find('article[id="'+a+'"]').clone(j);switch(a){case "records":u.fa(g)}return g};z=function(){var a=$("#records-saved-pane"),b=$("#records-saved ol");a.css("overflow","hidden");var d=b.height()-a.height();if(0<d){var e=d/b.height(),e=Math.round((1-e)*a.height()),e=e-e%2;$("#records .column.middle").html('<div id="slider-wrap" class="ui-corner-all"><div id="slider-vertical"></div></div>');$("#slider-wrap").height(a.outerHeight());
$("#slider-vertical").slider({orientation:"vertical",eb:"max",min:0,max:100,value:100,jb:function(a,e){var l=-((100-e.value)*d/100);console.log("new topValue:"+l);b.css({top:l})}});$("#slider-wrap").css("margin-top",$("#records-saved h3").outerHeight(j));$(".ui-slider-handle").css({height:e,"margin-bottom":-0.5*e});a=$("#slider-vertical").height();e=a-e;a=0.5*(a-e);$(".ui-slider").css({height:e,"margin-top":a});$(".ui-slider-range").css({top:-a});$("#slider-wrap").click(function(){$("#slider-vertical").slider("value",
0);b.css({top:-d})});$("#records-saved-pane,#slider-wrap").mousewheel(function(a,e){var l=$("#slider-vertical").slider("value"),l=l+5*e;$("#slider-vertical").slider("value",l);l=-((100-l)*d/100);0<l&&(l=0);Math.abs(l)>d&&(l=-1*d);b.css({top:l});a.preventDefault()})}};this.fa=function(a){a||(a=d.find('article[id="records"]'));a.find("#records-saved ol").children().remove();a.find("#records-draft-qty").text(0);a.find("#records-final-qty").text(0)}}var J=jQuery;
J.fn.oa=function(){var c=0;this.each(function(){J(this).width()>c&&(c=J(this).width())}).each(function(){J(this).width(c)})};J.fn.reverse=[].reverse;
J.fn.K=function(c){c=J.extend({Y:"!@#$%^&*()+=[]\\';,/{}|\":<>?~`.- ",g:"",z:""},c);this.each(function(){c.ab&&(c.g+="ABCDEFGHIJKLMNOPQRSTUVWXYZ");c.Ma&&(c.g+="abcdefghijklmnopqrstuvwxyz");for(var f=c.z.split(""),g=0;g<f.length;g++)-1!=c.Y.indexOf(f[g])&&(f[g]="\\"+f[g]);c.z=f.join("|");var h=c.Y+c.g,h=h.replace(RegExp(c.z,"gi"),"");J(this).keypress(function(e){var a;a=e.charCode?String.fromCharCode(e.charCode):String.fromCharCode(e.which);h.indexOf(a)!=-1&&e.preventDefault();e.ctrlKey&&a=="v"&&e.preventDefault()});
J(this).bind("contextmenu",r(m))})};J.fn.bb=function(c){var f="abcdefghijklmnopqrstuvwxyz",f=f+f.toUpperCase(),c=J.extend({g:f},c);return this.each(function(){J(this).K(c)})};J.fn.alpha=function(c){c=J.extend({g:"1234567890"},c);return this.each(function(){J(this).K(c)})};
J.fn.N=function(){var c;c||(c=1);var f=this.contents().filter(function(){return 3==this.nodeType}).first(),g=f.text();c=g.split(" ",c).join(" ");f.length&&(f[0].nodeValue=g.slice(c.length),f.before('<span class="capitalize">'+c+"</span>"))};function K(){var c="settings temporary null history Firebug undefined bookmark".split(" "),f=window.localStorage;this.isSupported=function(){try{return"localStorage"in window&&window.localStorage!==k}catch(c){return m}};this.Ta=function(){return c};this.Da=function(g){var h,e,a,b=g.recordType;(a="surveyData"===b?g[P.La]:b)&&(a=$.trim(a));h=h?$.trim(h):k;e!==j&&(e=m);if("surveyData"!==b||a){var d;if(d="surveyData"===b)a:{for(d=0;d<c.length;d++)if(a===c[d]){d=j;break a}d=m}if(!d&&(!("surveyData"===
b&&f.getItem(a))||!(h!==a&&e===m)))try{g.lastSaved=(new Date).getTime(),f.setItem(a,JSON.stringify(g)),h!==k&&""!==h&&h!==a&&e&&this.ca(h)}catch(v){console.log("error in store.setData:"+v.message)}}};this.T=function(c){var h;try{return h=JSON.parse(f.getItem(c))}catch(e){return console.log("error with loading data from store: "+e.message),k}};this.ca=function(c){try{f.removeItem(c)}catch(h){console.log("error with removing data from store: "+h.message)}};this.Ua=function(){var c=[],f,e,a=this.U(),
b;for(b in a)e=a[b],f="true"===e.ready||e.ready===j?j:m,c.push({key:e.key,"final":f,lastSaved:e.$});c.sort(function(a,b){return b.$-a.$});return c};this.U=function(c){var h="surveyData",e;h||(h="surveyData");var a=[],b,d={};try{for(e=0;e<f.length;e++){b=f.key(e);d=f.getItem(b);try{d=JSON.parse(d),d.key=b,d.fb===h&&(c&&("true"===d.ready||d.ready===j)&&d.key!=P.getKey()?a.push(d):c||a.push(d))}catch(v){console.log("record found that was probably not in the correct JSON format (e.g. Firebug settings or corrupt record) (error: "+
v.message+"), record was ignored")}}}catch(l){console.log("error with retrieving all survey data data from storage"),a=[]}return a};this.sa=function(){var c={},c=(c=this.T("settings"))?c:w;return c=c["settings-auto-upload"]}};window.XMLSerializer=XMLSerializer;
function R(){function c(a){function b(a,b,d){this.k="undefined"!==typeof a&&a?a:"*";this.filter=d="undefined"!==typeof d&&d!==k?d:{};this.filter.s="undefined"!==typeof d.s?d.s:j;this.filter.B="undefined"!==typeof d.B?d.B:m;this.filter.t="undefined"!==typeof d.t?d.t:m;this.filter.n="undefined"!==typeof d.n?d.n:m;this.index=b}var d,c=this,a=a.replace(/<[\/]?instance(>|\s+[^>]*>)/gi,"");this.xml=$.parseXML(a);this.w=d=$(this.xml);XPathJS.bindDomLevel3XPath();this.b=function(a,d,e){return new b(a,d,e)};
b.prototype.get=function(){var a,b;a=this.filter.t===j?d.J(this.k).filter("[template]"):this.filter.s===j?d.J(this.k).not("[template], [template] *"):d.J(this.k);this.filter.n===j?a=a.filter(function(){b=$(this).text();return 0===$(this).children().length&&0<b.trim().length}):this.filter.B===j&&(a=a.filter(function(){return 0===$(this).children().length}));return a="undefined"!==typeof this.index&&this.index!==k?a.eq(this.index):a};b.prototype.h=function(a,b,d){var c,f;f=this.i().join(" ");a="undefined"!==
typeof a?$.isArray(a)?a.join(" "):a:"";a=this.l(a,d);c=this.get();if(1===c.length&&a.toString().trim()!==f.toString().trim())return c.text(a),a=this.c(b,d),e.trigger("dataupdate",c.prop("nodeName")),a;if(1<c.length)return console.error("nodeset.setVal expected nodeset with one node, but received multiple"),k;0===c.length&&console.error("Data node: "+this.k+" with null-based index: "+this.index+" not found!");return k};b.prototype.i=function(){var a=[];this.get().each(function(){a.push($(this).text())});
return a};b.prototype.clone=function(a){var b,d;b=this.get();a=a||b;1===b.length&&1===a.length?(b.clone().insertAfter(a).find("*").andSelf().removeAttr("template"),d=[b.prop("nodeName")],b.find("*").each(function(){d.push($(this).prop("nodeName"))}),e.trigger("dataupdate",d.join())):console.error("node.clone() function did not receive origin and target nodes")};b.prototype.remove=function(){var a=this.get();0<a.length?(a.remove(),e.trigger("dataupdate",a.prop("nodeName"))):console.error("could not find node "+
this.k+" with index "+this.index+"to remove ")};b.prototype.l=function(a,b){return""===a.toString()?a:"undefined"!==typeof b&&b!==k&&"undefined"!==typeof this.types[b.toLowerCase()]&&"undefined"!==typeof this.types[b.toLowerCase()].l?this.types[b.toLowerCase()].l(a):a};b.prototype.c=function(a,b){var d,e;d=this.i();if(""===d.toString())return j;if("undefined"==typeof b||b===k||"undefined"==typeof this.types[b.toLowerCase()])console.error("data type "+b+" set to string"),b="string";d=this.types[b.toLowerCase()].c(d);
e="undefined"!==typeof a&&a!==k&&0<a.length?c.evaluate(a,"boolean",this.k,this.index):j;return d&&e};b.prototype.types={string:{c:r(j)},select:{c:r(j)},select1:{c:r(j)},decimal:{c:function(a){return!isNaN(a-0)&&a!==k?j:m}},"int":{c:function(a){return!isNaN(a-0)&&a!==k&&Math.round(a)==a?j:m}},date:{c:function(a){return"Invalid Date"!==(new Date(a.toString())).toString()},l:function(a){a=new Date(a);a.setUTCHours(0,0,0,0);return(new Date(a)).toUTCString()}},datetime:{c:function(a){return"Invalid Date"!==
(new Date(a)).toString()}},time:{c:function(a){return"Invalid Date"!==(new Date("2012-01-01 "+a)).toString()},l:function(a){a=new Date("2012-01-01 "+a);return a.getHours().toString().j(2)+":"+a.getMinutes().toString().j(2)+":"+a.getSeconds().toString().j(2)}},barcode:{c:r(j)},geopoint:{c:r(j)},binary:{c:r(j)}}}function f(a){e=$(a)}var g,h,e;this.Pa=function(a,b,d,e){return g.evaluate(a,b,d,e)};this.ib=function(){return h.D()};this.Qa=function(){return g.get()};this.data=function(a){return new c(a)};
this.form=function(a){return new f(a)};this.Sa=function(){return g.W()};this.I=function(){return h.I()};this.a=function(){g=new c(i);g.a();h=new f("form.jr:eq(0)");h.a()};this.Ra=function(a,b){return g.V(a,b)};c.prototype.a=function(){var a,b;this.b(k,k,{n:j,s:m}).get().each(function(){b=$(this).text();$(this).text(b.trim())});a=this.b(":first",0).get();this.namespace=a.attr("xmlns");a.removeAttr("xmlns");this.P()};c.prototype.ka=function(a,b){var d,e,c=this.b(a,0,{t:j}),c=0===c.get().length?this.b(a,
0):c;e=c.get().prop("nodeName");d=this.b(a,b).get();1===c.get().length&&1===d.length&&d.next().prop("nodeName")!==e?c.clone(d):d.next().prop("nodeName")!==e&&console.error("Could not find template node and/or node to insert the clone after")};c.prototype.P=function(a){var b=this;if("undefined"==typeof a||0===a.length)a=this.w.find(":first");a.children("[template]").each(function(){"undefined"==typeof $(this).parent().attr("template")&&0===$(this).siblings($(this).prop("nodeName")).not("[template]").length&&
$(this).clone().insertAfter($(this)).find("*").andSelf().removeAttr("template")});a.children().not("[template]").each(function(){b.P($(this))})};c.prototype.get=function(){return this.w||k};c.prototype.W=function(){return this.xml||k};c.prototype.V=function(a,b){var d,a="undefined"!==typeof a?a:m,b="undefined"!==typeof b?b:j;d=$("<root></root");this.w.find(":first").clone().appendTo(d);a===m&&d.find("[template]").remove();b===j&&("undefined"!==typeof this.namespace&&0<this.namespace.length)&&d.children().eq(0).attr("xmlns",
this.namespace);d=(new XMLSerializer).serializeToString(d.children().eq(0)[0]);return d=d.replace(/xmlns\=\"[A-z0-9\:\/\.\-\%\_\?&amp;]*\"/gi," ")};c.prototype.evaluate=function(a,b,d,e){var f,g,h,b=b||"any";f=new c(this.V(m,m));d="undefined"!==typeof d||d!==k?f.b(d,e,{}).get()[0]:f.W();e={"0":["any","ANY_TYPE"],1:["number","NUMBER_TYPE","numberValue"],2:["string","STRING_TYPE","stringValue"],3:["boolean","BOOLEAN_TYPE","booleanValue"],7:["nodes","ORDERED_NODE_SNAPSHOT_TYPE"],9:["node","FIRST_ORDERED_NODE_TYPE"]};
for(g in e)if(g=Number(g),e[g][0]==b)break;else g=0;a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");a=a.replace(/&quot;/g,'"');try{h=document.evaluate(a,d,k,g,k);if(0===g){for(g in e)if(g=Number(g),g==Number(h.resultType))return h=0<g&&4>g?h[e[g][2]]:h,console.debug("evaluated "+a+" to: "+h),h;console.error("Expression: "+a+" did not return any boolean, string or number value as expected")}console.debug("evaluated "+a+" to: "+h[e[g][2]]);return h[e[g][2]]}catch(o){console.error("Error occurred trying to evaluate: "+
a+", message: "+o.message)}};f.prototype.a=function(){var a;this.ja();if("undefined"==typeof g||!(g instanceof c))return console.error("variable data needs to be defined as instance of DataXML");e.find('label>input[type="checkbox"], label>input[type="radio"]').parent().parent("fieldset").prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');e.parent().find("label>select, :not(#jr-preload-items, #jr-calculated-items)>label>input").not('[type="checkbox"], [type="radio"]').parent().prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');
e.find('label>input[type="checkbox"][required], label>input[type="radio"][required]').parent().parent("fieldset").find(".question-icons .required").addClass("ui-icon ui-icon-notice");e.parent().find("label>select[required], :not(#jr-preload-items, #jr-calculated-items)>label>input[required]").not('[type="checkbox"], [type="radio"]').parent().find(".question-icons .required").addClass("ui-icon ui-icon-notice");e.find('input[type="radio"]').each(function(){a=$(this).attr("name");$(this).attr("data-name",
a)});this.repeat.a();this.D();this.ia();this.Ka.a();this.L.a();this.M();this.C();this.za();this.wa.a();this.Ca()};f.prototype.ja=function(){var a,b=[],d,c,f,h,p,o,n,B,D,E,u,O,L,M,N,Q,F,G;n=e.find("#stats");a=parseInt(n.find('[id="jrItem"]').text(),10);d=parseInt(n.find('[id="jrInput"]').text(),10);c=parseInt(n.find('[id="jrUpload"]').text(),10);f=parseInt(n.find('[id="jrTrigger"]').text(),10);h=parseInt(n.find('[id="jrConstraint"]').text(),10);p=parseInt(n.find('[id="jrRelevant"]').text(),10);o=parseInt(n.find('[id="jrCalculate"]').text(),
10);n=parseInt(n.find('[id="jrPreload"]').text(),10);B=e.find('input[type="radio"]').length;D=e.find('input[type="checkbox"]').length;e.find("select");E=e.find('option[value!=""]').length;u=e.find('input:not([type="radio"],[type="checkbox"])').length;O=e.find(".trigger").length;L=e.find('[data-relevant]:not([type="radio"],[type="checkbox"])').length;M=e.find('input[data-relevant][type="radio"],input[data-relevant][type="checkbox"]').parent().parent("fieldset").length;N=e.find('[data-constraint]:not([type="radio"],[type="checkbox"])').length;
Q=e.find('input[data-constraint][type="radio"],input[data-constraint][type="checkbox"]').parent().parent("fieldset").length;F=e.find("[data-calculate]").length;G=e.find("#jr-preload-items input").length;a!==E+B+D&&console.error(" total select-type filter differs between XML form and HTML form");d+c!==u-F-G&&console.error(" total amount of input/upload fields differs between XML form and HTML form");f!=O&&console.error(" total triggers differs between XML form and HTML form");p!=L+M&&console.error(" total amount of branches differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form)");
h!=N+Q&&console.error(" total amount of constraints differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form). Note that constraints on &lt;trigger&gt; elements are ignored in the transformation and could cause this error too.");o!=F&&console.error(" total amount of calculated items differs between XML form and HTML formprel");n!=G&&console.error(" total amount of preload items differs between XML form and HTML form");e.find("[name]").each(function(){$.inArray($(this).attr("name"),
b)&&b.push($(this).attr("name"))});for(a=0;a<b.length;a++)1>g.b(b[a]).get().length&&console.error("Found name attribute: "+b[a]+" that does not have a corresponding data node. Transformation error or XML form error (relative nodesets perhaps?")};f.prototype.input={d:function(a){var b=this.f(a.eq(0));return"radio"==b||"checkbox"==b?a.parent("label").parent("fieldset"):"fieldset"==b?a:a.parent("label")},S:function(a){return 1!==a.length?console.error("getProps(): no input node provided or multiple"):
{path:this.getName(a),A:this.ra(a),p:this.f(a),ga:this.ua(a),R:a.attr("data-constraint"),ya:a.attr("data-relevant"),val:this.i(a),required:a.attr("required")!==i?j:m,enabled:this.isEnabled(a),multiple:this.Z(a)}},f:function(a){return 1!==a.length?"":"input"==a.prop("nodeName").toLowerCase()?0<a.attr("type").length?a.attr("type").toLowerCase():console.error("<input> node has no type"):"select"==a.prop("nodeName").toLowerCase()?"select":"fieldset"==a.prop("nodeName").toLowerCase()?"fieldset":console.error("unexpected input node type provided")},
ua:function(a){return 1!==a.length?console.error("getXMLType(): no input node provided or multiple"):a.attr("data-type-xml")},getName:function(a){return 1!==a.length?console.error("getName(): no input node provided or multiple"):"radio"==this.f(a)?a.attr("data-name"):0<a.attr("name").length?a.attr("name"):console.error("input node has no name")},ra:function(a){var b,d,c;if(1!==a.length)return console.error("getIndex(): no input node provided or multiple");b=this.f(a);d=this.getName(a);c=this.d(a);
return("radio"===b&&d!==a.attr("name")?this.d(e.find('[data-name="'+d+'"]')):this.d(e.find('[name="'+d+'"]'))).index(c)},Z:function(a){return"checkbox"==this.f(a)||a.attr("multiple")!==i?j:m},isEnabled:function(a){return a.attr("disabled")!==i||0!==a.parents("fieldset:disabled").length?m:j},i:function(a){var b,d=[],e;if(1!==a.length)return console.error("getVal(): no inputNode provided or multiple");b=this.f(a);e=this.getName(a);return"radio"==b?this.d(a).find("input:checked").val()||"":"checkbox"==
b?(this.d(a).find('input[name="'+e+'"]:checked').each(function(){d.push($(this).val())}),d):a.val()||""},h:function(a,b,d){b=b||0;if("radio"==this.f(e.find('[data-name="'+a+'"]').eq(0)))return this.d(e.find('[data-name="'+a+'"]')).eq(b).find('input[value="'+d+'"]').attr("checked",j);a=this.d(e.find('[name="'+a+'"]')).eq(b).find("input, select, textarea");this.Z(a.eq(0))===j&&(d=d.split(" "));return a.val(d)}};f.prototype.D=function(){var a,b,d,e=this;g.b(k,k,{n:j}).get().each(function(){d=$(this).text();
a=g.b($(this).prop("nodeName")).get().index($(this));b=e.pa($(this));e.input.h(b,a,d)})};f.prototype.Ca=function(){var a,b,d,c=this,f=e.find("#form-languages").attr("data-default-lang");$("#form-languages").detach().insertBefore($("form.jr").parent());if(!f||""===f)f=$("#form-languages a:eq(0)").attr("lang");console.debug("default language is: "+f);2>$("#form-languages a").length?(e.find("[lang]").addClass("active"),e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&
$(this).removeClass("active")}),this.G()):($("#form-languages a").click(function(f){f.preventDefault();a=$(this).attr("lang");$("#form-languages a").removeClass("active");$(this).addClass("active");e.find("[lang]").removeClass("active").filter('[lang="'+a+'"], [lang=""]').addClass("active");e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")});e.find("select>option").not('[value=""]').each(function(){b=$(this).attr("value");
d=$(this).parent("select").next(".jr-option-translations").children('.active[data-option-value="'+b+'"]').text().trim();d="undefined"!==typeof d&&0<d.length?d:"[MISSING TRANSLATION]";$(this).text(d)});e.find("legend span.active:not(.jr-hint, .jr-constraint-msg), label span.active:not(.jr-hint, .jr-constraint-msg)").each(function(){0===$(this).text().trim().length&&$(this).text("[MISSING TRANSLATION]")});c.G();e.trigger("changelanguage")}),$('#form-languages a[lang="'+f+'"]').click())};f.prototype.G=
function(){var a,b;e.find("*>.jr-hint").parent().each(function(){b="label"!==$(this).prop("nodeName").toLowerCase()&&"fieldset"!==$(this).prop("nodeName").toLowerCase()?$(this).parent("fieldset"):$(this);a=0<b.length?$(this).find(".jr-hint.active").text().trim():$(this).find("span.jr-hint").text().trim();0<a.length?b.find(".question-icons .hint").attr("title",a).addClass("ui-icon ui-icon-help"):b.find(".question-icons .hint").removeAttr("title").removeClass("ui-icon ui-icon-help")});e.tooltip()};
f.prototype.reset=function(){var a;e.find("form.jr:eq(0)")[0].reset();this.Ba();h.da(m);$("#survey-title").text("New Survey");$("button#delete-form").hide();a=$("#saved-forms option:first").val();$("#saved-forms").val(a)};f.prototype.da=function(a){e.attr("data-edited",a.toString());e.trigger("edit")};f.prototype.Ba=function(){e.find("form.jr:eq(0)").attr("data-stored-with-key","");$("#survey-title").text("")};f.prototype.getKey=function(){return e.find("form.jr:eq(0)").attr("data-stored-with-key")};
f.prototype.L={a:function(){e.on("click",".jr-branch",function(){var a=$(this);$(this).hasClass("busy")||($(this).hasClass("show")?$(this).addClass("busy").removeClass("show").next().hide("blind",{},600,function(){a.removeClass("busy")}):$(this).addClass("busy show").next().show("blind",{},600,function(){a.removeClass("busy");a.next().o()}))});this.update()},update:function(a){var b,d,c,f,x,p={},o=this;f="undefined"!==typeof a?a.split(","):[];x=0<f.length?[]:["[data-relevant]"];for(a=0;a<f.length;a++)x.push('[data-relevant*="'+
f[a]+'"]');e.find(x.join()).each(function(){b=h.input.S($(this));d=h.input.d($(this));if(!("radio"==b.p||"checkbox"==b.p)||!p[b.path]){if(1!==d.length)return console.error("could not find branch node"),m;try{c=g.evaluate(b.ya,"boolean",b.path,b.A)}catch(a){return console.error('Serious error occurred trying to evaluate skip logic for node with name: "'+b.path+'" (message: '+a.message+")"),m}p[b.path]=j;return c===j?o.enable(d):o.disable(d)}})},enable:function(a){a.prev(".jr-branch").hide("slow",function(){$(this).remove()});
a.removeClass("disabled").show("blind",{direction:"up"},1E3,function(){$(this).o()});return"label"==a.prop("nodeName").toLowerCase()?a.children("input, select, textarea").removeAttr("disabled"):a.removeAttr("disabled")},disable:function(a){a.addClass("disabled").hide();0===a.prev(".jr-branch").length&&(a.before('<div class="jr-branch ui-corner-all"></div>'),a.O("change"));return"label"==a.prop("nodeName").toLowerCase()?a.children("input, select, textarea").attr("disabled","disabled"):a.attr("disabled",
"disabled")}};f.prototype.C=function(a){var b,d,c,f="";console.log("updating active outputs that contain: "+a);d="undefined"!==typeof a?a.split(","):[];c=0<d.length?[]:[".jr-output[data-value]"];for(a=0;a<d.length;a++)c.push('.jr-output[data-value*="'+d[a]+'"]');console.debug("the clever selector created: "+c.join());e.find(":not([disabled]) span.active").find(c.join()).each(function(){try{b=$(this).attr("data-value"),f=g.evaluate(b,"string")}catch(a){console.error("error occurred trying to evaluate output value from expression: "+
b+", (message:"+a.message+")"),f="[ERROR]"}$(this).text(f)});e.o();this.G()};f.prototype.M=function(a){var b,d,c,f,h,p,o;p="undefined"!==typeof a?a.split(","):[];o=0<p.length?[]:["input[data-calculate]"];for(a=0;a<p.length;a++)o.push('input[data-calculate*="'+p[a]+'"]');e.find("#jr-calculated-items").find(o.join()).each(function(){b=$(this).attr("name");d=$(this).attr("data-calculate");c=$(this).attr("data-type-xml");h=$(this).attr("data-constraint");f=g.evaluate(d,"string",b,k);g.b(b,k).h(f,h,c)})};
f.prototype.ia=function(){e.find(".jr-group, .jr-repeat").addClass("ui-corner-all");e.find("h2#form-title").addClass("ui-widget-header ui-corner-all");e.find(".trigger").addClass("ui-state-highlight ui-corner-all");$("fieldset:not(.jr-appearance-compact)>label, fieldset:not(.jr-appearance-compact)>legend").children("img,video,audio").parent().addClass("ui-helper-clearfix with-media")};f.prototype.Ka={a:function(){this.la();this.na();this.Ha();this.ma();this.xa();this.qa();this.ha()},la:function(){e.find(".jr-appearance-compact>label>span").hide()},
na:function(){Modernizr.inputtypes.date||e.find('input[type="date"]').datepicker({})},Ha:function(){Modernizr.inputtypes.time||e.find('input[type="time"]').timepicker({})},ma:function(){Modernizr.inputtypes.datetime||e.find('input[type="datetime"]').datetimepicker()},hb:function(){e.find("select:not([multiple])").attr("size","1");$("select:not([multiple])").multiselect({multiple:m,header:"Select one option",noneSelectedText:"Select one option",selectedList:1,position:{my:"left top",at:"left bottom"}})},
gb:function(){e.find("select[multiple]").attr("size","5").find('[value=""]').remove();$("select[multiple]").multiselect({header:"false",position:{my:"left top",at:"left bottom"}})},xa:function(){e.find("input[readonly]").parent("label").each(function(){var a=$(this).html();$('<fieldset class="trigger ui-state-highlight ui-corner-all"></fieldset>').insertBefore($(this)).append(a).find("input").remove();$(this).remove()})},Xa:q(),lb:q(),kb:q(),qa:function(){e.find('input[data-type-xml="geopoint"]').attr("placeholder",
"Awesome geopoint widget will follow in the future!")},Na:q(),ha:function(){e.find('input[data-type-xml="barcode"]').attr("placeholder","This probably does not require support for browser data entry.")}};f.prototype.wa={a:function(){var a,b,d,c,f=this;e.find("#jr-preload-items input").each(function(){a=$(this).attr("data-preload").toLowerCase();b=$(this).attr("data-preload-params").toLowerCase();d=$(this).attr("name");"undefined"!==typeof f[a]?(c=g.b(d).i(),f.h($(this),f[a]({param:b,m:c,b:$(this)}))):
console.error('Preload "'+a+'"" not supported. May or may not be a big deal.')})},h:function(a,b){a.val(b.toString()).trigger("change")},timestamp:function(a){var b=this;return"start"==a.param&&""!==a.m?""===a.m?a.m:g.evaluate("now()","string"):"end"==a.param?(e.on("beforesave",function(){b.h(a.b,g.evaluate("now()","string"))}),g.evaluate("now()","string")):""},date:function(a){var b,d;return""!==a.m?(b=new Date(g.evaluate("today()","string")),a=b.getUTCFullYear().toString().j(4),d=(b.getUTCMonth()+
1).toString().j(2),b=b.getUTCDate().toString().j(2),a+"-"+d+"-"+b):a.m},property:r("no property preload in Rapaide"),context:function(a){return"application"==a.param?"rapaide":""},patient:r("not supported in Rapaide"),user:r("user preload item not functioning yet"),uid:r("no uid"),browser:function(a){if("name"==a.param)return $.browser.webkit?"webkit":$.browser.mozilla?"mozilla":$.browser.opera?"opera":$.browser.msie?"msie":"unknown";if("version"==a.param)return $.browser.version},os:r("not known")};
f.prototype.repeat={a:function(){var a,b,d,c,f,h=this;e.find("fieldset.jr-repeat").prepend('<span class="repeat-number"></span>');e.find("fieldset.jr-repeat:not([data-repeat-fixed])").append('<button type="button" class="repeat"></button><button type="button" class="remove"></button>');e.find("button.repeat").button({text:m,icons:{primary:"ui-icon-plusthick"}});e.find("button.remove").button({disabled:j,text:m,icons:{primary:"ui-icon-minusthick"}});e.on("click","button.repeat:enabled",function(){h.clone($(this).parent("fieldset.jr-repeat"));
return m});e.on("click","button.remove:enabled",function(){h.remove($(this).parent("fieldset.jr-repeat.clone"));return m});e.find("fieldset.jr-repeat").each(function(){d=$(this).attr("data-repeat-count")||"";b=0<d.length?parseInt(g.b(d).i(),10):0;c=g.b($(this).attr("name")).get().length;f=b>c?b:c;for(a=1;a<f;a++)h.clone($(this).siblings().andSelf().last(),"")})},clone:function(a,b){var d,c,f,h,p,o,n=this;if(1!==a.length)return console.error("Nothing to clone"),m;d=a.parent("fieldset.jr-group").children("fieldset.jr-repeat:not(.clone)").eq(0);
c=d.clone(m);c.find(".clone").remove();c.addClass("clone");c.find("button.remove").button({text:m,icons:{primary:"ui-icon-minusthick"}});c.find("button.repeat").button({text:m,icons:{primary:"ui-icon-plusthick"}});c.insertAfter(a).parent(".jr-group").ba();c.hide().show("highlight",{},600);c.O(b);c.find(".invalid input, .invalid select, .invalid textarea").each(function(){n.H($(this))});f=e.find('fieldset.jr-repeat[name="'+a.attr("name")+'"]').index(a);h=[];c.find('input[type="radio"]').each(function(){-1===
$.inArray($(this).attr("data-name"),h)&&h.push($(this).attr("data-name"))});for(p=0;p<h.length;p++)o=(new Date).getTime().toString(),c.find('input[type="radio"][data-name="'+h[p]+'"]').attr("name",o);this.ea(d.parent());d=d.attr("name");0<d.length&&0<=f&&g.ka(d,f);e.trigger("changerepeat");return j},remove:function(a){var b=this,d=a.attr("name"),c=e.find('[name="'+d+'"]').index(a),f=a.parent("fieldset.jr-group");a.hide("drop",{},600,function(){a.remove();f.ba();b.ea(f)});g.b(d,c).remove();e.trigger("changerepeat")},
ea:function(a){a="undefined"==typeof a||0===a.length||!a?a=e:a;a.find("button.repeat, button.remove").button("disable").removeClass("ui-state-hover");a.find("fieldset.jr-repeat:last-child > button.repeat").button("enable");a.find("fieldset.jr-repeat:not(:nth-child(2)) > button.remove").button("enable")}};f.prototype.za=function(){var a,b,d=this;$("form.jr").attr("onsubmit","return false;");e.on("change validate","input, select, textarea",function(c){a=d.input.S($(this));b="validate"==c.type?a.enabled&&
"hidden"!==a.p?g.b(a.path,a.A).c(a.R,a.ga):j:g.b(a.path,a.A).h(a.val,a.R,a.ga);b=a.enabled&&"hidden"!==a.p&&a.required&&1>a.val.length?m:b;if("undefined"!==typeof b&&b!==k)return b===m?d.Aa($(this)):d.H($(this))});e.on("dataupdate",function(a,b){d.M(b);d.L.update(b);d.C(b)});e.on("change changerepeat",function(){d.da(j)});e.on("changerepeat",function(){d.D()});e.on("beforesave",function(){d.I()});$(window).resize(function(){e.o()});e.on("changelanguage",function(){d.C()})};f.prototype.H=function(a){this.input.d(a).removeClass("invalid ui-state-error")};
f.prototype.Aa=function(a){this.input.d(a).addClass("invalid ui-state-error")};f.prototype.pa=function(a){for(var b=[a.prop("nodeName")],a=a.parent();1==a.length&&"#document"!==a.prop("nodeName");)b.push(a.prop("nodeName")),a=a.parent();return"/"+b.reverse().join("/")};f.prototype.I=function(){var a=this;e.find("fieldset:disabled input, fieldset:disabled select, fieldset:disabled textarea, input:disabled, select:disabled, textarea:disabled").each(function(){a.H($(this))});e.find("input, select, textarea").trigger("validate")};
String.prototype.j=function(a){for(var b=this;b.length<a;)b="0"+b;return b}}var S=jQuery;S.fn.ba=function(){this.each(function(){S(this).find("fieldset.jr-repeat").each(function(){var c,f,g;0===S(this).prev("fieldset.jr-repeat").length&&(c=S(this).siblings("fieldset.jr-repeat"),f=c.length+1,1<f?(S(this).find("span.repeat-number").text("1"),g=2,c.each(function(){S(this).find("span.repeat-number").text(g);g++})):S(this).find("span.repeat-number").empty())})})};
S.fn.O=function(c){c=c||"edit";this.each(function(){S(this).find("input, select, textarea").each(function(){var f=S(this).attr("type");"SELECT"===S(this).prop("nodeName").toUpperCase()&&(f="select");"TEXTAREA"===S(this).prop("nodeName").toUpperCase()&&(f="textarea");switch(f){case "date":case "number":case "search":case "color":case "range":case "url":case "email":case "password":case "text":case "file":case "hidden":case "textarea":S(this).val("").trigger(c);break;case "radio":case "checkbox":S(this).prop("checked")&&
(S(this).prop("checked",m),S(this).trigger(c));break;case "select":S(this)[0].selectedIndex=-1;S(this).trigger(c);break;default:console.error("Unrecognized input type found when trying to reset: "+f)}})})};S.fn.o=function(){var c;this.each(function(){S(this).find("legend + label").each(function(){c=0<S(this).prev().find(".jr-constraint-msg.active").length&&36>S(this).prev().height()?36:19>S(this).prev().height()?19:S(this).prev().height();S(this).animate({"margin-top":c+6+"px"},600)})})};
S.fn.J=function(c){var f,g,c=c.replace(/\/\//g," "),c=c.replace(/^\//,""),c=c.replace(/\/\.$/,""),c=c.replace(/\//g,">"),c=c.replace(/\[([^@].*?)\]/g,function(c,e){return":has("+e+")"});if(0<=c.indexOf(">..")){c=c.split(/>\.\.>?/g);f=jQuery(c[0],this);for(g=1;g<c.length;g++)f=f.parent(c[g]);return f.get()}return this.find(c)};var P,T,U,V="checkforconnection.txt",W="data/upload",X="manifest/gears",w={"settings-auto-upload":j,"settings-button-location":"bottom","settings-auto-notify-backup":m};
$(document).ready(function(){t=new K;P=new R;T=new Y;U=new aa;t.isSupported()?s.F({"local-storage":j}):window.location="modern_browsers";U.a();console.log("cache initialized");s.a();P.a();T.a();if(U.isSupported()){var c,f;s.F({"offline-launch":j});c=t.T("bookmark");f=0;c&&(f=c.Fa?c.Fa:0);3>f&&setTimeout(function(){s.e("Please bookmark this page for easy offline launch. (This reminder will be shown "+(2-f)+" more time(s).)",20);f++;t.Da({recordType:"bookmark",shown:f})},5E3);Z();window.setInterval(function(){Z()},
36E5)}else c={v:"Show options",r:"Use it",u:function(){window.location="modern_browsers"}},s.confirm("Offline application launch not natively supported by your browser. You can use it without this feature or see options for resolving this",c,"Browser requires plugins");s.Ea()});
function Z(){U.checkForUpdate();window.setTimeout(function(){console.log("going to provide cache feedback to user. cache.getError="+U.getError());U.Ja()?s.e("A new version of this application has been downloaded. Please save your work and refresh to update.",20):U.getError()&&("security"===U.getError()?s.e("Please allow site to store data for offline use and refresh.",60):s.alert("An error occurred with the application cache. You may have a problem launching offline (error: "+U.getError()+"). Please save your work, refresh and check if offline launch works."))},
3E4)}function I(c){!c&&P.Ya()?(c={u:function(){I(j)}},s.confirm("Would you like to reset without saving changes to the form you were working on?",c)):P.reset()}
function aa(){var c,f,g,h,e;this.a=function(){if(window.applicationCache)c="html5Cache",f=window.applicationCache,f.addEventListener("updateready",function(){f.swapCache();g=j},m),f.addEventListener("error",function(){console.log("HTML5 cache error event");T.ta()&&(console.log("noticed online status"),h="error downloading application")},m);else if(window.Wa&&google.gears)try{f=google.gears.factory.create("beta.localserver").createManagedStore("rapaide_store");f.manifestUrl=X;f&&(c="gearsCache");e=
f.currentVersion;var a=window.setInterval(function(){e?(window.clearInterval(a),console.log("loaded Gears cache with version:"+e),h=k):3==f.updateStatus&&(console.log("Error: "+f.lastErrorMessage),h=f.lastErrorMessage,window.clearInterval(a))},500)}catch(b){console.log("Gears does not have permission or other Gears initialization error")}};this.isSupported=function(){return"html5Cache"===c||"gearsCache"===c?j:m};this.checkForUpdate=function(){console.log("checking for cache update");switch(c){case "html5Cache":try{f.update()}catch(a){"NS_ERROR_DOM_SECURITY_ERR"===
a.name&&(h="security"),console.log("error thrown during cache update. error name: "+a.name+"  message: "+a.message)}break;case "gearsCache":f.checkForUpdate()}};this.Ja=function(){"gearsCache"===c&&(g=""!=e&&e!=f.currentVersion?j:m);console.log("updateReady() returns: "+g);return g};this.getError=function(){return h}}
function Y(){function c(){$.ajax({type:"POST",url:V,Oa:m,dataType:"text",timeout:3E3,success:function(){f(j)},error:function(){f(m)}})}function f(c){var a=g;g=c;g!==a&&(console.log("status changed to: "+g+", triggering window.onlinestatuschange"),$(window).trigger("onlinestatuschange",g))}var g,h;this.a=function(){c();$(window).on("offline online",function(){c()})};this.ta=function(){return g};this.Va=q();this.upload=function(c){var a=t.sa();if(!h&&("true"===a||c)){var a={},b="";a.Ga=t.U(j);a.mb=
i;a.version=i;0<a.Ga.length?(console.log("attempting upload with override: "+c+" Changing uploadOngoing to true"),h=j,console.log("data to be send: "+JSON.stringify(a)),$.ajax({type:"POST",url:W,data:a,success:function(a){console.log("upload, received back from server: "+JSON.stringify(a));if(a.q){for(var f=0;f<a.q.length;f++)t.ca(a.q[f]),b+=a.q[f],f<a.q.length-1&&(b+=", ");s.e("Succesfully uploaded forms: "+b+".");s.fa($('article[id="records"]'))}else c&&s.e("Upload failed on server")},error:function(){c&&
s.e("Upload failed. Server may be unavailable or client may be offline.")},complete:function(){console.log("completed ajax call, changing uploadOngoing variable to false");h=m},dataType:"json"})):c&&s.e('Nothing marked "final" to upload (or record is currently open).')}}};