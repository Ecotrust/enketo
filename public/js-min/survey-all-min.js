var g=void 0,i=!0,k=null,m=!1;function o(){return function(){}}function r(a){return function(){return a}}var t,u,v,w={};$(document).ready(function(){u=new x;u.a();"undefined"==typeof console&&(console={log:o()});"undefined"==typeof window.console.debug&&(console.debug=console.log);var a;a:{a=window.location.search.substring(1).split("&");for(var c=0;c<a.length;c++){var d=a[c].split("=");if("debug"==d[0]){a=encodeURI(d[1]);break a}}a=m}"true"!==a&&(window.console.log=o(),window.console.debug=o())});
function x(){}t=x.prototype;t.a=function(){this.ea.O();y(this).a();this.K();"function"===typeof this.J&&this.J();$("#form-controls button").wa();Modernizr.borderradius&&(Modernizr.boxshadow&&Modernizr.csstransitions&&Modernizr.opacity)&&$(document).trigger("browsersupport","fancy-visuals");$("footer").detach().appendTo("#container")};t.O=function(){$(window).trigger("resize")};
t.K=function(){var a=this;$("#feedback-bar-close").button({icons:{primary:"ui-icon-closethick"},text:m}).click(function(a){a.preventDefault();$("#feedback-bar p").remove();$("#feedback-bar").trigger("change")});$("#page-close").button({icons:{primary:"ui-icon-closethick"},text:m}).click(function(c){c.preventDefault();y(a).close()});$("#feedback-bar-close, #page-close").removeClass().addClass("custom-button ui-widget-header ui-corner-all");$('a[href^="#"]:not(nav ul li a)').click(function(a){var d=
$(this).attr("href");"#"!==d&&(a.preventDefault(),$('nav li a[href="'+d+'"]').click())});$('nav ul li a[href^="#"]').click(function(c){c.preventDefault();c=$(this).attr("href").substr(1);y(a).open(c);$(this).closest("li").addClass("nav-state-active")});$(window).on("onlinestatuschange",function(c,d){a.updateStatus.sa(d)});$(document).on("edit","form.jr",function(){a.updateStatus.va(i)});$(document).on("browsersupport",function(c,d){a.updateStatus.support(d)});$("#page, #feedback-bar").on("change",
function(){a.display()});$("header #status-connection").click(function(a){A($(this).attr("title"));a.stopPropagation()});$(window).resize(function(){$("#container").css("top",$("header").outerHeight());$("body:not(.no-scroll) #container").height($(window).height()-$("header").outerHeight()-$("#form-controls.bottom").outerHeight());var a=$("nav").offset().left,d=$("#logo").offset().left+$("#logo").outerWidth();a<d?$("#logo").css("visibility","hidden"):$("#logo").css("visibility","visible")})};
t.ea={O:function(){$("article.page").each(function(){var a,c="",d;d=$(this).attr("id");a=$(this).attr("data-display")?$(this).attr("data-display"):d;c=$(this).attr("data-title")?$(this).attr("data-title"):d;d=$(this).attr("data-ext-link")?$(this).attr("data-ext-link"):"#"+d;$('<li class="ui-corner-tl ui-corner-tr"><a href="'+d+'" title="'+c+'" >'+a+"</a></li>").appendTo($("nav ul"))})},reset:function(){$("nav ul li").removeClass("nav-state-active")}};
function y(a){a.a=function(){this.B=$("<pages></pages>");$("article.page").detach().appendTo(this.B)};a.get=function(a){return this.B.find('article[id="'+a+'"]')};a.P=function(){return 0<$("#page article.page").length};a.open=function(a){var d=this.get(a);if(1!==d.length)return console.error("page not found");this.P()&&this.close();d.find(".scrollbar").ka();$("#page-content").prepend(this.get(a).show()).trigger("change");$("#overlay").show();setTimeout(function(){$("#overlay, header").bind("click.pageEvents",
function(){$("#page-close").trigger("click")})},50);$(window).bind("resize.pageEvents",function(){$("#page").trigger("change")})};a.close=function(){var a;a=$("#page .page").detach();this.B.append(a);$("#page").trigger("change");this.ea.reset();$("#overlay").hide();$("#overlay, header").unbind(".pageEvents");$(window).unbind(".pageEvents")};return a}
function A(a,c){var d,c=c?1E3*c:1E4;$("#feedback-bar p").eq(1).remove();$("#feedback-bar p").html()!==a&&(d=$("<p></p>"),d.text(a),$("#feedback-bar").prepend(d));$("#feedback-bar").trigger("change");setTimeout(function(){d.remove();$("#feedback-bar").trigger("change")},c)}t.alert=function(a,c){var d,f=$("#dialog-alert"),c=c||"Alert";d=function(){f.dialog("destroy");f.find("#dialog-alert-msg").text("")};f.find("#dialog-alert-msg").text(a).V();f.dialog({title:c,modal:i,resizable:m,buttons:{Ok:d},beforeClose:d})};
t.confirm=function(a,c,d){var f,e,b,h=$("#dialog-confirm"),d=d||"Are you sure?",c="undefined"==typeof c?{h:"Confirm",p:"Cancel"}:c;c.h=c.h||"Confirm";c.p=c.p||"Cancel";c.g=c.g||o();c.u=c.u||o();f=c.g;e=c.u;b=function(){h.dialog("destroy");h.find("#dialog-confirm-msg").text("")};h.find("#dialog-confirm-msg").text(a||"Please confirm action").V();h.dialog({title:d,resizable:m,modal:i,buttons:[{text:c.h,click:function(){f.call();b.call()}},{text:c.p,click:function(){e.call();b.call()}}],beforeClose:b})};
t.updateStatus={sa:function(a){console.log("updating online status in menu bar to:");console.log(a);a?$("header #status-connection").removeClass().addClass("ui-icon ui-icon-signal-diag").attr("title","It appears there is currently an Internet connection available."):$("header #status-connection").removeClass().addClass("ui-icon ui-icon-cancel").attr("title","It appears there is currently no Internet connection")},va:function(a){a?$("header #status-editing").removeClass().addClass("ui-icon ui-icon-pencil").attr("title",
"Form is being edited."):$("header #status-editing").removeClass().attr("title","")},support:function(a){var c=y(u).get("settings");0<c.length&&(console.debug("updating browser support for "+a),c.find("#settings-browserSupport-"+a+" span.ui-icon").addClass("ui-icon-check"))}};
t.display=function(){var a,c;c=$("header");var d=$("#feedback-bar"),f=$("#page");0<d.find("p").length?(a=c.outerHeight(),c=y(this).P()?c.outerHeight()+d.outerHeight():c.outerHeight()+d.outerHeight()-f.outerHeight()):(a=c.outerHeight()-d.outerHeight(),c=y(this).P()?c.outerHeight():c.outerHeight()-f.outerHeight());d.css("top",a);f.css("top",c)};function B(){}B.prototype.a=function(){var a=this.get();$(document).trigger("setsettings",a)};B.prototype.get=function(){return v.D("__settings")||w};
B.prototype.set=function(a,c){var d;d=this.get();console.debug("going to store setting: "+a+" with value:"+c);d[a]=c;d=v.M("__settings",d,i);if("undefined"!==typeof this[a])this[a](c);return"success"===d?i:console.error("error storing settings")};var C=jQuery;C.fn.wa=function(){var a=0;this.each(function(){C(this).width()>a&&(a=C(this).width())}).each(function(){C(this).width(a)})};C.fn.reverse=[].reverse;
C.fn.S=function(a){a=C.extend({ca:"!@#$%^&*()+=[]\\';,/{}|\":<>?~`.- ",f:"",C:""},a);this.each(function(){a.Wa&&(a.f+="ABCDEFGHIJKLMNOPQRSTUVWXYZ");a.Ma&&(a.f+="abcdefghijklmnopqrstuvwxyz");for(var c=a.C.split(""),d=0;d<c.length;d++)-1!=a.ca.indexOf(c[d])&&(c[d]="\\"+c[d]);a.C=c.join("|");var f=a.ca+a.f,f=f.replace(RegExp(a.C,"gi"),"");C(this).keypress(function(a){var b;b=a.charCode?String.fromCharCode(a.charCode):String.fromCharCode(a.which);f.indexOf(b)!=-1&&a.preventDefault();a.ctrlKey&&b=="v"&&
a.preventDefault()});C(this).bind("contextmenu",r(m))})};C.fn.Xa=function(a){var c="abcdefghijklmnopqrstuvwxyz",c=c+c.toUpperCase(),a=C.extend({f:c},a);return this.each(function(){C(this).S(a)})};C.fn.alpha=function(a){a=C.extend({f:"1234567890"},a);return this.each(function(){C(this).S(a)})};
C.fn.V=function(){var a;a||(a=1);var c=this.contents().filter(function(){return 3==this.nodeType}).first(),d=c.text();a=d.split(" ",a).join(" ");c.length&&(c[0].nodeValue=d.slice(a.length),c.before('<span class="capitalize">'+a+"</span>"))};
C.fn.ka=function(){this.each(function(){var a=C(this),c=C(this).find("ol");a.css("overflow","hidden");var d=c.height()-a.height();if(0<d){var f=d/c.height(),f=Math.round((1-f)*a.height()),f=f-f%2;C("#records .column.middle").html('<div id="slider-wrap" class="ui-corner-all"><div id="slider-vertical"></div></div>');C("#slider-wrap").height(a.outerHeight());C("#slider-vertical").slider({orientation:"vertical",Za:"max",min:0,max:100,value:100,cb:function(a,b){c.css({top:-((100-b.value)*d/100)})}});C("#slider-wrap").css("margin-top",
C("#records-saved h3").outerHeight(i));C(".ui-slider-handle").css({height:f,"margin-bottom":-0.5*f});a=C("#slider-vertical").height();f=a-f;a=0.5*(a-f);C(".ui-slider").css({height:f,"margin-top":a});C(".ui-slider-range").css({top:-a});C("#slider-wrap").click(function(){C("#slider-vertical").slider("value",0);c.css({top:-d})});C("#records-saved-pane,#slider-wrap").mousewheel(function(a,b){var h=C("#slider-vertical").slider("value"),h=h+5*b;C("#slider-vertical").slider("value",h);h=-((100-h)*d/100);
0<h&&(h=0);Math.abs(h)>d&&(h=-1*d);c.css({top:h});a.preventDefault()})}})};function D(){function a(a){var d;for(d=0;d<c.length;d++)if(a===c[d])return i;return m}var c="__settings null __history Firebug undefined __bookmark".split(" "),d=window.localStorage;this.isSupported=function(){try{return"localStorage"in window&&window.localStorage!==k}catch(a){return m}};this.Ra=function(){return c};this.M=function(c,e,b,h){var p;if(!c||1>c.length)return console.error("no key provided for record"),"require";c=c.trim();h="string"===typeof h?h.trim():k;b="undefined"!==typeof b&&b===
i?i:m;if("string"===typeof e&&a(c))return"forbidden";if("string"===typeof e&&h!==c&&d.getItem(c)&&b!==i)return"existing";try{return p="string"===typeof e?{data:e}:e,p.o=(new Date).getTime(),d.setItem(c,JSON.stringify(p)),h!==k&&""!==h&&h!==c&&b&&this.ga(h),"success"}catch(z){return console.log("error in store.setRecord:"+z.message),"error"}};this.D=function(a){var c;try{return c=JSON.parse(d.getItem(a))}catch(b){return console.log("error with loading data from store: "+b.message),k}};this.ga=function(a){try{return d.removeItem(a),
i}catch(c){return console.log("error with removing data from store: "+c.message),m}};this.Z=function(){var a,c,b=[],h=this.Ca();for(a=0;a<h.length;a++)c=h[a],c.ready="true"===c.ready||c.ready===i?i:m,b.push({key:c.key,"final":g,o:c.o});b.sort(function(b,a){return a.o-b.o});return b};this.Ca=function(){var c,e,b,h=[],p={};c=c||m;for(e=0;e<d.length;e++)if(b=d.key(e),console.debug("found record with with key:"+b),p=d.getItem(b),!a(b)){console.debug("record with key: "+b+" is survey data");try{p=JSON.parse(p),
p.key=b,(!c||"true"===p.ready||p.ready===i)&&h.push(p)}catch(z){console.log("record found that was probably not in the correct JSON format (e.g. Firebug settings or corrupt record) (error: "+z.message+"), record was ignored")}}return h};this.Ba=function(){var a={},a=(a=this.D("settings"))?a:w;return a=a["settings-auto-upload"]}};window.XMLSerializer=XMLSerializer;
function E(){function a(b){function a(b,c,h){this.l="undefined"!==typeof b&&b?b:"*";this.filter=h="undefined"!==typeof h&&h!==k?h:{};this.filter.v="undefined"!==typeof h.v?h.v:i;this.filter.G="undefined"!==typeof h.G?h.G:m;this.filter.w="undefined"!==typeof h.w?h.w:m;this.filter.q="undefined"!==typeof h.q?h.q:m;this.index=c}var c,d=this,b=b.replace(/<[\/]?instance(>|\s+[^>]*>)/gi,"");this.xml=$.parseXML(b);this.A=c=$(this.xml);XPathJS.bindDomLevel3XPath();this.b=function(b,c,d){return new a(b,c,d)};
a.prototype.get=function(){var b,a;b=this.filter.w===i?c.R(this.l).filter("[template]"):this.filter.v===i?c.R(this.l).not("[template], [template] *"):c.R(this.l);this.filter.q===i?b=b.filter(function(){a=$(this).text();return 0===$(this).children().length&&0<a.trim().length}):this.filter.G===i&&(b=b.filter(function(){return 0===$(this).children().length}));return b="undefined"!==typeof this.index&&this.index!==k?b.eq(this.index):b};a.prototype.i=function(b,a,c){var h,d;d=this.j().join(" ");b="undefined"!==
typeof b?$.isArray(b)?b.join(" "):b:"";b=this.m(b,c);h=this.get();if(1===h.length&&b.toString().trim()!==d.toString().trim())return h.text(b),b=this.c(a,c),e.trigger("dataupdate",h.prop("nodeName")),b;if(1<h.length)return console.error("nodeset.setVal expected nodeset with one node, but received multiple"),k;0===h.length&&console.error("Data node: "+this.l+" with null-based index: "+this.index+" not found!");return k};a.prototype.j=function(){var b=[];this.get().each(function(){b.push($(this).text())});
return b};a.prototype.clone=function(b){var a,c;a=this.get();b=b||a;1===a.length&&1===b.length?(a.clone().insertAfter(b).find("*").andSelf().removeAttr("template"),c=[a.prop("nodeName")],a.find("*").each(function(){c.push($(this).prop("nodeName"))}),e.trigger("dataupdate",c.join())):console.error("node.clone() function did not receive origin and target nodes")};a.prototype.remove=function(){var b=this.get();0<b.length?(b.remove(),e.trigger("dataupdate",b.prop("nodeName"))):console.error("could not find node "+
this.l+" with index "+this.index+"to remove ")};a.prototype.m=function(b,a){return""===b.toString()?b:"undefined"!==typeof a&&a!==k&&"undefined"!==typeof this.types[a.toLowerCase()]&&"undefined"!==typeof this.types[a.toLowerCase()].m?this.types[a.toLowerCase()].m(b):b};a.prototype.c=function(b,a){var c,h;c=this.j();if(""===c.toString())return i;if("undefined"==typeof a||a===k||"undefined"==typeof this.types[a.toLowerCase()])console.error("data type "+a+" set to string"),a="string";c=this.types[a.toLowerCase()].c(c);
h="undefined"!==typeof b&&b!==k&&0<b.length?d.evaluate(b,"boolean",this.l,this.index):i;return c&&h};a.prototype.types={string:{c:r(i)},select:{c:r(i)},select1:{c:r(i)},decimal:{c:function(b){return!isNaN(b-0)&&b!==k?i:m}},"int":{c:function(b){return!isNaN(b-0)&&b!==k&&Math.round(b)==b?i:m}},date:{c:function(b){return"Invalid Date"!==(new Date(b.toString())).toString()},m:function(b){b=new Date(b);b.setUTCHours(0,0,0,0);return(new Date(b)).toUTCString()}},datetime:{c:function(b){return"Invalid Date"!==
(new Date(b)).toString()}},time:{c:function(b){return"Invalid Date"!==(new Date("2012-01-01 "+b)).toString()},m:function(b){b=new Date("2012-01-01 "+b);return b.getHours().toString().k(2)+":"+b.getMinutes().toString().k(2)+":"+b.getSeconds().toString().k(2)}},barcode:{c:r(i)},geopoint:{c:r(i)},binary:{c:r(i)}}}function c(b){e=$(b)}var d,f,e;this.Oa=function(b,a,c,e){return d.evaluate(b,a,c,e)};this.bb=function(){return f.I()};this.Pa=function(){return d.get()};this.data=function(b){return new a(b)};
this.form=function(b){return new c(b)};this.Qa=function(){return d.ba()};this.Q=function(){return f.Q()};this.a=function(){d=new a(g);d.a();f=new c("form.jr:eq(0)");f.a()};this.za=function(){return d.aa(i,i)};this.getKey=function(){return f.getKey()};this.z=function(b){return f.z(b)};this.r=function(b){return f.r(b)};a.prototype.a=function(){var b,a;this.b(k,k,{q:i,v:m}).get().each(function(){a=$(this).text();$(this).text(a.trim())});b=this.b(":first",0).get();this.namespace=b.attr("xmlns");b.removeAttr("xmlns");
this.X()};a.prototype.qa=function(b,a){var c,d,e=this.b(b,0,{w:i}),e=0===e.get().length?this.b(b,0):e;d=e.get().prop("nodeName");c=this.b(b,a).get();1===e.get().length&&1===c.length&&c.next().prop("nodeName")!==d?e.clone(c):c.next().prop("nodeName")!==d&&console.error("Could not find template node and/or node to insert the clone after")};a.prototype.X=function(b){var a=this;if("undefined"==typeof b||0===b.length)b=this.A.find(":first");b.children("[template]").each(function(){"undefined"==typeof $(this).parent().attr("template")&&
0===$(this).siblings($(this).prop("nodeName")).not("[template]").length&&$(this).clone().insertAfter($(this)).find("*").andSelf().removeAttr("template")});b.children().not("[template]").each(function(){a.X($(this))})};a.prototype.get=function(){return this.A||k};a.prototype.ba=function(){return this.xml||k};a.prototype.aa=function(b,a){var c,b="undefined"!==typeof b?b:m,a="undefined"!==typeof a?a:i;c=$("<root></root");this.A.find(":first").clone().appendTo(c);b===m&&c.find("[template]").remove();
a===i&&("undefined"!==typeof this.namespace&&0<this.namespace.length)&&c.children().eq(0).attr("xmlns",this.namespace);c=(new XMLSerializer).serializeToString(c.children().eq(0)[0]);return c=c.replace(/xmlns\=\"[A-z0-9\:\/\.\-\%\_\?&amp;]*\"/gi," ")};a.prototype.evaluate=function(b,c,d,e){var f,j,n,c=c||"any";f=new a(this.aa(m,m));d="undefined"!==typeof d||d!==k?f.b(d,e,{}).get()[0]:f.ba();e={"0":["any","ANY_TYPE"],1:["number","NUMBER_TYPE","numberValue"],2:["string","STRING_TYPE","stringValue"],
3:["boolean","BOOLEAN_TYPE","booleanValue"],7:["nodes","ORDERED_NODE_SNAPSHOT_TYPE"],9:["node","FIRST_ORDERED_NODE_TYPE"]};for(j in e)if(j=Number(j),e[j][0]==c)break;else j=0;b=b.replace(/&lt;/g,"<");b=b.replace(/&gt;/g,">");b=b.replace(/&quot;/g,'"');try{n=document.evaluate(b,d,k,j,k);if(0===j){for(j in e)if(j=Number(j),j==Number(n.resultType))return n=0<j&&4>j?n[e[j][2]]:n,console.debug("evaluated "+b+" to: "+n),n;console.error("Expression: "+b+" did not return any boolean, string or number value as expected")}console.debug("evaluated "+
b+" to: "+n[e[j][2]]);return n[e[j][2]]}catch(q){console.error("Error occurred trying to evaluate: "+b+", message: "+q.message)}};c.prototype.a=function(){var b;this.pa();if("undefined"==typeof d||!(d instanceof a))return console.error("variable data needs to be defined as instance of DataXML");e.find('label>input[type="checkbox"], label>input[type="radio"]').parent().parent("fieldset").prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');e.parent().find("label>select, :not(#jr-preload-items, #jr-calculated-items)>label>input").not('[type="checkbox"], [type="radio"]').parent().prepend('<div class="question-icons"><span class="required"></span><span class="hint"></span></div>');
e.find('label>input[type="checkbox"][required], label>input[type="radio"][required]').parent().parent("fieldset").find(".question-icons .required").addClass("ui-icon ui-icon-notice");e.parent().find("label>select[required], :not(#jr-preload-items, #jr-calculated-items)>label>input[required]").not('[type="checkbox"], [type="radio"]').parent().find(".question-icons .required").addClass("ui-icon ui-icon-notice");e.find('input[type="radio"]').each(function(){b=$(this).attr("name");$(this).attr("data-name",
b)});this.repeat.a();this.I();this.na();this.La.a();this.T.a();this.U();this.H();this.K();this.Ea.a();this.Ia()};c.prototype.pa=function(){var b,a=[],c,f,l,j,n,q,s,L,M,N,O,P,Q,R,S,T,H,I;s=e.find("#stats");b=parseInt(s.find('[id="jrItem"]').text(),10);c=parseInt(s.find('[id="jrInput"]').text(),10);f=parseInt(s.find('[id="jrUpload"]').text(),10);l=parseInt(s.find('[id="jrTrigger"]').text(),10);j=parseInt(s.find('[id="jrConstraint"]').text(),10);n=parseInt(s.find('[id="jrRelevant"]').text(),10);q=parseInt(s.find('[id="jrCalculate"]').text(),
10);s=parseInt(s.find('[id="jrPreload"]').text(),10);L=e.find('input[type="radio"]').length;M=e.find('input[type="checkbox"]').length;e.find("select");N=e.find('option[value!=""]').length;O=e.find('input:not([type="radio"],[type="checkbox"])').length;P=e.find(".trigger").length;Q=e.find('[data-relevant]:not([type="radio"],[type="checkbox"])').length;R=e.find('input[data-relevant][type="radio"],input[data-relevant][type="checkbox"]').parent().parent("fieldset").length;S=e.find('[data-constraint]:not([type="radio"],[type="checkbox"])').length;
T=e.find('input[data-constraint][type="radio"],input[data-constraint][type="checkbox"]').parent().parent("fieldset").length;H=e.find("[data-calculate]").length;I=e.find("#jr-preload-items input").length;b!==N+L+M&&console.error(" total select-type filter differs between XML form and HTML form");c+f!==O-H-I&&console.error(" total amount of input/upload fields differs between XML form and HTML form");l!=P&&console.error(" total triggers differs between XML form and HTML form");n!=Q+R&&console.error(" total amount of branches differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form)");
j!=S+T&&console.error(" total amount of constraints differs between XML form and HTML form (not a problem if caused by obsolete bindings in xml form). Note that constraints on &lt;trigger&gt; elements are ignored in the transformation and could cause this error too.");q!=H&&console.error(" total amount of calculated items differs between XML form and HTML formprel");s!=I&&console.error(" total amount of preload items differs between XML form and HTML form");e.find("[name]").each(function(){$.inArray($(this).attr("name"),
a)&&a.push($(this).attr("name"))});for(b=0;b<a.length;b++)1>d.b(a[b]).get().length&&console.error("Found name attribute: "+a[b]+" that does not have a corresponding data node. Transformation error or XML form error (relative nodesets perhaps?")};c.prototype.input={d:function(b){var a=this.e(b.eq(0));return"radio"==a||"checkbox"==a?b.parent("label").parent("fieldset"):"fieldset"==a?b:b.parent("label")},$:function(b){return 1!==b.length?console.error("getProps(): no input node provided or multiple"):
{path:this.getName(b),F:this.Aa(b),t:this.e(b),ja:this.Da(b),Y:b.attr("data-constraint"),Ga:b.attr("data-relevant"),val:this.j(b),required:b.attr("required")!==g?i:m,enabled:this.isEnabled(b),multiple:this.da(b)}},e:function(b){return 1!==b.length?"":"input"==b.prop("nodeName").toLowerCase()?0<b.attr("type").length?b.attr("type").toLowerCase():console.error("<input> node has no type"):"select"==b.prop("nodeName").toLowerCase()?"select":"fieldset"==b.prop("nodeName").toLowerCase()?"fieldset":console.error("unexpected input node type provided")},
Da:function(b){return 1!==b.length?console.error("getXMLType(): no input node provided or multiple"):b.attr("data-type-xml")},getName:function(b){return 1!==b.length?console.error("getName(): no input node provided or multiple"):"radio"==this.e(b)?b.attr("data-name"):0<b.attr("name").length?b.attr("name"):console.error("input node has no name")},Aa:function(b){var a,c,d;if(1!==b.length)return console.error("getIndex(): no input node provided or multiple");a=this.e(b);c=this.getName(b);d=this.d(b);
return("radio"===a&&c!==b.attr("name")?this.d(e.find('[data-name="'+c+'"]')):this.d(e.find('[name="'+c+'"]'))).index(d)},da:function(b){return"checkbox"==this.e(b)||b.attr("multiple")!==g?i:m},isEnabled:function(b){return b.attr("disabled")!==g||0!==b.parents("fieldset:disabled").length?m:i},j:function(b){var a,c=[],d;if(1!==b.length)return console.error("getVal(): no inputNode provided or multiple");a=this.e(b);d=this.getName(b);return"radio"==a?this.d(b).find("input:checked").val()||"":"checkbox"==
a?(this.d(b).find('input[name="'+d+'"]:checked').each(function(){c.push($(this).val())}),c):b.val()||""},i:function(b,a,c){a=a||0;if("radio"==this.e(e.find('[data-name="'+b+'"]').eq(0)))return this.d(e.find('[data-name="'+b+'"]')).eq(a).find('input[value="'+c+'"]').attr("checked",i);b=this.d(e.find('[name="'+b+'"]')).eq(a).find("input, select, textarea");this.da(b.eq(0))===i&&(c=c.split(" "));return b.val(c)}};c.prototype.I=function(){var b,a,c,e=this;d.b(k,k,{q:i}).get().each(function(){c=$(this).text();
b=d.b($(this).prop("nodeName")).get().index($(this));a=e.xa($(this));e.input.i(a,b,c)})};c.prototype.Ia=function(){var b,a,c,d=this,f=e.find("#form-languages").attr("data-default-lang");$("#form-languages").detach().insertBefore($("form.jr").parent());if(!f||""===f)f=$("#form-languages a:eq(0)").attr("lang");console.debug("default language is: "+f);2>$("#form-languages a").length?(e.find("[lang]").addClass("active"),e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&
$(this).removeClass("active")}),this.L()):($("#form-languages a").click(function(f){f.preventDefault();b=$(this).attr("lang");$("#form-languages a").removeClass("active");$(this).addClass("active");e.find("[lang]").removeClass("active").filter('[lang="'+b+'"], [lang=""]').addClass("active");e.find(".jr-form-short.active").each(function(){0<$(this).siblings(".jr-form-long.active").length&&$(this).removeClass("active")});e.find("select>option").not('[value=""]').each(function(){a=$(this).attr("value");
c=$(this).parent("select").next(".jr-option-translations").children('.active[data-option-value="'+a+'"]').text().trim();c="undefined"!==typeof c&&0<c.length?c:"[MISSING TRANSLATION]";$(this).text(c)});e.find("legend span.active:not(.jr-hint, .jr-constraint-msg), label span.active:not(.jr-hint, .jr-constraint-msg)").each(function(){0===$(this).text().trim().length&&$(this).text("[MISSING TRANSLATION]")});d.L();e.trigger("changelanguage")}),$('#form-languages a[lang="'+f+'"]').click())};c.prototype.L=
function(){var b,a;e.find("*>.jr-hint").parent().each(function(){a="label"!==$(this).prop("nodeName").toLowerCase()&&"fieldset"!==$(this).prop("nodeName").toLowerCase()?$(this).parent("fieldset"):$(this);b=0<a.length?$(this).find(".jr-hint.active").text().trim():$(this).find("span.jr-hint").text().trim();0<b.length?a.find(".question-icons .hint").attr("title",b).addClass("ui-icon ui-icon-help"):a.find(".question-icons .hint").removeAttr("title").removeClass("ui-icon ui-icon-help")});e.tooltip()};
c.prototype.reset=function(){var b;e.find("form.jr:eq(0)")[0].reset();this.z("");f.r(m);$("#survey-title").text("New Survey");$("button#delete-form").hide();b=$("#saved-forms option:first").val();$("#saved-forms").val(b)};c.prototype.r=function(b){e.attr("data-edited",b.toString());e.trigger("edit")};c.prototype.z=function(b){e.find("form.jr:eq(0)").attr("data-stored-with-key",b);$("#survey-title").text(b)};c.prototype.getKey=function(){return e.find("form.jr:eq(0)").attr("data-stored-with-key")||
k};c.prototype.T={a:function(){e.on("click",".jr-branch",function(){var b=$(this);$(this).hasClass("busy")||($(this).hasClass("show")?$(this).addClass("busy").removeClass("show").next().hide("blind",{},600,function(){b.removeClass("busy")}):$(this).addClass("busy show").next().show("blind",{},600,function(){b.removeClass("busy");b.next().s()}))});this.update()},update:function(b){var a,c,z,l,j,n={},q=this;l="undefined"!==typeof b?b.split(","):[];j=0<l.length?[]:["[data-relevant]"];for(b=0;b<l.length;b++)j.push('[data-relevant*="'+
l[b]+'"]');e.find(j.join()).each(function(){a=f.input.$($(this));c=f.input.d($(this));if(!("radio"==a.t||"checkbox"==a.t)||!n[a.path]){if(1!==c.length)return console.error("could not find branch node"),m;try{z=d.evaluate(a.Ga,"boolean",a.path,a.F)}catch(b){return console.error('Serious error occurred trying to evaluate skip logic for node with name: "'+a.path+'" (message: '+b.message+")"),m}n[a.path]=i;return z===i?q.enable(c):q.disable(c)}})},enable:function(b){b.prev(".jr-branch").hide("slow",function(){$(this).remove()});
b.removeClass("disabled").show("blind",{direction:"up"},1E3,function(){$(this).s()});return"label"==b.prop("nodeName").toLowerCase()?b.children("input, select, textarea").removeAttr("disabled"):b.removeAttr("disabled")},disable:function(b){b.addClass("disabled").hide();0===b.prev(".jr-branch").length&&(b.before('<div class="jr-branch ui-corner-all"></div>'),b.W("change"));return"label"==b.prop("nodeName").toLowerCase()?b.children("input, select, textarea").attr("disabled","disabled"):b.attr("disabled",
"disabled")}};c.prototype.H=function(b){var a,c,f,l="";console.log("updating active outputs that contain: "+b);c="undefined"!==typeof b?b.split(","):[];f=0<c.length?[]:[".jr-output[data-value]"];for(b=0;b<c.length;b++)f.push('.jr-output[data-value*="'+c[b]+'"]');console.debug("the clever selector created: "+f.join());e.find(":not([disabled]) span.active").find(f.join()).each(function(){try{a=$(this).attr("data-value"),l=d.evaluate(a,"string")}catch(b){console.error("error occurred trying to evaluate output value from expression: "+
a+", (message:"+b.message+")"),l="[ERROR]"}$(this).text(l)});e.s();this.L()};c.prototype.U=function(b){var a,c,f,l,j,n,q;n="undefined"!==typeof b?b.split(","):[];q=0<n.length?[]:["input[data-calculate]"];for(b=0;b<n.length;b++)q.push('input[data-calculate*="'+n[b]+'"]');e.find("#jr-calculated-items").find(q.join()).each(function(){a=$(this).attr("name");c=$(this).attr("data-calculate");f=$(this).attr("data-type-xml");j=$(this).attr("data-constraint");l=d.evaluate(c,"string",a,k);d.b(a,k).i(l,j,f)})};
c.prototype.na=function(){e.find(".jr-group, .jr-repeat").addClass("ui-corner-all");e.find("h2#form-title").addClass("ui-widget-header ui-corner-all");e.find(".trigger").addClass("ui-state-highlight ui-corner-all");$("fieldset:not(.jr-appearance-compact)>label, fieldset:not(.jr-appearance-compact)>legend").children("img,video,audio").parent().addClass("ui-helper-clearfix with-media")};c.prototype.La={a:function(){this.ra();this.ua();this.Ja();this.ta();this.Fa();this.ya();this.ma()},ra:function(){e.find(".jr-appearance-compact>label>span").hide()},
ua:function(){Modernizr.inputtypes.date||e.find('input[type="date"]').datepicker({})},Ja:function(){Modernizr.inputtypes.time||e.find('input[type="time"]').timepicker({})},ta:function(){Modernizr.inputtypes.datetime||e.find('input[type="datetime"]').datetimepicker()},ab:function(){e.find("select:not([multiple])").attr("size","1");$("select:not([multiple])").multiselect({multiple:m,header:"Select one option",noneSelectedText:"Select one option",selectedList:1,position:{my:"left top",at:"left bottom"}})},
$a:function(){e.find("select[multiple]").attr("size","5").find('[value=""]').remove();$("select[multiple]").multiselect({header:"false",position:{my:"left top",at:"left bottom"}})},Fa:function(){e.find("input[readonly]").parent("label").each(function(){var b=$(this).html();$('<fieldset class="trigger ui-state-highlight ui-corner-all"></fieldset>').insertBefore($(this)).append(b).find("input").remove();$(this).remove()})},Ua:o(),fb:o(),eb:o(),ya:function(){e.find('input[data-type-xml="geopoint"]').attr("placeholder",
"Awesome geopoint widget will follow in the future!")},Na:o(),ma:function(){e.find('input[data-type-xml="barcode"]').attr("placeholder","This probably does not require support for browser data entry.")}};c.prototype.Ea={a:function(){var b,a,c,f,l=this;e.find("#jr-preload-items input").each(function(){b=$(this).attr("data-preload").toLowerCase();a=$(this).attr("data-preload-params").toLowerCase();c=$(this).attr("name");"undefined"!==typeof l[b]?(f=d.b(c).j(),l.i($(this),l[b]({param:a,n:f,b:$(this)}))):
console.error('Preload "'+b+'"" not supported. May or may not be a big deal.')})},i:function(b,a){b.val(a.toString()).trigger("change")},timestamp:function(b){var a=this;return"start"==b.param&&""!==b.n?""===b.n?b.n:d.evaluate("now()","string"):"end"==b.param?(e.on("beforesave",function(){a.i(b.b,d.evaluate("now()","string"))}),d.evaluate("now()","string")):""},date:function(b){var a,c;return""!==b.n?(a=new Date(d.evaluate("today()","string")),b=a.getUTCFullYear().toString().k(4),c=(a.getUTCMonth()+
1).toString().k(2),a=a.getUTCDate().toString().k(2),b+"-"+c+"-"+a):b.n},property:r("no property preload in Rapaide"),context:function(b){return"application"==b.param?"rapaide":""},patient:r("not supported in Rapaide"),user:r("user preload item not functioning yet"),uid:r("no uid"),browser:function(b){if("name"==b.param)return $.browser.webkit?"webkit":$.browser.mozilla?"mozilla":$.browser.opera?"opera":$.browser.msie?"msie":"unknown";if("version"==b.param)return $.browser.version},os:r("not known")};
c.prototype.repeat={a:function(){var b,a,c,f,l,j=this;e.find("fieldset.jr-repeat").prepend('<span class="repeat-number"></span>');e.find("fieldset.jr-repeat:not([data-repeat-fixed])").append('<button type="button" class="repeat"></button><button type="button" class="remove"></button>');e.find("button.repeat").button({text:m,icons:{primary:"ui-icon-plusthick"}});e.find("button.remove").button({disabled:i,text:m,icons:{primary:"ui-icon-minusthick"}});e.on("click","button.repeat:enabled",function(){j.clone($(this).parent("fieldset.jr-repeat"));
return m});e.on("click","button.remove:enabled",function(){j.remove($(this).parent("fieldset.jr-repeat.clone"));return m});e.find("fieldset.jr-repeat").each(function(){c=$(this).attr("data-repeat-count")||"";a=0<c.length?parseInt(d.b(c).j(),10):0;f=d.b($(this).attr("name")).get().length;l=a>f?a:f;for(b=1;b<l;b++)j.clone($(this).siblings().andSelf().last(),"")})},clone:function(b,a){var c,f,l,j,n,q,s=this;if(1!==b.length)return console.error("Nothing to clone"),m;c=b.parent("fieldset.jr-group").children("fieldset.jr-repeat:not(.clone)").eq(0);
f=c.clone(m);f.find(".clone").remove();f.addClass("clone");f.find("button.remove").button({text:m,icons:{primary:"ui-icon-minusthick"}});f.find("button.repeat").button({text:m,icons:{primary:"ui-icon-plusthick"}});f.insertAfter(b).parent(".jr-group").fa();f.hide().show("highlight",{},600);f.W(a);f.find(".invalid input, .invalid select, .invalid textarea").each(function(){s.N($(this))});l=e.find('fieldset.jr-repeat[name="'+b.attr("name")+'"]').index(b);j=[];f.find('input[type="radio"]').each(function(){-1===
$.inArray($(this).attr("data-name"),j)&&j.push($(this).attr("data-name"))});for(n=0;n<j.length;n++)q=(new Date).getTime().toString(),f.find('input[type="radio"][data-name="'+j[n]+'"]').attr("name",q);this.ia(c.parent());c=c.attr("name");0<c.length&&0<=l&&d.qa(c,l);e.trigger("changerepeat");return i},remove:function(b){var a=this,c=b.attr("name"),f=e.find('[name="'+c+'"]').index(b),l=b.parent("fieldset.jr-group");b.hide("drop",{},600,function(){b.remove();l.fa();a.ia(l)});d.b(c,f).remove();e.trigger("changerepeat")},
ia:function(b){b="undefined"==typeof b||0===b.length||!b?b=e:b;b.find("button.repeat, button.remove").button("disable").removeClass("ui-state-hover");b.find("fieldset.jr-repeat:last-child > button.repeat").button("enable");b.find("fieldset.jr-repeat:not(:nth-child(2)) > button.remove").button("enable")}};c.prototype.K=function(){var b,a,c=this;$("form.jr").attr("onsubmit","return false;");e.on("change validate","input, select, textarea",function(e){b=c.input.$($(this));a="validate"==e.type?b.enabled&&
"hidden"!==b.t?d.b(b.path,b.F).c(b.Y,b.ja):i:d.b(b.path,b.F).i(b.val,b.Y,b.ja);a=b.enabled&&"hidden"!==b.t&&b.required&&1>b.val.length?m:a;if("undefined"!==typeof a&&a!==k)return a===m?c.Ha($(this)):c.N($(this))});e.on("dataupdate",function(b,a){c.U(a);c.T.update(a);c.H(a)});e.on("change changerepeat",function(){c.r(i)});e.on("changerepeat",function(){c.I()});e.on("beforesave",function(){c.Q()});$(window).resize(function(){e.s()});e.on("changelanguage",function(){c.H()})};c.prototype.N=function(b){this.input.d(b).removeClass("invalid ui-state-error")};
c.prototype.Ha=function(b){this.input.d(b).addClass("invalid ui-state-error")};c.prototype.xa=function(b){for(var a=[b.prop("nodeName")],b=b.parent();1==b.length&&"#document"!==b.prop("nodeName");)a.push(b.prop("nodeName")),b=b.parent();return"/"+a.reverse().join("/")};c.prototype.Q=function(){var b=this;e.find("fieldset:disabled input, fieldset:disabled select, fieldset:disabled textarea, input:disabled, select:disabled, textarea:disabled").each(function(){b.N($(this))});e.find("input, select, textarea").trigger("validate")};
String.prototype.k=function(b){for(var a=this;a.length<b;)a="0"+a;return a}}x.prototype.J=o();var F=jQuery;F.fn.fa=function(){this.each(function(){F(this).find("fieldset.jr-repeat").each(function(){var a,c,d;0===F(this).prev("fieldset.jr-repeat").length&&(a=F(this).siblings("fieldset.jr-repeat"),c=a.length+1,1<c?(F(this).find("span.repeat-number").text("1"),d=2,a.each(function(){F(this).find("span.repeat-number").text(d);d++})):F(this).find("span.repeat-number").empty())})})};
F.fn.W=function(a){a=a||"edit";this.each(function(){F(this).find("input, select, textarea").each(function(){var c=F(this).attr("type");"SELECT"===F(this).prop("nodeName").toUpperCase()&&(c="select");"TEXTAREA"===F(this).prop("nodeName").toUpperCase()&&(c="textarea");switch(c){case "date":case "number":case "search":case "color":case "range":case "url":case "email":case "password":case "text":case "file":case "hidden":case "textarea":F(this).val("").trigger(a);break;case "radio":case "checkbox":F(this).prop("checked")&&
(F(this).prop("checked",m),F(this).trigger(a));break;case "select":F(this)[0].selectedIndex=-1;F(this).trigger(a);break;default:console.error("Unrecognized input type found when trying to reset: "+c)}})})};F.fn.s=function(){var a;this.each(function(){F(this).find("legend + label").each(function(){a=0<F(this).prev().find(".jr-constraint-msg.active").length&&36>F(this).prev().height()?36:19>F(this).prev().height()?19:F(this).prev().height();F(this).animate({"margin-top":a+6+"px"},600)})})};
F.fn.R=function(a){var c,d,a=a.replace(/\/\//g," "),a=a.replace(/^\//,""),a=a.replace(/\/\.$/,""),a=a.replace(/\//g,">"),a=a.replace(/\[([^@].*?)\]/g,function(a,c){return":has("+c+")"});if(0<=a.indexOf(">..")){a=a.split(/>\.\.>?/g);c=jQuery(a[0],this);for(d=1;d<a.length;d++)c=c.parent(a[d]);return c.get()}return this.find(a)};var G,J,K,U,V=m,w={autoUpload:i,buttonLocation:"bottom",autoNotifyBackup:m};
$(document).ready(function(){var a,c;v=new D;G=new E;U=new B;U.a();J=new aa;K=new ba;v.isSupported()?$(document).trigger("browsersupport","local-storage"):window.location="modern_browsers";K.a();console.log("cache initialized");G.a();J.a();K.isSupported()?($(document).trigger("browsersupport","offline-launch"),a=v.D("bookmark"),c=0,a&&(c=a.ha?a.ha:0),3>c&&setTimeout(function(){A("Please bookmark this page for easy offline launch. (This reminder will be shown "+(2-c)+" more time(s).)",20);c++;v.M("__bookmark",
{ha:c},i)},5E3),W(),window.setInterval(function(){W()},36E5)):(a={h:"Show options",p:"Use it",g:function(){window.location="modern_browsers"}},u.confirm("Offline application launch not supported by your browser. You can use it without this feature or see options for resolving this",a,"Application cannot launch offline"));u.O();$("form.jr").trigger("save",JSON.stringify(v.Z()))});
function W(){K.checkForUpdate();window.setTimeout(function(){console.log("going to provide cache feedback to user. cache.getError="+K.getError());K.Ka()?A("A new version of this application has been downloaded. Please save your work and refresh to update.",20):K.getError()&&("security"===K.getError()?A("Please allow site to store data for offline use and refresh.",60):u.alert("An error occurred with the application cache. You may have a problem launching offline (error: "+K.getError()+"). Please save your work, refresh and check if offline launch works."))},
3E4)}
function X(a,c){var d,f;f=G.za();f!==k&&""!==f&&a&&0<a.length?(d=G.getKey(),console.log("old key is: "+d),console.log("new key is: "+a),d&&d!==a&&"undefined"!==c?(f={h:"Yes, delete",p:"No, keep",g:function(){X(a,i)},u:function(){X(a,m)}},u.confirm("Record name has changed. Would you like to delete the record saved under the old name:"+d+"?",f,"Delete old Record?")):(d=v.M(a,f,c,d),"success"===d?(A('Form with name "'+a+'" has been saved.',2),G.z(a),G.r(m),$("button#delete-form").show(),$("form.jr").trigger("save",JSON.stringify(v.Z()))):
"existing"===d?(f={h:"Yes, overwrite",g:function(){X(a,i)},u:function(){A("Form was not saved.")}},u.confirm("Record with this name already exists. Would you like to overwrite existing record? ",f)):"forbidden"===d?(u.alert("This name is not allowed. Please change it"),A("Form was NOT saved.")):A("Error occurred. Form was NOT saved."))):a?A("Nothing to save."):console.error("No record name provided.")}
function Y(a){!a&&G.Va()?(a={g:function(){Y(i)}},u.confirm("Would you like to reset without saving changes to the form you were working on?",a)):G.reset()}
function Z(a){var c=G.getKey();""!==c&&c!==k?a?v.ga(c)?(G.reset(),A("Successfully deleted form.")):A("An error occurred when trying to delete this form."):(a={h:"Delete",g:function(){Z(i)}},u.confirm("Please confirm that you would like to remove this form from storage.",a)):A("Please first load the form you would like to delete or choose reset if you'd like to reset the current form.")}
function ba(){var a,c,d,f;this.a=function(){window.applicationCache&&(a="html5Cache",c=window.applicationCache,c.addEventListener("updateready",function(){c.swapCache();d=i},m),c.addEventListener("error",function(){console.log("HTML5 cache error event");J.Ta()&&(console.log("noticed online status"),f="error downloading application")},m))};this.isSupported=function(){return"html5Cache"===a||"gearsCache"===a?i:m};this.checkForUpdate=function(){console.log("checking for cache update");switch(a){case "html5Cache":try{c.update()}catch(d){"NS_ERROR_DOM_SECURITY_ERR"===
d.name&&(f="security"),console.log("error thrown during cache update. error name: "+d.name+"  message: "+d.message)}break;case "gearsCache":c.checkForUpdate()}};this.Ka=function(){"gearsCache"===a&&(d=g!=c.currentVersion?i:m);console.log("updateReady() returns: "+d);return d};this.getError=function(){return f}}
function aa(){function a(){console.log("checking connection status");var a=navigator.onLine;a!==V&&(console.log("status changed to: "+a+", triggering window.onlinestatuschange"),$(window).trigger("onlinestatuschange",a));V=a}this.a=function(){a();$(window).on("offline online",function(){a()})};this.upload=function(a){("true"===v.Ba()||a)&&v.Sa("surveyData",i)}}B.prototype.autoUpload=B.prototype.la;B.prototype.buttonLocation=B.prototype.oa;B.prototype.la=o();
B.prototype.oa=function(a){$("#form-controls").removeClass("bottom right mobile").addClass(a);$(window).trigger("resize")};
x.prototype.J=function(){var a=this;$("button#save-form").button({icons:{primary:"ui-icon-disk"}}).click(function(){X(m)});$("button#reset-form").button({icons:{primary:"ui-icon-refresh"}}).click(function(){Y()});$("button#delete-form").button({icons:{primary:"ui-icon-trash"}}).click(function(){Z(m)});$(document).on("click","#records-saved li:not(.no-click)",function(a){a.preventDefault()}).on("mouseenter","#records-saved li:not(.no-click)",function(){$(this).addClass("ui-state-hover");$(this).mousedown(function(){$(this).addClass("ui-state-active")})}).on("mouseleave",
"#records-saved li:not(.no-click)",function(){$(this).removeClass("ui-state-hover")});y(this).get("records").find("button#records-force-upload").button({icons:{Ya:"ui-icon-arrowthick-1-n"}}).click(function(){u.alert("Sorry, this button is not working yet.")}).hover(function(){$("#records-force-upload-info").show()},function(){$("#records-force-upload-info").hide()});y(this).get("records").find("button#records-export").button({icons:{primary:"ui-icon-suitcase"}}).click(function(){u.alert("Sorry, this button is not working yet.")}).hover(function(){$("#records-export-info").show()},
function(){$("#records-export-info").hide()});$(document).on("save","form.jr",function(c,d){console.debug("save event detected with new formlist: "+d);var f=JSON.parse(d),e,b,h,p,z,l,j=0,n=0;e||(e=y(a).get("records"));l=e.find("#records-saved ol");l.children().remove();f=f||[];if(0<f.length)for(p=0;p<f.length;p++)b=f[p].key,h=(new Date(f[p].o)).toDateString(),f[p].ready===i?(z="check",j++):(z="pencil",n++),h=$('<li><span class="ui-icon ui-icon-'+z+'"></span><span class="name"></span><span class="date"> ('+
h+")</span></li>"),h.find(".name").text(b),l.append(h);else $('<li class="no-click">no locally saved records found</li>').appendTo(l);e.find("#records-draft-qty").text(n);e.find("#records-final-qty").text(j)});$(document).on("setsettings",function(c,d){console.debug("settingschange detected, GUI will be updated with settings:");console.debug(d);var f;console.log("gui updateSettings() started");$.each(d,function(c,b){f=b?y(a).get("settings").find('input[name="'+c+'"][value="'+b+'"]'):y(a).get("settings").find('input[name="'+
c+'"]');0<f.length&&f.attr("checked",b?i:m).trigger("change")})});y(this).get("settings").on("change","input",function(){var a,d;console.debug("settings change by user detected");a=$(this).attr("name");d=$(this).is(":checked")?$(this).val():"";U.set(a,d)})};